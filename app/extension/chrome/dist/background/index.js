const z=/[a-zA-Z0-9_\u0392-\u03C9\u00C0-\u00FF\u0600-\u06FF\u0400-\u04FF]+|[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF\u3040-\u309F\uAC00-\uD7AF]+/g;function C(t){const e=t.match(z);let r=0;if(!e)return 0;for(let n=0;n<e.length;n++)e[n].charCodeAt(0)>=19968?r+=e[n].length*2:r+=1;return r}function x(t){t=t.replace(/,+,/g,", ");const e=/<img src="(.+)" \/>/g;t=t.replace(e,"![$1]($1)");const r=/<a href="(.+)">(.+)<\/a>/g;return t=t.replace(r,"[$2]($1)"),t=t.replace(/!\[.+?\]\(.+?\)/g,""),t=t.replace(/<(?:.|\n)*?>/gm,""),t=t.replace(/<\/(?:.|\n)*?>/gm,""),t=t.replace(/#+\s/g,""),t=t.replace(/\s+/g," "),t=t.replace(/\n{2,}/g,`
`),t=t.trim(),t=M(t),t}function k(t,e){let r=t;if(t&&Object.keys(e).length)for(const n in e)r=r.replaceAll(`{${n}}`,e[n]);return r}const q={"&amp;":"&","&lt;":"<","&gt;":">","&#60;":"<","&#62;":">","&le;":"≤","&#8804;":"≤","&ge;":"≥","&#8805;":"≥","&quot;":'"',"&#34;":'"',"&trade;":"™","&#8482;":"™","&asymp;":"≈","&#8776;":"≈","&ndash;":"-","&#8211;":"-","&mdash;":"—","&#8212;":"—","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&ne;":"≠","&#8800;":"≠","&pound;":"£","&#163;":"£","&euro;":"€","&#8364;":"€","&deg;":"°","&#176;":"°","&#39;":"'","&apos;":"'","&nbsp;":" ","&#160;":" "};function J(t){return t.replace(/(&amp;|&lt;|&#60;|&gt;|&#62;|&le;|&#8804;|&ge;|&#8805;|&quot;|&#34;|&trade;|&#8482;|&asymp;|&#8776;|&ndash;|&#8211;|&mdash;|&#8212;|&copy;|&#169;|&reg;|&#174;|&ne;|&#8800;|&pound;|&#163;|&euro;|&#8364;|&deg;|&#176;|&#39;|&apos;|&nbsp;|&#160;|&quot;|&#34;|&trade;|&#8482;|&asymp;|&#8776;|&ndash;|&#8211;|&mdash;|&#8212;|&copy;|&#169;|&reg;|&#174;|&ne;|&#8800;|&pound;|&#163;|&euro;|&#8364;|&deg;|&#176;|&#39;|&apos;|&nbsp;|&#160;)/g,e=>q[e]||e)}function M(t){return J(t)}function _(t){let e=t.message||"";return t.data&&(e+=JSON.stringify(t.data)),e}const W=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,B=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,V=/^\s*["[{]|^\s*-?\d[\d.]{0,14}\s*$/;function G(t,e){if(t!=="__proto__"&&!(t==="constructor"&&e&&typeof e=="object"&&"prototype"in e))return e}function Q(t,e={}){if(typeof t!="string")return t;const r=t.toLowerCase().trim();if(r==="true")return!0;if(r==="false")return!1;if(r==="null")return null;if(r==="nan")return Number.NaN;if(r==="infinity")return Number.POSITIVE_INFINITY;if(r!=="undefined"){if(!V.test(t)){if(e.strict)throw new SyntaxError("Invalid JSON");return t}try{return W.test(t)||B.test(t)?JSON.parse(t,G):JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}}const X=/#/g,Z=/&/g,Y=/=/g,j=/\+/g,tt=/%5e/gi,et=/%60/gi,rt=/%7c/gi,at=/%20/gi;function nt(t){return encodeURI(""+t).replace(rt,"|")}function T(t){return nt(typeof t=="string"?t:JSON.stringify(t)).replace(j,"%2B").replace(at,"+").replace(X,"%23").replace(Z,"%26").replace(et,"`").replace(tt,"^")}function S(t){return T(t).replace(Y,"%3D")}function D(t=""){try{return decodeURIComponent(""+t)}catch{return""+t}}function st(t){return D(t.replace(j," "))}function ot(t=""){const e={};t[0]==="?"&&(t=t.slice(1));for(const r of t.split("&")){const n=r.match(/([^=]+)=?(.*)/)||[];if(n.length<2)continue;const s=D(n[1]);if(s==="__proto__"||s==="constructor")continue;const i=st(n[2]||"");typeof e[s]<"u"?Array.isArray(e[s])?e[s].push(i):e[s]=[e[s],i]:e[s]=i}return e}function it(t,e){return(typeof e=="number"||typeof e=="boolean")&&(e=String(e)),e?Array.isArray(e)?e.map(r=>`${S(t)}=${T(r)}`).join("&"):`${S(t)}=${T(e)}`:S(t)}function ct(t){return Object.keys(t).filter(e=>t[e]!==void 0).map(e=>it(e,t[e])).join("&")}const ut=/^\w{2,}:([/\\]{1,2})/,pt=/^\w{2,}:([/\\]{2})?/,lt=/^([/\\]\s*){2,}[^/\\]/;function F(t,e={}){return typeof e=="boolean"&&(e={acceptRelative:e}),e.strict?ut.test(t):pt.test(t)||(e.acceptRelative?lt.test(t):!1)}const dt=/\/$|\/\?/;function $(t="",e=!1){return e?dt.test(t):t.endsWith("/")}function ht(t="",e=!1){if(!e)return($(t)?t.slice(0,-1):t)||"/";if(!$(t,!0))return t||"/";const[r,...n]=t.split("?");return(r.slice(0,-1)||"/")+(n.length>0?`?${n.join("?")}`:"")}function ft(t="",e=!1){if(!e)return t.endsWith("/")?t:t+"/";if($(t,!0))return t||"/";const[r,...n]=t.split("?");return r+"/"+(n.length>0?`?${n.join("?")}`:"")}function gt(t=""){return t.startsWith("/")}function mt(t=""){return(gt(t)?t.slice(1):t)||"/"}function yt(t,e){if(wt(e)||F(t))return t;const r=ht(e);return t.startsWith(r)?t:Ct(r,t)}function bt(t,e){const r=L(t),n={...ot(r.search),...e};return r.search=ct(n),Tt(r)}function wt(t){return!t||t==="/"}function St(t){return t&&t!=="/"}function Ct(t,...e){let r=t||"";for(const n of e.filter(s=>St(s)))r=r?ft(r)+mt(n):n;return r}function L(t="",e){if(!F(t,{acceptRelative:!0}))return e?L(e+t):I(t);const[r="",n,s=""]=(t.replace(/\\/g,"/").match(/([^/:]+:)?\/\/([^/@]+@)?(.*)/)||[]).splice(1),[i="",o=""]=(s.match(/([^#/?]*)(.*)?/)||[]).splice(1),{pathname:c,search:u,hash:a}=I(o.replace(/\/(?=[A-Za-z]:)/,""));return{protocol:r,auth:n?n.slice(0,Math.max(0,n.length-1)):"",host:i,pathname:c,search:u,hash:a}}function I(t=""){const[e="",r="",n=""]=(t.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:e,search:r,hash:n}}function Tt(t){const e=t.pathname+(t.search?(t.search.startsWith("?")?"":"?")+t.search:"")+t.hash;return t.protocol?t.protocol+"//"+(t.auth?t.auth+"@":"")+t.host+e:e}class $t extends Error{constructor(){super(...arguments),this.name="FetchError"}}function It(t,e,r){let n="";e&&(n=e.message),t&&r?n=`${n} (${r.status} ${r.statusText} (${t.toString()}))`:t&&(n=`${n} (${t.toString()})`);const s=new $t(n);return Object.defineProperty(s,"request",{get(){return t}}),Object.defineProperty(s,"response",{get(){return r}}),Object.defineProperty(s,"data",{get(){return r&&r._data}}),Object.defineProperty(s,"status",{get(){return r&&r.status}}),Object.defineProperty(s,"statusText",{get(){return r&&r.statusText}}),Object.defineProperty(s,"statusCode",{get(){return r&&r.status}}),Object.defineProperty(s,"statusMessage",{get(){return r&&r.statusText}}),s}const Et=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function E(t="GET"){return Et.has(t.toUpperCase())}function At(t){if(t===void 0)return!1;const e=typeof t;return e==="string"||e==="number"||e==="boolean"||e===null?!0:e!=="object"?!1:Array.isArray(t)?!0:t.constructor&&t.constructor.name==="Object"||typeof t.toJSON=="function"}const Ot=new Set(["image/svg","application/xml","application/xhtml","application/html"]),Rt=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Pt(t=""){if(!t)return"json";const e=t.split(";").shift()||"";return Rt.test(e)?"json":Ot.has(e)||e.startsWith("text/")?"text":"blob"}const Nt=new Set([408,409,425,429,500,502,503,504]);function U(t){const{fetch:e,Headers:r}=t;function n(o){const c=o.error&&o.error.name==="AbortError"||!1;if(o.options.retry!==!1&&!c){let a;typeof o.options.retry=="number"?a=o.options.retry:a=E(o.options.method)?0:1;const p=o.response&&o.response.status||500;if(a>0&&Nt.has(p))return s(o.request,{...o.options,retry:a-1})}const u=It(o.request,o.error,o.response);throw Error.captureStackTrace&&Error.captureStackTrace(u,s),u}const s=async function(c,u={}){const a={request:c,options:{...t.defaults,...u},response:void 0,error:void 0};a.options.onRequest&&await a.options.onRequest(a),typeof a.request=="string"&&(a.options.baseURL&&(a.request=yt(a.request,a.options.baseURL)),(a.options.query||a.options.params)&&(a.request=bt(a.request,{...a.options.params,...a.options.query})),a.options.body&&E(a.options.method)&&At(a.options.body)&&(a.options.body=typeof a.options.body=="string"?a.options.body:JSON.stringify(a.options.body),a.options.headers=new r(a.options.headers),a.options.headers.has("content-type")||a.options.headers.set("content-type","application/json"),a.options.headers.has("accept")||a.options.headers.set("accept","application/json"))),a.response=await e(a.request,a.options).catch(async l=>(a.error=l,a.options.onRequestError&&await a.options.onRequestError(a),n(a)));const p=(a.options.parseResponse?"json":a.options.responseType)||Pt(a.response.headers.get("content-type")||"");if(p==="json"){const l=await a.response.text(),d=a.options.parseResponse||Q;a.response._data=d(l)}else p==="stream"?a.response._data=a.response.body:a.response._data=await a.response[p]();return a.options.onResponse&&await a.options.onResponse(a),a.response.status>=400&&a.response.status<600?(a.options.onResponseError&&await a.options.onResponseError(a),n(a)):a.response},i=function(c,u){return s(c,u).then(a=>a._data)};return i.raw=s,i.native=e,i.create=(o={})=>U({...t,defaults:{...t.defaults,...o}}),i}const v=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),_t=v.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),jt=v.Headers,Dt=U({fetch:_t,Headers:jt}),h=Dt,Ft="github.com",Lt="twitter.com",g="https://api.notion.com/v1",A="https://api.openai.com",Ut=`Please summarize content and then classify it to 1-5 types of classification. Classification names should be short and no explanation or description is needed.
You only speak JSON. Do not write text that isn't JSON. The JSON keys must be English word of "summary" and "categories".
Classification names used with array data.
The JSON format must be:
{
  "summary": "This is the summary content."
  "categories": ["XXX","YYY","ZZZ"]
}
`,vt=`Please answer in {language}. The Content is {webprompts}:
=====
{content}
=====
Please answer in {language}.`,Kt={de:"German",en:"English",es:"Spanish",fr:"Franch",kr:"Korean",nl:"Dutch",it:"Italian",ja:"Japanese",pt:"Portuguese",ru:"Russian","zh-CN":"Chinese"};var Ht=Object.defineProperty,zt=(t,e,r)=>e in t?Ht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,O=(t,e,r)=>(zt(t,typeof e!="symbol"?e+"":e,r),r);let xt=class{constructor(e,r){O(this,"config"),O(this,"data"),this.config=e,this.data=r}};class kt extends xt{constructor(e,r){super(e,r)}async create(e){if(!e&&!this.data)throw new Error("DataStorage error: No Storage Data");const r=e||this.data,n={title:r.title,summary:r.summary,url:r.url,categories:r.categories,status:"Starred",meta:r.meta};return await qt(this.config,n)}async updateOgImage(e,r){return await Jt(this.config,e.storageId,r)}getConfig(){return this.config}getType(){return{type:"DataStorage",name:"NotionDataStorage"}}}async function qt(t,e){const r=t.apiKey;let n=[{name:"Others"}];n=e.categories.map(a=>(a=a.trim(),a.endsWith(".")&&(a=a.slice(0,-1)),{name:a}));const s={parent:{database_id:t.databaseId},properties:{Title:{title:[{text:{content:e.title}}]},Summary:{rich_text:[{text:{content:e.summary}}]},URL:{url:e.url},Categories:{multi_select:n},Status:{select:{name:"Starred"}}}};let i=t.defaultOgImage;if(e.meta&&Object.keys(e.meta).length>0){const a=e.meta;if(a.ogImage&&(i=a.ogImage),s.properties={...s.properties,OgImage:{url:i}},s.properties={...s.properties,Website:{select:{name:a.siteName}}},e.meta.domain===Ft){const p=a;if(p.languages){const l=p.languages.map(d=>({name:d}));s.properties={...s.properties,Languages:{multi_select:l}}}if(p.tags){const l=p.tags.map(d=>({name:d}));s.properties={...s.properties,Tags:{multi_select:l}}}}else if(e.meta.domain===Lt){const p=a;if(p.tags){const l=p.tags.map(d=>({name:d}));s.properties={...s.properties,Tags:{multi_select:l}}}}}const o=await h(`${g}/databases/${t.databaseId}/query`,{method:"POST",headers:{"Content-Type":"application/json","Notion-Version":"2022-06-28",Authorization:`Bearer ${r}`},body:{filter:{property:"URL",rich_text:{contains:e.url}}}});let c="",u=!1;if(o.results.length>0&&(o.results[0].properties.Status.select.name==="Starred"&&(u=!0),c=o.results[0].id),c)return s.properties={...s.properties,Status:{select:{name:u?"Unstarred":"Starred"}}},await h(`${g}/pages/${c}`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`,"Notion-Version":"2022-06-28","Content-Type":"application/json"},body:s}),{starred:!u,storageId:c};if(i){const a={object:"block",image:{external:{url:i}}};s.children=[a]}return c=(await h(`${g}/pages`,{method:"POST",headers:{"Content-Type":"application/json","Notion-Version":"2022-06-28",Authorization:`Bearer ${r}`},body:s})).id,{starred:!u,storageId:c}}async function Jt(t,e,r){const n=await h(`${g}/blocks/${e}/children`,{method:"GET",headers:{"Content-Type":"application/json","Notion-Version":"2022-06-28",Authorization:`Bearer ${t.apiKey}`}});let s="";if(n.results.length>0){const i=n.results,o=i.length;for(let c=0;c<o;c++)if(i[c].type==="image"&&i[c].image.type==="external"&&i[c].image.external.url.includes("stargramogimage")){s=i[c].id;break}}return await h(`${g}/pages/${e}`,{method:"PATCH",headers:{Authorization:`Bearer ${t.apiKey}`,"Notion-Version":"2022-06-28","Content-Type":"application/json"},body:{properties:{OgImage:{url:r}}}}),s&&await h(`${g}/blocks/${s}`,{method:"PATCH",headers:{Authorization:`Bearer ${t.apiKey}`,"Notion-Version":"2022-06-28","Content-Type":"application/json"},body:{image:{external:{url:r}}}}),{url:r}}var Mt=Object.defineProperty,Wt=(t,e,r)=>e in t?Mt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,m=(t,e,r)=>(Wt(t,typeof e!="symbol"?e+"":e,r),r);let Bt=class{constructor(e){m(this,"apiUrl","/api/webcard"),m(this,"headers"),m(this,"webData"),m(this,"localFn"),this.apiUrl=(e.stargramHub||"")+this.apiUrl,this.webData=e.webData,this.headers=e.headers,this.localFn=void 0}async call(e){if(!e.webData&&!this.webData)throw new Error("WebCard error: No WebInfo Data");const r=e.webData||this.webData,n=e.dataStorage.getType(),s=e.dataStorage.getConfig();return await h(this.apiUrl,{method:"POST",headers:this.headers,body:{webData:r,dataType:n,dataCfg:s,savedData:e.savedData,byApi:!0}})}};var Vt=Object.defineProperty,Gt=(t,e,r)=>e in t?Vt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y=(t,e,r)=>(Gt(t,typeof e!="symbol"?e+"":e,r),r);let Qt=class{constructor(e){y(this,"webUrl",""),y(this,"apiUrl","/api/webinfo"),y(this,"stargramHub",""),y(this,"headers"),this.webUrl=e.urls.webUrl,this.headers=e.headers,this.stargramHub=e.stargramHub||""}async call(){if(!this.stargramHub)throw new Error("Stargram error: No StargramHub API.");return await h(this.stargramHub+this.apiUrl,{method:"POST",headers:this.headers,body:{webUrl:this.webUrl}})}getStarNuxesApi(){return this.stargramHub}};var Xt=Object.defineProperty,Zt=(t,e,r)=>e in t?Xt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,b=(t,e,r)=>(Zt(t,typeof e!="symbol"?e+"":e,r),r),K=(t=>(t.ChatGPT="chatgpt",t.GPT3="gpt3",t))(K||{});function Yt(t="",e){const r=t?t.replace(/&#39;/g,"'").replace(/(\r\n)+/g,`\r
`).replace(/(\s{2,})/g," ").replace(/^(\s)+|(\s)$/g,""):"";return re(r,e)}const R=14e3,te=800,ee=1300;function re(t,e){let r=t;const n=ne(t).length;if(n>R){const s=R/n;r=t.substring(0,Math.floor(t.length*s))}return ae(r,e)}function ae(t,e){const r=e==="gpt3"?ee:te;let n=C(t);if(n>r){let s=t;for(;n>r;){const i=n-r;s=s.substring(0,s.length-(i/2<10?10:i/2)),n=C(s)}return s}return t}function ne(t){return decodeURIComponent(encodeURIComponent(escape(t))).replace(/%([0-9A-F]{2})/gi,(e,r)=>{const n=Number.parseInt(r,16);return String.fromCharCode(n)})}class se{constructor(e){b(this,"apiKey"),b(this,"webData"),b(this,"lang"),b(this,"apiHost"),this.apiKey=e.apiKey,this.webData=e.webData,this.lang=e.lang,this.apiHost=e.apiHost}async call(e){if(!e&&!this.webData)throw new Error("OpenaiSummarizeContent error: No WebInfo Data");const r=e||this.webData;return await oe(this.apiKey,r,this.lang,this.apiHost)}}async function oe(t,e,r="zh-CN",n=A){let s="",i=[],o=e.content;o=x(o);const c=C(o),u=n===A?`${n}/v1`:n;if(c>40){o=Yt(o,K.GPT3);const p={content:o,language:Kt[r],webprompts:e.meta.prompts||""},l=k(vt,p),d=(await h(`${u}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:{model:"gpt-3.5-turbo",messages:[{role:"system",content:Ut},{role:"user",content:l}],max_tokens:800,temperature:.3}})).choices[0].message.content,f=JSON.parse(d);s=f.summary,i=f.categories}else s=o;const a=i&&i.length?i:["Others"];return{summary:s,categories:a}}var ie=Object.defineProperty,ce=(t,e,r)=>e in t?ie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,w=(t,e,r)=>(ce(t,typeof e!="symbol"?e+"":e,r),r);class ue{constructor(e){w(this,"webInfo"),w(this,"webCard"),w(this,"summarizeContent"),w(this,"dataStorage"),this.webInfo=e.webInfo,this.webCard=e.webCard,this.summarizeContent=e.summarizeContent,this.dataStorage=e.dataStorage}async call(){const e=await this.webInfo.call();let r={summary:e.content,categories:["Others"]};this.summarizeContent&&(r=await this.summarizeContent.call(e));const n=await this.dataStorage.create({...e,...r});return this.webCard&&(this.webCard.localFn?await this.webCard.call({dataStorage:this.dataStorage,webData:e,savedData:n}):this.webCard.call({dataStorage:this.dataStorage,webData:e,savedData:n}).then(s=>console.log(s)).catch(s=>console.error(_(s)))),n}}async function P(t){chrome.tabs.query({active:!0,lastFocusedWindow:!0},e=>{e.length&&t.tabId&&e[0].id&&t.tabId!==e[0].id&&chrome.tabs.sendMessage(e[0].id,{action:"savedStatusToContent",data:t})}),t.tabId?chrome.tabs.sendMessage(t.tabId,{action:"savedStatusToContent",data:t}):chrome.tabs.query({active:!0,lastFocusedWindow:!0},e=>{e.length!==0&&e[0].id&&chrome.tabs.sendMessage(e[0].id,{action:"sendResponseToContent",data:t})})}chrome.runtime.onInstalled.addListener(async()=>{const t=await chrome.storage.sync.get(["notionApiKey","notionDatabaseId","openaiApiKey","stargramHub","uiLang","promptsLang"]),e=t.notionApiKey??"",r=t.notionDatabaseId??"",n=t.openaiApiKey??"",s=t.stargramHub??"",i=t.uiLang??"en",o=t.promptsLang??"en";await chrome.storage.sync.set({notionApiKey:e,notionDatabaseId:r,openaiApiKey:n,stargramHub:s,uiLang:i,promptsLang:o})});chrome.runtime.onMessage.addListener(async(t,e,r)=>{var s,i,o;const n=t.action;if(n==="saveToNotion")if(t.data){const c=(s=e.tab)==null?void 0:s.id,u=t.data;u.tabId=c,pe(u).then(a=>{P(a)}).catch(a=>{P(a)}),r({message:"handling save to notion"})}else r({message:"Error: request.data is undefined.",error:!0});else if(n==="checkStarred"){const c=(i=e.tab)==null?void 0:i.id,u=(o=t.data)==null?void 0:o.webUrl;u&&c&&le(u,c).then(a=>{N(a)}).catch(a=>{N(a)}),r({message:"checking"})}return!0});async function pe(t){const e=await chrome.storage.sync.get(["notionApiKey","notionDatabaseId","openaiApiKey","promptsLang","stargramHub"]),r=e.notionApiKey??"",n=e.notionDatabaseId??"",s=e.openaiApiKey??"",i=e.promptsLang??"en",o=e.stargramHub??"";if(!r||!n)return{tabId:t.tabId,starred:t.starred,notionPageId:t.storageId,error:"Missing Notion API key or Database ID in settings."};const c=t.webUrl,u=new Qt({urls:{webUrl:c},stargramHub:o}),a=new Bt({stargramHub:o}),p=new se({apiKey:s,lang:i}),l=new kt({apiKey:r,databaseId:n,defaultOgImage:"https://kiafhufrshqyrvlpsdqg.supabase.co/storage/v1/object/public/pics-bed/stargram.png?v=stargramogimage"}),d=new ue({webInfo:u,webCard:a,summarizeContent:p,dataStorage:l});try{const f=await d.call();return{tabId:t.tabId,starred:f.starred,storageId:f.storageId}}catch(f){const H=_(f);return{tabId:t.tabId,starred:t.starred,storageId:t.storageId,error:H}}}async function N(t){t.tabId&&chrome.tabs.sendMessage(t.tabId,{action:"starredStatusToContent",data:t})}async function le(t,e){const r=await chrome.storage.sync.get(["notionApiKey","notionDatabaseId"]),n=r.notionApiKey??"",s=r.notionDatabaseId??"";let i=!1,o="";if(!n||!s)return{tabId:e,storageId:o,starred:i,error:"Missing Notion API key or Database ID in settings."};try{const c=await fetch(`https://api.notion.com/v1/databases/${s}/query`,{method:"POST",headers:{"Content-Type":"application/json","Notion-Version":"2022-06-28",Authorization:`Bearer ${n}`},body:JSON.stringify({filter:{property:"URL",rich_text:{contains:t}}})});if(c.status!==200){const u=await c.json();let a="Notion API error: ";return u.message?a+=u.message:a+=c.status.toString(),{tabId:e,starred:i,storageId:o,error:a}}else{const u=await c.json();return u.results.length>0&&(u.results[0].properties.Status.select.name==="Starred"&&(i=!0),o=u.results[0].id),{tabId:e,starred:i,storageId:o}}}catch(c){return{tabId:e,starred:i,storageId:o,error:c.message?c.message:"Error check starred status."}}}
