var uc=Object.defineProperty;var lc=(n,e,t)=>e in n?uc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var De=(n,e,t)=>(lc(n,typeof e!="symbol"?e+"":e,t),t);function dc(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const hc=/[a-zA-Z0-9_\u0392-\u03C9\u00C0-\u00FF\u0600-\u06FF\u0400-\u04FF]+|[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF\u3040-\u309F\uAC00-\uD7AF]+/g;function Hn(n){const e=n.match(hc);let t=0;if(!e)return 0;for(let r=0;r<e.length;r++)e[r].charCodeAt(0)>=19968?t+=e[r].length*2:t+=1;return t}function fc(n){n=n.replace(/,+,/g,", ");const e=/<img src="(.+)" \/>/g;n=n.replace(e,"![$1]($1)");const t=/<a href="(.+)">(.+)<\/a>/g;return n=n.replace(t,"[$2]($1)"),n=n.replace(/!\[.+?\]\(.+?\)/g,""),n=n.replace(/<(?:.|\n)*?>/gm,""),n=n.replace(/<\/(?:.|\n)*?>/gm,""),n=n.replace(/#+\s/g,""),n=n.replace(/\s+/g," "),n=n.replace(/\n{2,}/g,`
`),n=n.trim(),n=yc(n),n}function pc(n,e){let t=n;if(n&&Object.keys(e).length)for(const r in e)t=t.replaceAll(`{${r}}`,e[r]);return t}const mc={"&amp;":"&","&lt;":"<","&gt;":">","&#60;":"<","&#62;":">","&le;":"≤","&#8804;":"≤","&ge;":"≥","&#8805;":"≥","&quot;":'"',"&#34;":'"',"&trade;":"™","&#8482;":"™","&asymp;":"≈","&#8776;":"≈","&ndash;":"-","&#8211;":"-","&mdash;":"—","&#8212;":"—","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&ne;":"≠","&#8800;":"≠","&pound;":"£","&#163;":"£","&euro;":"€","&#8364;":"€","&deg;":"°","&#176;":"°","&#39;":"'","&apos;":"'","&nbsp;":" ","&#160;":" "};function gc(n){return n.replace(/(&amp;|&lt;|&#60;|&gt;|&#62;|&le;|&#8804;|&ge;|&#8805;|&quot;|&#34;|&trade;|&#8482;|&asymp;|&#8776;|&ndash;|&#8211;|&mdash;|&#8212;|&copy;|&#169;|&reg;|&#174;|&ne;|&#8800;|&pound;|&#163;|&euro;|&#8364;|&deg;|&#176;|&#39;|&apos;|&nbsp;|&#160;|&quot;|&#34;|&trade;|&#8482;|&asymp;|&#8776;|&ndash;|&#8211;|&mdash;|&#8212;|&copy;|&#169;|&reg;|&#174;|&ne;|&#8800;|&pound;|&#163;|&euro;|&#8364;|&deg;|&#176;|&#39;|&apos;|&nbsp;|&#160;)/g,e=>mc[e]||e)}function yc(n){return gc(n)}function pa(n){let e=n.message||"";return n.data&&(e+=JSON.stringify(n.data)),e}const vc=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,bc=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,_c=/^\s*["[{]|^\s*-?\d[\d.]{0,14}\s*$/;function wc(n,e){if(n==="__proto__"||n==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Oc(n);return}return e}function Oc(n){console.warn(`[destr] Dropping "${n}" key to prevent prototype pollution.`)}function Tc(n,e={}){if(typeof n!="string")return n;const t=n.trim();if(n[0]==='"'&&n[n.length-1]==='"')return t.slice(1,-1);const r=t.toLowerCase();if(r==="true")return!0;if(r==="false")return!1;if(r!=="undefined"){if(r==="null")return null;if(r==="nan")return Number.NaN;if(r==="infinity")return Number.POSITIVE_INFINITY;if(r==="-infinity")return Number.NEGATIVE_INFINITY;if(!_c.test(n)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return n}try{if(vc.test(n)||bc.test(n)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(n,wc)}return JSON.parse(n)}catch(s){if(e.strict)throw s;return n}}}const Pc=/#/g,Ec=/&/g,Ac=/=/g,ma=/\+/g,Sc=/%5e/gi,Ic=/%60/gi,Cc=/%7c/gi,jc=/%20/gi;function kc(n){return encodeURI(""+n).replace(Cc,"|")}function Kn(n){return kc(typeof n=="string"?n:JSON.stringify(n)).replace(ma,"%2B").replace(jc,"+").replace(Pc,"%23").replace(Ec,"%26").replace(Ic,"`").replace(Sc,"^")}function dn(n){return Kn(n).replace(Ac,"%3D")}function ga(n=""){try{return decodeURIComponent(""+n)}catch{return""+n}}function Rc(n){return ga(n.replace(ma," "))}function xc(n=""){const e={};n[0]==="?"&&(n=n.slice(1));for(const t of n.split("&")){const r=t.match(/([^=]+)=?(.*)/)||[];if(r.length<2)continue;const s=ga(r[1]);if(s==="__proto__"||s==="constructor")continue;const i=Rc(r[2]||"");typeof e[s]<"u"?Array.isArray(e[s])?e[s].push(i):e[s]=[e[s],i]:e[s]=i}return e}function Dc(n,e){return(typeof e=="number"||typeof e=="boolean")&&(e=String(e)),e?Array.isArray(e)?e.map(t=>`${dn(n)}=${Kn(t)}`).join("&"):`${dn(n)}=${Kn(e)}`:dn(n)}function $c(n){return Object.keys(n).filter(e=>n[e]!==void 0).map(e=>Dc(e,n[e])).join("&")}const Nc=/^\w{2,}:([/\\]{1,2})/,Lc=/^\w{2,}:([/\\]{2})?/,Uc=/^([/\\]\s*){2,}[^/\\]/;function ya(n,e={}){return typeof e=="boolean"&&(e={acceptRelative:e}),e.strict?Nc.test(n):Lc.test(n)||(e.acceptRelative?Uc.test(n):!1)}const Mc=/\/$|\/\?/;function Jn(n="",e=!1){return e?Mc.test(n):n.endsWith("/")}function Fc(n="",e=!1){if(!e)return(Jn(n)?n.slice(0,-1):n)||"/";if(!Jn(n,!0))return n||"/";const[t,...r]=n.split("?");return(t.slice(0,-1)||"/")+(r.length>0?`?${r.join("?")}`:"")}function Zc(n="",e=!1){if(!e)return n.endsWith("/")?n:n+"/";if(Jn(n,!0))return n||"/";const[t,...r]=n.split("?");return t+"/"+(r.length>0?`?${r.join("?")}`:"")}function Vc(n=""){return n.startsWith("/")}function Bc(n=""){return(Vc(n)?n.slice(1):n)||"/"}function qc(n,e){if(Hc(e)||ya(n))return n;const t=Fc(e);return n.startsWith(t)?n:Jc(t,n)}function zc(n,e){const t=va(n),r={...xc(t.search),...e};return t.search=$c(r),Gc(t)}function Hc(n){return!n||n==="/"}function Kc(n){return n&&n!=="/"}function Jc(n,...e){let t=n||"";for(const r of e.filter(s=>Kc(s)))t=t?Zc(t)+Bc(r):r;return t}function va(n="",e){if(!ya(n,{acceptRelative:!0}))return e?va(e+n):Js(n);const[t="",r,s=""]=(n.replace(/\\/g,"/").match(/([^/:]+:)?\/\/([^/@]+@)?(.*)/)||[]).splice(1),[i="",a=""]=(s.match(/([^#/?]*)(.*)?/)||[]).splice(1),{pathname:o,search:u,hash:c}=Js(a.replace(/\/(?=[A-Za-z]:)/,""));return{protocol:t,auth:r?r.slice(0,Math.max(0,r.length-1)):"",host:i,pathname:o,search:u,hash:c}}function Js(n=""){const[e="",t="",r=""]=(n.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:e,search:t,hash:r}}function Gc(n){const e=n.pathname+(n.search?(n.search.startsWith("?")?"":"?")+n.search:"")+n.hash;return n.protocol?n.protocol+"//"+(n.auth?n.auth+"@":"")+n.host+e:e}class Wc extends Error{constructor(){super(...arguments),this.name="FetchError"}}function Yc(n,e,t){let r="";e&&(r=e.message),n&&t?r=`${r} (${t.status} ${t.statusText} (${n.toString()}))`:n&&(r=`${r} (${n.toString()})`);const s=new Wc(r);return Object.defineProperty(s,"request",{get(){return n}}),Object.defineProperty(s,"response",{get(){return t}}),Object.defineProperty(s,"data",{get(){return t&&t._data}}),Object.defineProperty(s,"status",{get(){return t&&t.status}}),Object.defineProperty(s,"statusText",{get(){return t&&t.statusText}}),Object.defineProperty(s,"statusCode",{get(){return t&&t.status}}),Object.defineProperty(s,"statusMessage",{get(){return t&&t.statusText}}),s}const Qc=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function Gs(n="GET"){return Qc.has(n.toUpperCase())}function Xc(n){if(n===void 0)return!1;const e=typeof n;return e==="string"||e==="number"||e==="boolean"||e===null?!0:e!=="object"?!1:Array.isArray(n)?!0:n.constructor&&n.constructor.name==="Object"||typeof n.toJSON=="function"}const eu=new Set(["image/svg","application/xml","application/xhtml","application/html"]),tu=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function ru(n=""){if(!n)return"json";const e=n.split(";").shift()||"";return tu.test(e)?"json":eu.has(e)||e.startsWith("text/")?"text":"blob"}function nu(n,e,t=globalThis.Headers){const r={...e,...n};if(e!=null&&e.params&&(n!=null&&n.params)&&(r.params={...e==null?void 0:e.params,...n==null?void 0:n.params}),e!=null&&e.query&&(n!=null&&n.query)&&(r.query={...e==null?void 0:e.query,...n==null?void 0:n.query}),e!=null&&e.headers&&(n!=null&&n.headers)){r.headers=new t((e==null?void 0:e.headers)||{});for(const[s,i]of new t((n==null?void 0:n.headers)||{}))r.headers.set(s,i)}return r}const su=new Set([408,409,425,429,500,502,503,504]);function ba(n){const{fetch:e,Headers:t}=n;function r(a){const o=a.error&&a.error.name==="AbortError"||!1;if(a.options.retry!==!1&&!o){let c;typeof a.options.retry=="number"?c=a.options.retry:c=Gs(a.options.method)?0:1;const l=a.response&&a.response.status||500;if(c>0&&su.has(l))return s(a.request,{...a.options,retry:c-1})}const u=Yc(a.request,a.error,a.response);throw Error.captureStackTrace&&Error.captureStackTrace(u,s),u}const s=async function(o,u={}){const c={request:o,options:nu(u,n.defaults,t),response:void 0,error:void 0};c.options.onRequest&&await c.options.onRequest(c),typeof c.request=="string"&&(c.options.baseURL&&(c.request=qc(c.request,c.options.baseURL)),(c.options.query||c.options.params)&&(c.request=zc(c.request,{...c.options.params,...c.options.query})),c.options.body&&Gs(c.options.method)&&Xc(c.options.body)&&(c.options.body=typeof c.options.body=="string"?c.options.body:JSON.stringify(c.options.body),c.options.headers=new t(c.options.headers||{}),c.options.headers.has("content-type")||c.options.headers.set("content-type","application/json"),c.options.headers.has("accept")||c.options.headers.set("accept","application/json")));try{c.response=await e(c.request,c.options)}catch(h){return c.error=h,c.options.onRequestError&&await c.options.onRequestError(c),await r(c)}const l=(c.options.parseResponse?"json":c.options.responseType)||ru(c.response.headers.get("content-type")||"");if(l==="json"){const h=await c.response.text(),p=c.options.parseResponse||Tc;c.response._data=p(h)}else l==="stream"?c.response._data=c.response.body:c.response._data=await c.response[l]();return c.options.onResponse&&await c.options.onResponse(c),!c.options.ignoreResponseError&&c.response.status>=400&&c.response.status<600?(c.options.onResponseError&&await c.options.onResponseError(c),await r(c)):c.response},i=async function(o,u){return(await s(o,u))._data};return i.raw=s,i.native=e,i.create=(a={})=>ba({...n,defaults:{...n.defaults,...a}}),i}const _a=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),iu=_a.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),au=_a.Headers,ou=ba({fetch:iu,Headers:au}),Ae=ou;var cu=Object.defineProperty,uu=(n,e,t)=>e in n?cu(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,pr=(n,e,t)=>(uu(n,typeof e!="symbol"?e+"":e,t),t);let lu=class{constructor(e){pr(this,"apiUrl","/api/webcard"),pr(this,"headers"),pr(this,"webData"),pr(this,"localFn"),this.apiUrl=(e.stargramHub||"")+this.apiUrl,this.webData=e.webData,this.headers=e.headers,this.localFn=void 0}async call(e){if(!e.webData&&!this.webData)throw new Error("WebCard error: No WebInfo Data");const t=e.webData||this.webData,r=e.dataStorage.getType(),s=e.dataStorage.getConfig();return await Ae(this.apiUrl,{method:"POST",headers:this.headers,body:{webData:t,dataType:r,dataCfg:s,savedData:e.savedData,byApi:!0}})}};var du=Object.defineProperty,hu=(n,e,t)=>e in n?du(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,mr=(n,e,t)=>(hu(n,typeof e!="symbol"?e+"":e,t),t);let fu=class{constructor(e){mr(this,"apiUrl","/api/webinfo"),mr(this,"stargramHub",""),mr(this,"browserlessToken"),mr(this,"headers"),this.headers=e.headers,this.stargramHub=e.stargramHub||"",this.browserlessToken=e.browserlessToken}async call(e){if(!this.stargramHub)throw new Error("Stargram error: No StargramHub API.");return await Ae(this.stargramHub+this.apiUrl,{method:"POST",headers:this.headers,body:{webUrl:e.webUrl,browserlessToken:this.browserlessToken}})}getStarNuxesApi(){return this.stargramHub}};var pu=Object.defineProperty,mu=(n,e,t)=>e in n?pu(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,xt=(n,e,t)=>(mu(n,typeof e!="symbol"?e+"":e,t),t);let gu=class{constructor(e){xt(this,"webInfo"),xt(this,"webCard"),xt(this,"llm"),xt(this,"dataStorage"),xt(this,"vectorStorage"),this.webInfo=e.webInfo,this.webCard=e.webCard,this.llm=e.llm,this.dataStorage=e.dataStorage,this.vectorStorage=e.vectorStorage}async call(e,t){let r;if(this.dataStorage&&(r=await this.dataStorage.query(e.webUrl),r&&!t))return r;const s=await this.webInfo.call(e);let i={summary:s.content,categories:["Others"]};this.llm&&(i=await this.llm.summarize(s)),this.vectorStorage&&this.vectorStorage.save(s);const a=r?await this.dataStorage.update(r,{...s,...i}):await this.dataStorage.create({...s,...i});return this.webCard&&(this.webCard.localFn?await this.webCard.call({dataStorage:this.dataStorage,webData:s,savedData:a}):this.webCard.call({dataStorage:this.dataStorage,webData:s,savedData:a}).then(o=>console.log(o)).catch(o=>console.error(pa(o)))),a}};const wa="github.com",Oa="twitter.com",yt="https://api.notion.com/v1",Ws="https://api.openai.com",yu=`You are a summarize professer. Please summarize content in detail and then classify it to 1-5 types of classification. Classification names should be short and no explanation or description is needed.
You only speak JSON. Do not write text that isn't JSON. The JSON keys must be English word of "summary" and "categories".
Classification names used with array data.
The JSON format must be:
{
  "summary": "This is the summary content."
  "categories": ["XXX","YYY","ZZZ"]
}
`,vu=`Please summarize in {language}. The Content is {webprompts}:
=====
{content}
=====
Please summarize in {language}. Remember You only speak JSON.`,bu={de:"German",en:"English",es:"Spanish",fr:"Franch",kr:"Korean",nl:"Dutch",it:"Italian",ja:"Japanese",pt:"Portuguese",ru:"Russian","zh-CN":"Chinese"};var _u=Object.defineProperty,wu=(n,e,t)=>e in n?_u(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,_t=(n,e,t)=>(wu(n,typeof e!="symbol"?e+"":e,t),t);class Ou{constructor(e,t){_t(this,"config"),_t(this,"data"),this.config=e,this.data=t}}class Tu{constructor(e,t){_t(this,"config"),_t(this,"data"),this.config=e,this.data=t}}class Ta{constructor(e,t){_t(this,"config"),_t(this,"data"),this.config=e,this.data=t}}let Pu=class extends Ou{constructor(e,t){super(e,t)}async create(e){if(!e&&!this.data)throw new Error("DataStorage error: No Storage Data");const t=e||this.data,r={title:t.title,summary:t.summary,url:t.url,categories:t.categories,status:"Starred",meta:t.meta};return await Eu(this.config,r)}async update(e,t){if(!t&&!this.data)throw new Error("DataStorage error: No Storage Data");const r=t||this.data,s={title:r.title,summary:r.summary,url:r.url,categories:r.categories,status:"Starred",meta:r.meta};return await Au(e,this.config,s)}async query(e){const t=await Ae(`${yt}/databases/${this.config.databaseId}/query`,{method:"POST",headers:{"Content-Type":"application/json","Notion-Version":"2022-06-28",Authorization:`Bearer ${this.config.apiKey}`},body:{filter:{property:"URL",rich_text:{contains:e}}}});if(t.results.length>0){let r=!1,s="";return t.results[0].properties.Status.select.name==="Starred"&&(r=!0),s=t.results[0].id,{starred:r,storageId:s}}else return}async updateOgImage(e,t){return await Su(this.config,e.storageId,t)}getConfig(){return this.config}getType(){return{type:"DataStorage",name:"NotionDataStorage"}}};async function Eu(n,e){const t=n.apiKey;let r=[{name:"Others"}];r=e.categories.map(u=>(u=u.trim(),u.endsWith(".")&&(u=u.slice(0,-1)),{name:u}));const s={parent:{database_id:n.databaseId},properties:{Title:{title:[{text:{content:e.title}}]},Summary:{rich_text:[{text:{content:e.summary}}]},URL:{url:e.url},Categories:{multi_select:r},Status:{select:{name:"Starred"}}}};let i=n.defaultOgImage;if(e.meta&&Object.keys(e.meta).length>0){const u=e.meta;if(u.savedImage&&(i=u.savedImage),s.properties={...s.properties,OgImage:{url:i}},s.properties={...s.properties,Website:{select:{name:u.siteName}}},e.meta.domain===wa){const c=u;if(c.languages){const l=c.languages.map(h=>({name:h}));s.properties={...s.properties,Languages:{multi_select:l}}}if(c.tags){const l=c.tags.map(h=>({name:h}));s.properties={...s.properties,Tags:{multi_select:l}}}}else if(e.meta.domain===Oa){const c=u;if(c.tags){const l=c.tags.map(h=>({name:h}));s.properties={...s.properties,Tags:{multi_select:l}}}}}let a="";const o=!1;if(i){const u={object:"block",image:{external:{url:i}}};s.children=[u]}return a=(await Ae(`${yt}/pages`,{method:"POST",headers:{"Content-Type":"application/json","Notion-Version":"2022-06-28",Authorization:`Bearer ${t}`},body:s})).id,{starred:!o,storageId:a}}async function Au(n,e,t){const r=e.apiKey,s=n.storageId,i=n.starred;let a=[{name:"Others"}];a=t.categories.map(c=>(c=c.trim(),c.endsWith(".")&&(c=c.slice(0,-1)),{name:c}));const o={parent:{database_id:e.databaseId},properties:{Title:{title:[{text:{content:t.title}}]},Summary:{rich_text:[{text:{content:t.summary}}]},URL:{url:t.url},Categories:{multi_select:a},Status:{select:{name:i?"Unstarred":"Starred"}}}};let u=e.defaultOgImage;if(t.meta&&Object.keys(t.meta).length>0){const c=t.meta;if(c.savedImage&&(u=c.savedImage),o.properties={...o.properties,OgImage:{url:u}},o.properties={...o.properties,Website:{select:{name:c.siteName}}},t.meta.domain===wa){const l=c;if(l.languages){const h=l.languages.map(p=>({name:p}));o.properties={...o.properties,Languages:{multi_select:h}}}if(l.tags){const h=l.tags.map(p=>({name:p}));o.properties={...o.properties,Tags:{multi_select:h}}}}else if(t.meta.domain===Oa){const l=c;if(l.tags){const h=l.tags.map(p=>({name:p}));o.properties={...o.properties,Tags:{multi_select:h}}}}}return await Ae(`${yt}/pages/${s}`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`,"Notion-Version":"2022-06-28","Content-Type":"application/json"},body:o}),{starred:!i,storageId:s}}async function Su(n,e,t){const r=await Ae(`${yt}/blocks/${e}/children`,{method:"GET",headers:{"Content-Type":"application/json","Notion-Version":"2022-06-28",Authorization:`Bearer ${n.apiKey}`}});let s="";if(r.results.length>0){const i=r.results,a=i.length;for(let o=0;o<a;o++)if(i[o].type==="image"&&i[o].image.type==="external"&&i[o].image.external.url.includes("stargramogimage")){s=i[o].id;break}}return await Ae(`${yt}/pages/${e}`,{method:"PATCH",headers:{Authorization:`Bearer ${n.apiKey}`,"Notion-Version":"2022-06-28","Content-Type":"application/json"},body:{properties:{OgImage:{url:t}}}}),s&&await Ae(`${yt}/blocks/${s}`,{method:"PATCH",headers:{Authorization:`Bearer ${n.apiKey}`,"Notion-Version":"2022-06-28","Content-Type":"application/json"},body:{image:{external:{url:t}}}}),{url:t}}const Iu="modulepreload",Cu=function(n){return"/"+n},Ys={},Pt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=Cu(i),i in Ys)return;Ys[i]=!0;const a=i.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!r)for(let l=s.length-1;l>=0;l--){const h=s[l];if(h.href===i&&(!a||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${o}`))return;const c=document.createElement("link");if(c.rel=a?"stylesheet":Iu,a||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),a)return new Promise((l,h)=>{c.addEventListener("load",l),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i})};var ju=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const ku=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ju(void 0,void 0,void 0,function*(){return yield(yield Pt(()=>Promise.resolve().then(()=>xr),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)};class ms extends Error{constructor(e,t="FunctionsError",r){super(e),super.name=t,this.context=r}}class Ru extends ms{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class xu extends ms{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Du extends ms{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var $u=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};class Nu{constructor(e,{headers:t={},customFetch:r}={}){this.url=e,this.headers=t,this.fetch=ku(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return $u(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:a}=t;let o={},u;a&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",u=a):typeof a=="string"?(o["Content-Type"]="text/plain",u=a):typeof FormData<"u"&&a instanceof FormData?u=a:(o["Content-Type"]="application/json",u=JSON.stringify(a)));const c=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),s),body:u}).catch(g=>{throw new Ru(g)}),l=c.headers.get("x-relay-error");if(l&&l==="true")throw new xu(c);if(!c.ok)throw new Du(c);let h=((r=c.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),p;return h==="application/json"?p=yield c.json():h==="application/octet-stream"?p=yield c.blob():h==="multipart/form-data"?p=yield c.formData():p=yield c.text(),{data:p,error:null}}catch(s){return{data:null,error:s}}})}}var z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function or(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Gn={exports:{}};(function(n,e){var t=typeof self<"u"?self:z,r=function(){function i(){this.fetch=!1,this.DOMException=t.DOMException}return i.prototype=t,new i}();(function(i){(function(a){var o={searchParams:"URLSearchParams"in i,iterable:"Symbol"in i&&"iterator"in Symbol,blob:"FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in i,arrayBuffer:"ArrayBuffer"in i};function u(T){return T&&DataView.prototype.isPrototypeOf(T)}if(o.arrayBuffer)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(T){return T&&c.indexOf(Object.prototype.toString.call(T))>-1};function h(T){if(typeof T!="string"&&(T=String(T)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(T))throw new TypeError("Invalid character in header field name");return T.toLowerCase()}function p(T){return typeof T!="string"&&(T=String(T)),T}function g(T){var E={next:function(){var R=T.shift();return{done:R===void 0,value:R}}};return o.iterable&&(E[Symbol.iterator]=function(){return E}),E}function b(T){this.map={},T instanceof b?T.forEach(function(E,R){this.append(R,E)},this):Array.isArray(T)?T.forEach(function(E){this.append(E[0],E[1])},this):T&&Object.getOwnPropertyNames(T).forEach(function(E){this.append(E,T[E])},this)}b.prototype.append=function(T,E){T=h(T),E=p(E);var R=this.map[T];this.map[T]=R?R+", "+E:E},b.prototype.delete=function(T){delete this.map[h(T)]},b.prototype.get=function(T){return T=h(T),this.has(T)?this.map[T]:null},b.prototype.has=function(T){return this.map.hasOwnProperty(h(T))},b.prototype.set=function(T,E){this.map[h(T)]=p(E)},b.prototype.forEach=function(T,E){for(var R in this.map)this.map.hasOwnProperty(R)&&T.call(E,this.map[R],R,this)},b.prototype.keys=function(){var T=[];return this.forEach(function(E,R){T.push(R)}),g(T)},b.prototype.values=function(){var T=[];return this.forEach(function(E){T.push(E)}),g(T)},b.prototype.entries=function(){var T=[];return this.forEach(function(E,R){T.push([R,E])}),g(T)},o.iterable&&(b.prototype[Symbol.iterator]=b.prototype.entries);function w(T){if(T.bodyUsed)return Promise.reject(new TypeError("Already read"));T.bodyUsed=!0}function O(T){return new Promise(function(E,R){T.onload=function(){E(T.result)},T.onerror=function(){R(T.error)}})}function C(T){var E=new FileReader,R=O(E);return E.readAsArrayBuffer(T),R}function k(T){var E=new FileReader,R=O(E);return E.readAsText(T),R}function j(T){for(var E=new Uint8Array(T),R=new Array(E.length),Z=0;Z<E.length;Z++)R[Z]=String.fromCharCode(E[Z]);return R.join("")}function S(T){if(T.slice)return T.slice(0);var E=new Uint8Array(T.byteLength);return E.set(new Uint8Array(T)),E.buffer}function U(){return this.bodyUsed=!1,this._initBody=function(T){this._bodyInit=T,T?typeof T=="string"?this._bodyText=T:o.blob&&Blob.prototype.isPrototypeOf(T)?this._bodyBlob=T:o.formData&&FormData.prototype.isPrototypeOf(T)?this._bodyFormData=T:o.searchParams&&URLSearchParams.prototype.isPrototypeOf(T)?this._bodyText=T.toString():o.arrayBuffer&&o.blob&&u(T)?(this._bodyArrayBuffer=S(T.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(T)||l(T))?this._bodyArrayBuffer=S(T):this._bodyText=T=Object.prototype.toString.call(T):this._bodyText="",this.headers.get("content-type")||(typeof T=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):o.searchParams&&URLSearchParams.prototype.isPrototypeOf(T)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o.blob&&(this.blob=function(){var T=w(this);if(T)return T;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?w(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(C)}),this.text=function(){var T=w(this);if(T)return T;if(this._bodyBlob)return k(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(j(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o.formData&&(this.formData=function(){return this.text().then(re)}),this.json=function(){return this.text().then(JSON.parse)},this}var J=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function ee(T){var E=T.toUpperCase();return J.indexOf(E)>-1?E:T}function Y(T,E){E=E||{};var R=E.body;if(T instanceof Y){if(T.bodyUsed)throw new TypeError("Already read");this.url=T.url,this.credentials=T.credentials,E.headers||(this.headers=new b(T.headers)),this.method=T.method,this.mode=T.mode,this.signal=T.signal,!R&&T._bodyInit!=null&&(R=T._bodyInit,T.bodyUsed=!0)}else this.url=String(T);if(this.credentials=E.credentials||this.credentials||"same-origin",(E.headers||!this.headers)&&(this.headers=new b(E.headers)),this.method=ee(E.method||this.method||"GET"),this.mode=E.mode||this.mode||null,this.signal=E.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&R)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(R)}Y.prototype.clone=function(){return new Y(this,{body:this._bodyInit})};function re(T){var E=new FormData;return T.trim().split("&").forEach(function(R){if(R){var Z=R.split("="),H=Z.shift().replace(/\+/g," "),A=Z.join("=").replace(/\+/g," ");E.append(decodeURIComponent(H),decodeURIComponent(A))}}),E}function G(T){var E=new b,R=T.replace(/\r?\n[\t ]+/g," ");return R.split(/\r?\n/).forEach(function(Z){var H=Z.split(":"),A=H.shift().trim();if(A){var F=H.join(":").trim();E.append(A,F)}}),E}U.call(Y.prototype);function q(T,E){E||(E={}),this.type="default",this.status=E.status===void 0?200:E.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in E?E.statusText:"OK",this.headers=new b(E.headers),this.url=E.url||"",this._initBody(T)}U.call(q.prototype),q.prototype.clone=function(){return new q(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new b(this.headers),url:this.url})},q.error=function(){var T=new q(null,{status:0,statusText:""});return T.type="error",T};var Q=[301,302,303,307,308];q.redirect=function(T,E){if(Q.indexOf(E)===-1)throw new RangeError("Invalid status code");return new q(null,{status:E,headers:{location:T}})},a.DOMException=i.DOMException;try{new a.DOMException}catch{a.DOMException=function(E,R){this.message=E,this.name=R;var Z=Error(E);this.stack=Z.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function X(T,E){return new Promise(function(R,Z){var H=new Y(T,E);if(H.signal&&H.signal.aborted)return Z(new a.DOMException("Aborted","AbortError"));var A=new XMLHttpRequest;function F(){A.abort()}A.onload=function(){var $={status:A.status,statusText:A.statusText,headers:G(A.getAllResponseHeaders()||"")};$.url="responseURL"in A?A.responseURL:$.headers.get("X-Request-URL");var ae="response"in A?A.response:A.responseText;R(new q(ae,$))},A.onerror=function(){Z(new TypeError("Network request failed"))},A.ontimeout=function(){Z(new TypeError("Network request failed"))},A.onabort=function(){Z(new a.DOMException("Aborted","AbortError"))},A.open(H.method,H.url,!0),H.credentials==="include"?A.withCredentials=!0:H.credentials==="omit"&&(A.withCredentials=!1),"responseType"in A&&o.blob&&(A.responseType="blob"),H.headers.forEach(function($,ae){A.setRequestHeader(ae,$)}),H.signal&&(H.signal.addEventListener("abort",F),A.onreadystatechange=function(){A.readyState===4&&H.signal.removeEventListener("abort",F)}),A.send(typeof H._bodyInit>"u"?null:H._bodyInit)})}return X.polyfill=!0,i.fetch||(i.fetch=X,i.Headers=b,i.Request=Y,i.Response=q),a.Headers=b,a.Request=Y,a.Response=q,a.fetch=X,Object.defineProperty(a,"__esModule",{value:!0}),a})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var s=r;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,n.exports=e})(Gn,Gn.exports);var gs=Gn.exports;const ys=or(gs),xr=dc({__proto__:null,default:ys},[gs]);class Lu{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=ys:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,u;let c=null,l=null,h=null,p=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const C=await i.text();C===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?l=C:l=JSON.parse(C))}const w=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),O=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");w&&O&&O.length>1&&(h=parseInt(O[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(l)&&(l.length>1?(c={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,h=null,p=406,g="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{const w=await i.text();try{c=JSON.parse(w),Array.isArray(c)&&i.status===404&&(l=[],c=null,p=200,g="OK")}catch{i.status===404&&w===""?(p=204,g="No Content"):c={message:w}}if(c&&this.isMaybeSingle&&(!((u=c==null?void 0:c.details)===null||u===void 0)&&u.includes("Results contain 0 rows"))&&(c=null,p=200,g="OK"),c&&this.shouldThrowOnError)throw c}return{error:c,data:l,count:h,status:p,statusText:g}});return this.shouldThrowOnError||(s=s.catch(i=>{var a,o,u;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(u=i==null?void 0:i.code)!==null&&u!==void 0?u:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}}class Uu extends Lu{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s}={}){const i=s?`${s}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){const r=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){const s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:a="text"}={}){const o=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${u}"; options=${o};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class pt extends Uu{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=t.map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const a=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){const r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class Mu{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),r&&(this.headers.Prefer=`count=${r}`),new pt({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const a=e.reduce((o,u)=>o.concat(Object.keys(u)),[]);if(a.length>0){const o=[...new Set(a)].map(u=>`"${u}"`);this.url.searchParams.set("columns",o.join(","))}}return new pt({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const a="POST",o=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),s&&o.push(`count=${s}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const u=e.reduce((c,l)=>c.concat(Object.keys(l)),[]);if(u.length>0){const c=[...new Set(u)].map(l=>`"${l}"`);this.url.searchParams.set("columns",c.join(","))}}return new pt({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new pt({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new pt({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Fu="1.7.1",Zu={"X-Client-Info":`postgrest-js/${Fu}`};class Vu{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Zu),t),this.schema=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new Mu(t,{headers:Object.assign({},this.headers),schema:this.schema,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:s}={}){let i;const a=new URL(`${this.url}/rpc/${e}`);let o;r?(i="HEAD",Object.entries(t).forEach(([c,l])=>{a.searchParams.append(c,`${l}`)})):(i="POST",o=t);const u=Object.assign({},this.headers);return s&&(u.Prefer=`count=${s}`),new pt({method:i,url:a,headers:u,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}}var hn,Qs;function Bu(){if(Qs)return hn;Qs=1;var n=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return hn=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}(),hn}const qu="websocket",zu="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",Hu=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],Ku="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",Ju=["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],Gu="1.0.34",Wu={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},Yu="https://github.com/theturtle32/WebSocket-Node",Qu={node:">=4.0.0"},Xu={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},el={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},tl={verbose:!1},rl={test:"tape test/unit/*.js",gulp:"gulp"},nl="index",sl={lib:"./lib"},il="lib/browser.js",al="Apache-2.0",ol={name:qu,description:zu,keywords:Hu,author:Ku,contributors:Ju,version:Gu,repository:Wu,homepage:Yu,engines:Qu,dependencies:Xu,devDependencies:el,config:tl,scripts:rl,main:nl,directories:sl,browser:il,license:al};var cl=ol.version,We;if(typeof globalThis=="object")We=globalThis;else try{We=Bu()}catch{}finally{if(!We&&typeof window<"u"&&(We=window),!We)throw new Error("Could not determine global this")}var er=We.WebSocket||We.MozWebSocket,ul=cl;function Pa(n,e){var t;return e?t=new er(n,e):t=new er(n),t}er&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(Pa,n,{get:function(){return er[n]}})});var ll={w3cwebsocket:er?Pa:null,version:ul};const dl="2.7.3",hl={"X-Client-Info":`realtime-js/${dl}`},fl="1.0.0",Ea=1e4,pl=1e3;var Yt;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Yt||(Yt={}));var pe;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(pe||(pe={}));var we;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(we||(we={}));var Wn;(function(n){n.websocket="websocket"})(Wn||(Wn={}));var Ye;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Ye||(Ye={}));class Aa{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class ml{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(e.slice(a,a+s));a=a+s;const u=r.decode(e.slice(a,a+i));a=a+i;const c=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:u,payload:c}}}class fn{constructor(e,t,r={},s=Ea){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Xs;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Xs||(Xs={}));class Qt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Qt.syncState(this.state,s,i,a),this.pendingDiffs.forEach(u=>{this.state=Qt.syncDiff(this.state,u,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Qt.syncDiff(this.state,s,i,a),o())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),a=this.transformState(t),o={},u={};return this.map(i,(c,l)=>{a[c]||(u[c]=l)}),this.map(a,(c,l)=>{const h=i[c];if(h){const p=l.map(O=>O.presence_ref),g=h.map(O=>O.presence_ref),b=l.filter(O=>g.indexOf(O.presence_ref)<0),w=h.filter(O=>p.indexOf(O.presence_ref)<0);b.length>0&&(o[c]=b),w.length>0&&(u[c]=w)}else o[c]=l}),this.syncDiff(i,{joins:o,leaves:u},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(o,u)=>{var c;const l=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(u),l.length>0){const h=e[o].map(g=>g.presence_ref),p=l.filter(g=>h.indexOf(g.presence_ref)<0);e[o].unshift(...p)}r(o,l,u)}),this.map(a,(o,u)=>{let c=e[o];if(!c)return;const l=u.map(h=>h.presence_ref);c=c.filter(h=>l.indexOf(h.presence_ref)<0),e[o]=c,s(o,c,u),c.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var K;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(K||(K={}));const ei=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,a)=>(i[a]=gl(a,n,e,s),i),{})},gl=(n,e,t,r)=>{const s=e.find(o=>o.name===n),i=s==null?void 0:s.type,a=t[n];return i&&!r.includes(i)?Sa(i,a):Yn(a)},Sa=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return _l(e,t)}switch(n){case K.bool:return yl(e);case K.float4:case K.float8:case K.int2:case K.int4:case K.int8:case K.numeric:case K.oid:return vl(e);case K.json:case K.jsonb:return bl(e);case K.timestamp:return wl(e);case K.abstime:case K.date:case K.daterange:case K.int4range:case K.int8range:case K.money:case K.reltime:case K.text:case K.time:case K.timestamptz:case K.timetz:case K.tsrange:case K.tstzrange:return Yn(e);default:return Yn(e)}},Yn=n=>n,yl=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},vl=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},bl=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},_l=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const a=n.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>Sa(e,o))}return n},wl=n=>typeof n=="string"?n.replace(" ","T"):n;var ti=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})},ri;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(ri||(ri={}));var ni;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes"})(ni||(ni={}));var si;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(si||(si={}));class vs{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=pe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new fn(this,we.join,this.params,this.timeout),this.rejoinTimer=new Aa(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=pe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=pe.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=pe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=pe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(we.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new Qt(this)}subscribe(e,t=this.timeout){var r,s;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a}}=this.params;this._onError(c=>e&&e("CHANNEL_ERROR",c)),this._onClose(()=>e&&e("CLOSED"));const o={},u={broadcast:i,presence:a,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(c=>c.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(o.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:u},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:c})=>{var l;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),c===void 0){e&&e("SUBSCRIBED");return}else{const h=this.bindings.postgres_changes,p=(l=h==null?void 0:h.length)!==null&&l!==void 0?l:0,g=[];for(let b=0;b<p;b++){const w=h[b],{filter:{event:O,schema:C,table:k,filter:j}}=w,S=c&&c[b];if(S&&S.event===O&&S.schema===C&&S.table===k&&S.filter===j)g.push(Object.assign(Object.assign({},w),{id:S.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e("SUBSCRIBED");return}}).receive("error",c=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(e,t={}){return ti(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(e={}){return ti(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this._on(e,t,r)}send(e,t={}){return new Promise(r=>{var s,i,a;const o=this._push(e.type,e,t.timeout||this.timeout);o.rateLimited&&r("rate limited"),e.type==="broadcast"&&!(!((a=(i=(s=this.params)===null||s===void 0?void 0:s.config)===null||i===void 0?void 0:i.broadcast)===null||a===void 0)&&a.ack)&&r("ok"),o.receive("ok",()=>r("ok")),o.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=pe.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(we.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new fn(this,we.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new fn(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const a=e.toLocaleLowerCase(),{close:o,error:u,leave:c,join:l}=we;if(r&&[o,u,c,l].indexOf(a)>=0&&r!==this._joinRef())return;let p=this._onMessage(a,t,r);if(t&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(g=>{var b,w,O;return((b=g.filter)===null||b===void 0?void 0:b.event)==="*"||((O=(w=g.filter)===null||w===void 0?void 0:w.event)===null||O===void 0?void 0:O.toLocaleLowerCase())===a}).map(g=>g.callback(p,r)):(i=this.bindings[a])===null||i===void 0||i.filter(g=>{var b,w,O,C,k,j;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in g){const S=g.id,U=(b=g.filter)===null||b===void 0?void 0:b.event;return S&&((w=t.ids)===null||w===void 0?void 0:w.includes(S))&&(U==="*"||(U==null?void 0:U.toLocaleLowerCase())===((O=t.data)===null||O===void 0?void 0:O.type.toLocaleLowerCase()))}else{const S=(k=(C=g==null?void 0:g.filter)===null||C===void 0?void 0:C.event)===null||k===void 0?void 0:k.toLocaleLowerCase();return S==="*"||S===((j=t==null?void 0:t.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===a}).map(g=>{if(typeof p=="object"&&"ids"in p){const b=p.data,{schema:w,table:O,commit_timestamp:C,type:k,errors:j}=b;p=Object.assign(Object.assign({},{schema:w,table:O,commit_timestamp:C,eventType:k,new:{},old:{},errors:j}),this._getPayloadRecords(b))}g.callback(p,r)})}_isClosed(){return this.state===pe.closed}_isJoined(){return this.state===pe.joined}_isJoining(){return this.state===pe.joining}_isLeaving(){return this.state===pe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&vs.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(we.close,{},e)}_onError(e){this._on(we.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=pe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ei(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ei(e.columns,e.old_record)),t}}var pn=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const Ol=()=>{};class Tl{constructor(e,t){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=hl,this.params={},this.timeout=Ea,this.transport=ll.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ol,this.conn=null,this.sendBuffer=[],this.serializer=new ml,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${Wn.websocket}`,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.transport&&(this.transport=t.transport),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.eventsPerSecond;s&&(this.eventsPerSecondLimitMs=Math.floor(1e3/s)),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Aa(()=>pn(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return pn(this,void 0,void 0,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return pn(this,void 0,void 0,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Yt.connecting:return Ye.Connecting;case Yt.open:return Ye.Open;case Yt.closing:return Ye.Closing;default:return Ye.Closed}}isConnected(){return this.connectionState()===Ye.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();const r=new vs(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e;let a=()=>{this.encode(e,o=>{var u;(u=this.conn)===null||u===void 0||u.send(o)})};if(this.log("push",`${t} ${r} (${i})`,s),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(r)){if(this._throttle(a)())return"rate limited"}else a();else this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(we.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:fl}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:a}=t;(a&&a===this.pendingHeartbeatRef||s===(i==null?void 0:i.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(r)).forEach(o=>o._trigger(s,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(we.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(pl,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}}class bs extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ce(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Pl extends bs{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ii extends bs{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ia=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const Ca=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ia(void 0,void 0,void 0,function*(){return yield(yield Pt(()=>Promise.resolve().then(()=>xr),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)},El=()=>Ia(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Pt(()=>Promise.resolve().then(()=>xr),void 0)).Response:Response});var Et=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const mn=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Al=(n,e)=>Et(void 0,void 0,void 0,function*(){const t=yield El();n instanceof t?n.json().then(r=>{e(new Pl(mn(r),n.status||500))}).catch(r=>{e(new ii(mn(r),r))}):e(new ii(mn(n),n))}),Sl=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function Dr(n,e,t,r,s,i){return Et(this,void 0,void 0,function*(){return new Promise((a,o)=>{n(t,Sl(e,r,s,i)).then(u=>{if(!u.ok)throw u;return r!=null&&r.noResolveJson?u:u.json()}).then(u=>a(u)).catch(u=>Al(u,o))})})}function Qn(n,e,t,r){return Et(this,void 0,void 0,function*(){return Dr(n,"GET",e,t,r)})}function Me(n,e,t,r,s){return Et(this,void 0,void 0,function*(){return Dr(n,"POST",e,r,s,t)})}function Il(n,e,t,r,s){return Et(this,void 0,void 0,function*(){return Dr(n,"PUT",e,r,s,t)})}function ja(n,e,t,r,s){return Et(this,void 0,void 0,function*(){return Dr(n,"DELETE",e,r,s,t)})}var me=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const Cl={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ai={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class jl{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Ca(s)}uploadOrUpdate(e,t,r,s){return me(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},ai),s),o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",a.cacheControl)):(i=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType);const u=this._removeEmptyFolders(t),c=this._getFinalPath(u),l=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:i,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{}));return l.ok?{data:{path:u},error:null}:{data:null,error:yield l.json()}}catch(i){if(ce(i))return{data:null,error:i};throw i}})}upload(e,t,r){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return me(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let u;const c=Object.assign({upsert:ai.upsert},s),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(u=new FormData,u.append("cacheControl",c.cacheControl),u.append("",r)):typeof FormData<"u"&&r instanceof FormData?(u=r,u.append("cacheControl",c.cacheControl)):(u=r,l["cache-control"]=`max-age=${c.cacheControl}`,l["content-type"]=c.contentType);const h=yield this.fetch(o.toString(),{method:"PUT",body:u,headers:l});return h.ok?{data:{path:i},error:null}:{data:null,error:yield h.json()}}catch(u){if(ce(u))return{data:null,error:u};throw u}})}createSignedUploadUrl(e){return me(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield Me(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+r.url),i=s.searchParams.get("token");if(!i)throw new bs("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:i},error:null}}catch(t){if(ce(t))return{data:null,error:t};throw t}})}update(e,t,r){return me(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return me(this,void 0,void 0,function*(){try{return{data:yield Me(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(ce(r))return{data:null,error:r};throw r}})}copy(e,t){return me(this,void 0,void 0,function*(){try{return{data:{path:(yield Me(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(ce(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return me(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Me(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(s){if(ce(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return me(this,void 0,void 0,function*(){try{const s=yield Me(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(s){if(ce(s))return{data:null,error:s};throw s}})}download(e,t){return me(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield Qn(this.fetch,`${this.url}/${s}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(ce(o))return{data:null,error:o};throw o}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",u=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});u!==""&&s.push(u);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${c}`)}}}remove(e){return me(this,void 0,void 0,function*(){try{return{data:yield ja(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(ce(t))return{data:null,error:t};throw t}})}list(e,t,r){return me(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Cl),t),{prefix:e||""});return{data:yield Me(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(ce(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const kl="2.5.1",Rl={"X-Client-Info":`storage-js/${kl}`};var ct=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};class xl{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Rl),t),this.fetch=Ca(r)}listBuckets(){return ct(this,void 0,void 0,function*(){try{return{data:yield Qn(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(ce(e))return{data:null,error:e};throw e}})}getBucket(e){return ct(this,void 0,void 0,function*(){try{return{data:yield Qn(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(ce(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ct(this,void 0,void 0,function*(){try{return{data:yield Me(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(ce(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ct(this,void 0,void 0,function*(){try{return{data:yield Il(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(ce(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ct(this,void 0,void 0,function*(){try{return{data:yield Me(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(ce(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ct(this,void 0,void 0,function*(){try{return{data:yield ja(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(ce(t))return{data:null,error:t};throw t}})}}class Dl extends xl{constructor(e,t={},r){super(e,t,r)}from(e){return new jl(this.url,this.headers,e,this.fetch)}}const $l="2.26.0",Nl={"X-Client-Info":`supabase-js/${$l}`};var Ll=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const Ul=n=>{let e;return n?e=n:typeof fetch>"u"?e=ys:e=fetch,(...t)=>e(...t)},Ml=()=>typeof Headers>"u"?gs.Headers:Headers,Fl=(n,e,t)=>{const r=Ul(t),s=Ml();return(i,a)=>Ll(void 0,void 0,void 0,function*(){var o;const u=(o=yield e())!==null&&o!==void 0?o:n;let c=new s(a==null?void 0:a.headers);return c.has("apikey")||c.set("apikey",n),c.has("Authorization")||c.set("Authorization",`Bearer ${u}`),r(i,Object.assign(Object.assign({},a),{headers:c}))})};function Zl(n){return n.replace(/\/$/,"")}function Vl(n,e){const{db:t,auth:r,realtime:s,global:i}=n,{db:a,auth:o,realtime:u,global:c}=e;return{db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),r),realtime:Object.assign(Object.assign({},u),s),global:Object.assign(Object.assign({},c),i)}}var nt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};function Bl(n){return Math.round(Date.now()/1e3)+n}function ql(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const Ue=()=>typeof document<"u",He={tested:!1,writable:!1},Er=()=>{if(!Ue())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(He.tested)return He.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),He.tested=!0,He.writable=!0}catch{He.tested=!0,He.writable=!1}return He.writable};function ue(n,e){var t;e||(e=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.href)||""),n=n.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+n+"(=([^&#]*)|&|#|$)"),s=r.exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}const ka=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>nt(void 0,void 0,void 0,function*(){return yield(yield Pt(()=>Promise.resolve().then(()=>xr),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)},zl=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Dt=(n,e,t)=>nt(void 0,void 0,void 0,function*(){yield n.setItem(e,JSON.stringify(t))}),gr=(n,e)=>nt(void 0,void 0,void 0,function*(){const t=yield n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}}),gn=(n,e)=>nt(void 0,void 0,void 0,function*(){yield n.removeItem(e)});function Hl(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,i,a,o,u,c,l=0;for(n=n.replace("-","+").replace("_","/");l<n.length;)a=e.indexOf(n.charAt(l++)),o=e.indexOf(n.charAt(l++)),u=e.indexOf(n.charAt(l++)),c=e.indexOf(n.charAt(l++)),r=a<<2|o>>4,s=(o&15)<<4|u>>2,i=(u&3)<<6|c,t=t+String.fromCharCode(r),u!=64&&s!=0&&(t=t+String.fromCharCode(s)),c!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class $r{constructor(){this.promise=new $r.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}$r.promiseConstructor=Promise;function oi(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(Hl(r))}function Kl(n){return new Promise(e=>{setTimeout(()=>e(null),n)})}function Jl(n,e){return new Promise((r,s)=>{nt(this,void 0,void 0,function*(){for(let i=0;i<1/0;i++)try{const a=yield n(i);if(!e(i,null,a)){r(a);return}}catch(a){if(!e(i,a)){s(a);return}}})})}function Gl(n){return("0"+n.toString(16)).substr(-2)}function yr(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,Gl).join("")}function Wl(n){return nt(this,void 0,void 0,function*(){const t=new TextEncoder().encode(n),r=yield crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")})}function Yl(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function vr(n){return nt(this,void 0,void 0,function*(){if(typeof crypto>"u")return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const e=yield Wl(n);return Yl(e)})}class _s extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function V(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Ql extends _s{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function Xl(n){return V(n)&&n.name==="AuthApiError"}class Ra extends _s{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class At extends _s{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ut extends At{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class yn extends At{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class br extends At{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class ke extends At{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class vn extends At{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Xn extends At{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}var ws=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})},ed=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const _r=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),td=(n,e)=>ws(void 0,void 0,void 0,function*(){const t=[502,503,504];zl(n)?t.includes(n.status)?e(new Xn(_r(n),n.status)):n.json().then(r=>{e(new Ql(_r(r),n.status||500))}).catch(r=>{e(new Ra(_r(r),r))}):e(new Xn(_r(n),0))}),rd=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function B(n,e,t,r){var s;return ws(this,void 0,void 0,function*(){const i=Object.assign({},r==null?void 0:r.headers);r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",u=yield nd(n,e,t+o,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(u):{data:Object.assign({},u),error:null}})}function nd(n,e,t,r,s,i){return ws(this,void 0,void 0,function*(){return new Promise((a,o)=>{n(t,rd(e,r,s,i)).then(u=>{if(!u.ok)throw u;return r!=null&&r.noResolveJson?u:u.json()}).then(u=>a(u)).catch(u=>td(u,o))})})}function $e(n){var e;let t=null;od(n)&&(t=Object.assign({},n),t.expires_at=Bl(n.expires_in));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Qe(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function sd(n){return{data:n,error:null}}function id(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,a=ed(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},u=Object.assign({},a);return{data:{properties:o,user:u},error:null}}function ad(n){return n}function od(n){return n.access_token&&n.refresh_token&&n.expires_in}var Pe=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})},cd=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class ud{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=ka(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e){return Pe(this,void 0,void 0,function*(){try{return yield B(this.fetch,"POST",`${this.url}/logout`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(t){if(V(t))return{data:null,error:t};throw t}})}inviteUserByEmail(e,t={}){return Pe(this,void 0,void 0,function*(){try{return yield B(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Qe})}catch(r){if(V(r))return{data:{user:null},error:r};throw r}})}generateLink(e){return Pe(this,void 0,void 0,function*(){try{const{options:t}=e,r=cd(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),yield B(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:id,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(V(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return Pe(this,void 0,void 0,function*(){try{return yield B(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Qe})}catch(t){if(V(t))return{data:{user:null},error:t};throw t}})}listUsers(e){var t,r,s,i,a,o,u;return Pe(this,void 0,void 0,function*(){try{const c={nextPage:null,lastPage:0,total:0},l=yield B(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:ad});if(l.error)throw l.error;const h=yield l.json(),p=(a=l.headers.get("x-total-count"))!==null&&a!==void 0?a:0,g=(u=(o=l.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&u!==void 0?u:[];return g.length>0&&(g.forEach(b=>{const w=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),O=JSON.parse(b.split(";")[1].split("=")[1]);c[`${O}Page`]=w}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(V(c))return{data:{users:[]},error:c};throw c}})}getUserById(e){return Pe(this,void 0,void 0,function*(){try{return yield B(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Qe})}catch(t){if(V(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return Pe(this,void 0,void 0,function*(){try{return yield B(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Qe})}catch(r){if(V(r))return{data:{user:null},error:r};throw r}})}deleteUser(e,t=!1){return Pe(this,void 0,void 0,function*(){try{return yield B(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Qe})}catch(r){if(V(r))return{data:{user:null},error:r};throw r}})}_listFactors(e){return Pe(this,void 0,void 0,function*(){try{const{data:t,error:r}=yield B(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(V(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return Pe(this,void 0,void 0,function*(){try{return{data:yield B(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(V(t))return{data:null,error:t};throw t}})}}const ld="2.31.0",dd="http://localhost:9999",hd="supabase.auth.token",fd={"X-Client-Info":`gotrue-js/${ld}`},pd=10,ci={getItem:n=>Er()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Er()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Er()&&globalThis.localStorage.removeItem(n)}};function md(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var N=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};md();const gd={url:dd,storageKey:hd,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:fd,flowType:"implicit"},bn=30*1e3,yd=3;class vd{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null;const r=Object.assign(Object.assign({},gd),e);if(this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||ci,this.admin=new ud({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=ka(r.fetch),this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===ci&&!Er()&&console.warn(`No storage option exists to persist the session, which may result in unexpected behavior when using auth.
        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning.`),Ue()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(t=this.broadcastChannel)===null||t===void 0||t.addEventListener("message",s=>N(this,void 0,void 0,function*(){yield this._notifyAllSubscribers(s.data.event,s.data.session,!1)}))}this.initialize()}initialize(){return this.initializePromise||(this.initializePromise=this._initialize()),this.initializePromise}_initialize(){return N(this,void 0,void 0,function*(){if(this.initializePromise)return this.initializePromise;try{const e=Ue()?yield this._isPKCEFlow():!1;if(e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=yield this._getSessionFromUrl(e);if(r)return yield this._removeSession(),{error:r};const{session:s,redirectType:i}=t;return yield this._saveSession(s),setTimeout(()=>N(this,void 0,void 0,function*(){i==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",s):yield this._notifyAllSubscribers("SIGNED_IN",s)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(e){return V(e)?{error:e}:{error:new Ra("Unexpected error during initialization",e)}}finally{yield this._handleVisibilityChange()}})}signUp(e){var t,r,s;return N(this,void 0,void 0,function*(){try{yield this._removeSession();let i;if("email"in e){const{email:l,password:h,options:p}=e;let g=null,b=null;if(this.flowType==="pkce"){const w=yr();yield Dt(this.storage,`${this.storageKey}-code-verifier`,w),g=yield vr(w),b=w===g?"plain":"s256"}i=yield B(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:l,password:h,data:(t=p==null?void 0:p.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:g,code_challenge_method:b},xform:$e})}else if("phone"in e){const{phone:l,password:h,options:p}=e;i=yield B(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:l,password:h,data:(r=p==null?void 0:p.data)!==null&&r!==void 0?r:{},channel:(s=p==null?void 0:p.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:$e})}else throw new br("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const u=a.session,c=a.user;return a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:c,session:u},error:null}}catch(i){if(V(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithPassword(e){return N(this,void 0,void 0,function*(){try{yield this._removeSession();let t;if("email"in e){const{email:i,password:a,options:o}=e;t=yield B(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:$e})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=yield B(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:$e})}else throw new br("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new yn}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:s})}catch(t){if(V(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){var t,r,s,i;return N(this,void 0,void 0,function*(){return yield this._removeSession(),yield this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})})}exchangeCodeForSession(e){return N(this,void 0,void 0,function*(){const t=yield gr(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:s}=yield B(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:$e});return yield gn(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new yn}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s})})}signInWithIdToken(e){return N(this,void 0,void 0,function*(){yield this._removeSession();try{const{options:t,provider:r,token:s,nonce:i}=e,a=yield B(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,nonce:i,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:$e}),{data:o,error:u}=a;return u?{data:{user:null,session:null},error:u}:!o||!o.session||!o.user?{data:{user:null,session:null},error:new yn}:(o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:u})}catch(t){if(V(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){var t,r,s,i,a;return N(this,void 0,void 0,function*(){try{if(yield this._removeSession(),"email"in e){const{email:o,options:u}=e;let c=null,l=null;if(this.flowType==="pkce"){const p=yr();yield Dt(this.storage,`${this.storageKey}-code-verifier`,p),c=yield vr(p),l=p===c?"plain":"s256"}const{error:h}=yield B(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=u==null?void 0:u.data)!==null&&t!==void 0?t:{},create_user:(r=u==null?void 0:u.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},code_challenge:c,code_challenge_method:l},redirectTo:u==null?void 0:u.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:u}=e,{data:c,error:l}=yield B(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=u==null?void 0:u.data)!==null&&s!==void 0?s:{},create_user:(i=u==null?void 0:u.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},channel:(a=u==null?void 0:u.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:l}}throw new br("You must provide either an email or phone number.")}catch(o){if(V(o))return{data:{user:null,session:null},error:o};throw o}})}verifyOtp(e){var t,r;return N(this,void 0,void 0,function*(){try{e.type!=="email_change"&&e.type!=="phone_change"&&(yield this._removeSession());const{data:s,error:i}=yield B(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:(t=e.options)===null||t===void 0?void 0:t.captchaToken}}),redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,xform:$e});if(i)throw i;if(!s)throw new Error("An error occurred on token verification.");const a=s.session,o=s.user;return a!=null&&a.access_token&&(yield this._saveSession(a),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:o,session:a},error:null}}catch(s){if(V(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithSSO(e){var t,r,s;return N(this,void 0,void 0,function*(){try{return yield this._removeSession(),yield B(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:sd})}catch(i){if(V(i))return{data:null,error:i};throw i}})}reauthenticate(){return N(this,void 0,void 0,function*(){try{const{data:{session:e},error:t}=yield this.getSession();if(t)throw t;if(!e)throw new ut;const{error:r}=yield B(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:r}}catch(e){if(V(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return N(this,void 0,void 0,function*(){try{yield this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:a}=yield B(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:a,error:o}=yield B(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new br("You must provide either an email or phone number and a type")}catch(t){if(V(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return N(this,void 0,void 0,function*(){yield this.initializePromise;let e=null;if(this.persistSession){const i=yield gr(this.storage,this.storageKey);i!==null&&(this._isValidSession(i)?e=i:yield this._removeSession())}else e=this.inMemorySession;if(!e)return{data:{session:null},error:null};if(!(e.expires_at?e.expires_at<=Date.now()/1e3:!1))return{data:{session:e},error:null};const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}})}getUser(e){var t,r;return N(this,void 0,void 0,function*(){try{if(!e){const{data:s,error:i}=yield this.getSession();if(i)throw i;e=(r=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:void 0}return yield B(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Qe})}catch(s){if(V(s))return{data:{user:null},error:s};throw s}})}updateUser(e,t={}){return N(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();if(s)throw s;if(!r.session)throw new ut;const i=r.session,{data:a,error:o}=yield B(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:e,jwt:i.access_token,xform:Qe});if(o)throw o;return i.user=a.user,yield this._saveSession(i),yield this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}catch(r){if(V(r))return{data:{user:null},error:r};throw r}})}_decodeJWT(e){return oi(e)}setSession(e){return N(this,void 0,void 0,function*(){try{if(!e.access_token||!e.refresh_token)throw new ut;const t=Date.now()/1e3;let r=t,s=!0,i=null;const a=oi(e.access_token);if(a.exp&&(r=a.exp,s=r<=t),s){const{session:o,error:u}=yield this._callRefreshToken(e.refresh_token);if(u)return{data:{user:null,session:null},error:u};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:u}=yield this.getUser(e.access_token);if(u)throw u;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(i),yield this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(V(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){var t;return N(this,void 0,void 0,function*(){try{if(!e){const{data:i,error:a}=yield this.getSession();if(a)throw a;e=(t=i.session)!==null&&t!==void 0?t:void 0}if(!(e!=null&&e.refresh_token))throw new ut;const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}catch(r){if(V(r))return{data:{user:null,session:null},error:r};throw r}})}_getSessionFromUrl(e){return N(this,void 0,void 0,function*(){try{if(!Ue())throw new ke("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new ke("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new vn("Not a valid PKCE flow url.");if(e){const O=ue("code");if(!O)throw new vn("No code detected.");const{data:C,error:k}=yield this.exchangeCodeForSession(O);if(k)throw k;if(!C.session)throw new vn("No session detected.");let j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:C.session,redirectType:null},error:null}}const t=ue("error_description");if(t){const O=ue("error_code");if(!O)throw new ke("No error_code detected.");const C=ue("error");throw C?new ke(t,{error:C,code:O}):new ke("No error detected.")}const r=ue("provider_token"),s=ue("provider_refresh_token"),i=ue("access_token");if(!i)throw new ke("No access_token detected.");const a=ue("expires_in");if(!a)throw new ke("No expires_in detected.");const o=ue("refresh_token");if(!o)throw new ke("No refresh_token detected.");const u=ue("token_type");if(!u)throw new ke("No token_type detected.");const l=Math.round(Date.now()/1e3)+parseInt(a),{data:h,error:p}=yield this.getUser(i);if(p)throw p;const g=h.user,b={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:parseInt(a),expires_at:l,refresh_token:o,token_type:u,user:g},w=ue("type");return window.location.hash="",{data:{session:b,redirectType:w},error:null}}catch(t){if(V(t))return{data:{session:null,redirectType:null},error:t};throw t}})}_isImplicitGrantFlow(){return Ue()&&(!!ue("access_token")||!!ue("error_description"))}_isPKCEFlow(){return N(this,void 0,void 0,function*(){const e=yield gr(this.storage,`${this.storageKey}-code-verifier`);return!!ue("code")&&!!e})}signOut(){var e;return N(this,void 0,void 0,function*(){const{data:t,error:r}=yield this.getSession();if(r)return{error:r};const s=(e=t.session)===null||e===void 0?void 0:e.access_token;if(s){const{error:i}=yield this.admin.signOut(s);if(i&&!(Xl(i)&&(i.status===404||i.status===401)))return{error:i}}return yield this._removeSession(),yield gn(this.storage,`${this.storageKey}-code-verifier`),yield this._notifyAllSubscribers("SIGNED_OUT",null),{error:null}})}onAuthStateChange(e){const t=ql(),r={id:t,callback:e,unsubscribe:()=>{this.stateChangeEmitters.delete(t)}};return this.stateChangeEmitters.set(t,r),this.emitInitialSession(t),{data:{subscription:r}}}emitInitialSession(e){var t,r;return N(this,void 0,void 0,function*(){try{const{data:{session:s},error:i}=yield this.getSession();if(i)throw i;yield(t=this.stateChangeEmitters.get(e))===null||t===void 0?void 0:t.callback("INITIAL_SESSION",s)}catch(s){yield(r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null),console.error(s)}})}resetPasswordForEmail(e,t={}){return N(this,void 0,void 0,function*(){let r=null,s=null;if(this.flowType==="pkce"){const i=yr();yield Dt(this.storage,`${this.storageKey}-code-verifier`,i),r=yield vr(i),s=i===r?"plain":"s256"}try{return yield B(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(V(i))return{data:null,error:i};throw i}})}_refreshAccessToken(e){return N(this,void 0,void 0,function*(){try{const t=Date.now();return yield Jl(r=>N(this,void 0,void 0,function*(){return yield Kl(r*200),yield B(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:$e})}),(r,s,i)=>i&&i.error&&i.error instanceof Xn&&Date.now()+(r+1)*200-t<bn)}catch(t){if(V(t))return{data:{session:null,user:null},error:t};throw t}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return N(this,void 0,void 0,function*(){const r=yield this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return Ue()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){var e;return N(this,void 0,void 0,function*(){try{const t=yield gr(this.storage,this.storageKey);if(!this._isValidSession(t)){t!==null&&(yield this._removeSession());return}const r=Math.round(Date.now()/1e3);if(((e=t.expires_at)!==null&&e!==void 0?e:1/0)<r+pd){if(this.autoRefreshToken&&t.refresh_token){const{error:s}=yield this._callRefreshToken(t.refresh_token);s&&(console.log(s.message),yield this._removeSession())}}else this.persistSession&&(yield this._saveSession(t)),yield this._notifyAllSubscribers("SIGNED_IN",t)}catch(t){console.error(t);return}})}_callRefreshToken(e){var t,r;return N(this,void 0,void 0,function*(){if(this.refreshingDeferred)return this.refreshingDeferred.promise;try{if(this.refreshingDeferred=new $r,!e)throw new ut;const{data:s,error:i}=yield this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new ut;yield this._saveSession(s.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(V(s)){const i={session:null,error:s};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(i),i}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null}})}_notifyAllSubscribers(e,t,r=!0){return N(this,void 0,void 0,function*(){this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],i=Array.from(this.stateChangeEmitters.values()).map(a=>N(this,void 0,void 0,function*(){try{yield a.callback(e,t)}catch(o){s.push(o)}}));if(yield Promise.all(i),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}})}_saveSession(e){return N(this,void 0,void 0,function*(){this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&(yield this._persistSession(e))})}_persistSession(e){return Dt(this.storage,this.storageKey,e)}_removeSession(){return N(this,void 0,void 0,function*(){this.persistSession?yield gn(this.storage,this.storageKey):this.inMemorySession=null})}_removeVisibilityChangedCallback(){const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ue()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return N(this,void 0,void 0,function*(){yield this._stopAutoRefresh();const e=setInterval(()=>this._autoRefreshTokenTick(),bn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),yield this._autoRefreshTokenTick()})}_stopAutoRefresh(){return N(this,void 0,void 0,function*(){const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return N(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return N(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return N(this,void 0,void 0,function*(){const e=Date.now();try{const{data:{session:t}}=yield this.getSession();if(!t||!t.refresh_token||!t.expires_at)return;Math.floor((t.expires_at*1e3-e)/bn)<yd&&(yield this._callRefreshToken(t.refresh_token))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}})}_handleVisibilityChange(){return N(this,void 0,void 0,function*(){if(!Ue()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>N(this,void 0,void 0,function*(){return yield this._onVisibilityChanged(!1)}),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return N(this,void 0,void 0,function*(){document.visibilityState==="visible"?(e||(yield this.initializePromise,yield this._recoverAndRefresh()),this.autoRefreshToken&&this._startAutoRefresh()):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t){return N(this,void 0,void 0,function*(){const r=[`provider=${encodeURIComponent(e)}`];if(t!=null&&t.redirectTo&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t!=null&&t.scopes&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),this.flowType==="pkce"){const s=yr();yield Dt(this.storage,`${this.storageKey}-code-verifier`,s);const i=yield vr(s),a=s===i?"plain":"s256",o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});r.push(o.toString())}if(t!=null&&t.queryParams){const s=new URLSearchParams(t.queryParams);r.push(s.toString())}return`${this.url}/authorize?${r.join("&")}`})}_unenroll(e){var t;return N(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();return s?{data:null,error:s}:yield B(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(V(r))return{data:null,error:r};throw r}})}_enroll(e){var t,r;return N(this,void 0,void 0,function*(){try{const{data:s,error:i}=yield this.getSession();if(i)return{data:null,error:i};const{data:a,error:o}=yield B(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(t=s==null?void 0:s.session)===null||t===void 0?void 0:t.access_token});return o?{data:null,error:o}:(!((r=a==null?void 0:a.totp)===null||r===void 0)&&r.qr_code&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}catch(s){if(V(s))return{data:null,error:s};throw s}})}_verify(e){var t;return N(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();if(s)return{data:null,error:s};const{data:i,error:a}=yield B(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token});return a?{data:null,error:a}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})}catch(r){if(V(r))return{data:null,error:r};throw r}})}_challenge(e){var t;return N(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();return s?{data:null,error:s}:yield B(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(V(r))return{data:null,error:r};throw r}})}_challengeAndVerify(e){return N(this,void 0,void 0,function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return N(this,void 0,void 0,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(i=>i.factor_type==="totp"&&i.status==="verified");return{data:{all:r,totp:s},error:null}})}_getAuthenticatorAssuranceLevel(){var e,t;return N(this,void 0,void 0,function*(){const{data:{session:r},error:s}=yield this.getSession();if(s)return{data:null,error:s};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const i=this._decodeJWT(r.access_token);let a=null;i.aal&&(a=i.aal);let o=a;((t=(e=r.user.factors)===null||e===void 0?void 0:e.filter(l=>l.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(o="aal2");const c=i.amr||[];return{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:c},error:null}})}}class bd extends vd{constructor(e){super(e)}}var _d=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};const wd={headers:Nl},Od={schema:"public"},Td={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Pd={};class Ed{constructor(e,t,r){var s,i,a,o,u,c,l,h;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const p=Zl(e);this.realtimeUrl=`${p}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${p}/auth/v1`,this.storageUrl=`${p}/storage/v1`,this.functionsUrl=`${p}/functions/v1`;const g=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,b={db:Od,realtime:Pd,auth:Object.assign(Object.assign({},Td),{storageKey:g}),global:wd},w=Vl(r??{},b);this.storageKey=(i=(s=w.auth)===null||s===void 0?void 0:s.storageKey)!==null&&i!==void 0?i:"",this.headers=(o=(a=w.global)===null||a===void 0?void 0:a.headers)!==null&&o!==void 0?o:{},this.auth=this._initSupabaseAuthClient((u=w.auth)!==null&&u!==void 0?u:{},this.headers,(c=w.global)===null||c===void 0?void 0:c.fetch),this.fetch=Fl(t,this._getAccessToken.bind(this),(l=w.global)===null||l===void 0?void 0:l.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},w.realtime)),this.rest=new Vu(`${p}/rest/v1`,{headers:this.headers,schema:(h=w.db)===null||h===void 0?void 0:h.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Nu(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Dl(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return _d(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:a},o,u){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new bd({url:this.authUrl,headers:Object.assign(Object.assign({},c),o),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:a,fetch:u})}_initRealtimeClient(e){return new Tl(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const xa=(n,e,t)=>new Ed(n,e,t),Ad=(n,e)=>(n=n.replace(new RegExp("((?<![\\p{Uppercase_Letter}\\d])[\\p{Uppercase_Letter}\\d](?![\\p{Uppercase_Letter}\\d]))","gu"),t=>t.toLowerCase()),n.replace(/(\p{Uppercase_Letter}+)(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,(t,r,s)=>r+e+s.toLowerCase()));var Sd=(n,{separator:e="_",preserveConsecutiveUppercase:t=!1}={})=>{if(!(typeof n=="string"&&typeof e=="string"))throw new TypeError("The `text` and `separator` arguments should be of type `string`");if(n.length<2)return t?n:n.toLowerCase();const r=`$1${e}$2`,s=n.replace(/([\p{Lowercase_Letter}\d])(\p{Uppercase_Letter})/gu,r);return t?Ad(s,e):s.replace(/(\p{Uppercase_Letter})(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,r).toLowerCase()};const Id=or(Sd);var Da={exports:{}};const Cd=/[\p{Lu}]/u,jd=/[\p{Ll}]/u,ui=/^[\p{Lu}](?![\p{Lu}])/gu,$a=/([\p{Alpha}\p{N}_]|$)/u,Na=/[_.\- ]+/,kd=new RegExp("^"+Na.source),li=new RegExp(Na.source+$a.source,"gu"),di=new RegExp("\\d+"+$a.source,"gu"),Rd=(n,e,t)=>{let r=!1,s=!1,i=!1;for(let a=0;a<n.length;a++){const o=n[a];r&&Cd.test(o)?(n=n.slice(0,a)+"-"+n.slice(a),r=!1,i=s,s=!0,a++):s&&i&&jd.test(o)?(n=n.slice(0,a-1)+"-"+n.slice(a-1),i=s,s=!1,r=!0):(r=e(o)===o&&t(o)!==o,i=s,s=t(o)===o&&e(o)!==o)}return n},xd=(n,e)=>(ui.lastIndex=0,n.replace(ui,t=>e(t))),Dd=(n,e)=>(li.lastIndex=0,di.lastIndex=0,n.replace(li,(t,r)=>e(r)).replace(di,t=>e(t))),La=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(i=>i.trim()).filter(i=>i.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),r=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=Rd(n,t,r)),n=n.replace(kd,""),e.preserveConsecutiveUppercase?n=xd(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),Dd(n,r))};Da.exports=La;Da.exports.default=La;function $d(n,e){return(e==null?void 0:e[n])||Id(n)}function Nd(n,e,t){const r={};for(const s in n)Object.hasOwn(n,s)&&(r[e(s,t)]=n[s]);return r}function hi(n){return Array.isArray(n)?[...n]:{...n}}function Ld(n,e){const t=hi(n);for(const[r,s]of Object.entries(e)){const[i,...a]=r.split(".").reverse();let o=t;for(const u of a.reverse()){if(o[u]===void 0)break;o[u]=hi(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}class tr{get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof tr||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));for(const s in t)s in this&&this[s]!==void 0&&(r[s]=this[s]||r[s]);return{lc:1,type:"constructor",id:[...this.lc_namespace,this.constructor.name],kwargs:Nd(Object.keys(t).length?Ld(r,t):r,$d,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:[...this.lc_namespace,this.constructor.name]}}}const Ud="__run";class Nr{constructor(e,t){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:{}}),this.text=e,this.additional_kwargs=t||{}}toJSON(){return{type:this._getType(),data:{content:this.text,role:"role"in this?this.role:void 0,name:this.name,additional_kwargs:this.additional_kwargs}}}}class Ua extends Nr{_getType(){return"human"}}class Md extends Nr{_getType(){return"ai"}}class Fd extends Nr{_getType(){return"system"}}class Zd extends Nr{constructor(e,t){super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=t}_getType(){return"generic"}}class Vd{}class Bd extends Vd{constructor(e){super(),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.filter=e.filter}async getRelevantDocuments(e){return await this.vectorStore.similaritySearch(e,this.k,this.filter)}async addDocuments(e){await this.vectorStore.addDocuments(e)}}class Ma{constructor(e,t){Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async similaritySearch(e,t=4,r=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map(i=>i[0])}async similaritySearchWithScore(e,t=4,r=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,s){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t){return new Bd({vectorStore:this,k:e,filter:t})}}class rt{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}class kr extends Ma{constructor(e,t){super(e,t),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queryName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t.client,this.tableName=t.tableName||"documents",this.queryName=t.queryName||"match_documents",this.filter=t.filter}async addDocuments(e){const t=e.map(({pageContent:r})=>r);return this.addVectors(await this.embeddings.embedDocuments(t),e)}async addVectors(e,t){const r=e.map((i,a)=>({content:t[a].pageContent,embedding:i,metadata:t[a].metadata})),s=500;for(let i=0;i<r.length;i+=s){const a=r.slice(i,i+s),o=await this.client.from(this.tableName).insert(a);if(o.error)throw new Error(`Error inserting: ${o.error.message} ${o.status} ${o.statusText}`)}}async similaritySearchVectorWithScore(e,t,r){if(r&&this.filter)throw new Error("cannot provide both `filter` and `this.filter`");const s=r??this.filter??{},i={query_embedding:e};let a;if(typeof s=="function")a=h=>s(h).limit(t);else if(typeof s=="object")i.filter=s,i.match_count=t,a=h=>h;else throw new Error("invalid filter type");const o=this.client.rpc(this.queryName,i),{data:u,error:c}=await a(o);if(c)throw new Error(`Error searching for documents: ${c.code} ${c.message} ${c.details}`);return u.map(h=>[new rt({metadata:h.metadata,pageContent:h.content}),h.similarity])}static async fromTexts(e,t,r,s){const i=[];for(let a=0;a<e.length;a+=1){const o=Array.isArray(t)?t[a]:t,u=new rt({pageContent:e[a],metadata:o});i.push(u)}return kr.fromDocuments(i,r,s)}static async fromDocuments(e,t,r){const s=new this(t,r);return await s.addDocuments(e),s}static async fromExistingIndex(e,t){return new this(e,t)}}var qd=Object.defineProperty,zd=(n,e,t)=>e in n?qd(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Hd=(n,e,t)=>(zd(n,typeof e!="symbol"?e+"":e,t),t),Lr={};Lr.byteLength=Gd;Lr.toByteArray=Yd;Lr.fromByteArray=eh;var Ee=[],ye=[],Kd=typeof Uint8Array<"u"?Uint8Array:Array,_n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var lt=0,Jd=_n.length;lt<Jd;++lt)Ee[lt]=_n[lt],ye[_n.charCodeAt(lt)]=lt;ye["-".charCodeAt(0)]=62;ye["_".charCodeAt(0)]=63;function Fa(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function Gd(n){var e=Fa(n),t=e[0],r=e[1];return(t+r)*3/4-r}function Wd(n,e,t){return(e+t)*3/4-t}function Yd(n){var e,t=Fa(n),r=t[0],s=t[1],i=new Kd(Wd(n,r,s)),a=0,o=s>0?r-4:r,u;for(u=0;u<o;u+=4)e=ye[n.charCodeAt(u)]<<18|ye[n.charCodeAt(u+1)]<<12|ye[n.charCodeAt(u+2)]<<6|ye[n.charCodeAt(u+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return s===2&&(e=ye[n.charCodeAt(u)]<<2|ye[n.charCodeAt(u+1)]>>4,i[a++]=e&255),s===1&&(e=ye[n.charCodeAt(u)]<<10|ye[n.charCodeAt(u+1)]<<4|ye[n.charCodeAt(u+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function Qd(n){return Ee[n>>18&63]+Ee[n>>12&63]+Ee[n>>6&63]+Ee[n&63]}function Xd(n,e,t){for(var r,s=[],i=e;i<t;i+=3)r=(n[i]<<16&16711680)+(n[i+1]<<8&65280)+(n[i+2]&255),s.push(Qd(r));return s.join("")}function eh(n){for(var e,t=n.length,r=t%3,s=[],i=16383,a=0,o=t-r;a<o;a+=i)s.push(Xd(n,a,a+i>o?o:a+i));return r===1?(e=n[t-1],s.push(Ee[e>>2]+Ee[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],s.push(Ee[e>>10]+Ee[e>>4&63]+Ee[e<<2&63]+"=")),s.join("")}function th(n,e){let t=Array.from({length:n.length},(r,s)=>({start:s,end:s+1}));for(;t.length>1;){let r=null;for(let s=0;s<t.length-1;s++){const i=n.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,s])}if(r!=null){const s=r[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function rh(n,e){return n.length===1?[e.get(n.join(","))]:th(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function nh(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var es=class{constructor(n,e){De(this,"specialTokens");De(this,"inverseSpecialTokens");De(this,"patStr");De(this,"textEncoder",new TextEncoder);De(this,"textDecoder",new TextDecoder("utf-8"));De(this,"rankMap",new Map);De(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[i,a,...o]=s.split(" "),u=Number.parseInt(a,10);return o.forEach((c,l)=>r[c]=u+l),r},{});for(const[r,s]of Object.entries(t)){const i=Lr.toByteArray(r);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,i])=>(r[i]=this.textEncoder.encode(s),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),s=es.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!a.has(c)):t);if(o.size>0){const c=es.specialTokenRegex([...o]),l=n.match(c);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let u=0;for(;;){let c=null,l=u;for(;s.lastIndex=l,c=s.exec(n),!(c==null||a.has(c[0]));)l=c.index+1;const h=(c==null?void 0:c.index)??n.length;for(const g of n.substring(u,h).matchAll(r)){const b=this.textEncoder.encode(g[0]),w=this.rankMap.get(b.join(","));if(w!=null){i.push(w);continue}i.push(...rh(b,this.rankMap))}if(c==null)break;let p=this.specialTokens[c[0]];i.push(p),u=c.index+c[0].length}return i}decode(n){const e=[];let t=0;for(let i=0;i<n.length;++i){const a=n[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let s=0;for(const i of e)r.set(i,s),s+=i.length;return this.textDecoder.decode(r)}},Za=es;Hd(Za,"specialTokenRegex",n=>new RegExp(n.map(e=>nh(e)).join("|"),"g"));function sh(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}var Ur={exports:{}},Va={};function ve(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var ih=ve;ve.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};ve.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};ve.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};ve.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};ve.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};ve.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};ve.prototype.start=ve.prototype.try;ve.prototype.errors=function(){return this._errors};ve.prototype.attempts=function(){return this._attempts};ve.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var s=this._errors[r],i=s.message,a=(n[i]||0)+1;n[i]=a,a>=t&&(e=s,t=a)}return e};(function(n){var e=ih;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)r[s]=t[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<r.retries;a++)i.push(this.createTimeout(a,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(a,r)),i.sort(function(o,u){return o-u}),i},n.createTimeout=function(t,r){var s=r.randomize?Math.random()+1:1,i=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var a=0;a<s.length;a++){var o=s[a],u=t[o];t[o]=(function(l){var h=n.operation(r),p=Array.prototype.slice.call(arguments,1),g=p.pop();p.push(function(b){h.retry(b)||(b&&(arguments[0]=h.mainError()),g.apply(this,arguments))}),h.attempt(function(){l.apply(t,p)})}).bind(t,u),t[o].options=r}}})(Va);var ah=Va;const oh=ah,ch=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class Ba extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const uh=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},lh=n=>ch.includes(n),qa=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const s=oh.operation(e);s.attempt(async i=>{try{t(await n(i))}catch(a){if(!(a instanceof Error)){r(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof Ba)s.stop(),r(a.originalError);else if(a instanceof TypeError&&!lh(a.message))s.stop(),r(a);else{uh(a,i,e);try{await e.onFailedAttempt(a)}catch(o){r(o);return}s.retry(a)||r(s.mainError())}}})});Ur.exports=qa;Ur.exports.default=qa;Ur.exports.AbortError=Ba;var dh=Ur.exports;const za=or(dh);var Ha={},Ka={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(u,c,l){this.fn=u,this.context=c,this.once=l||!1}function i(u,c,l,h,p){if(typeof l!="function")throw new TypeError("The listener must be a function");var g=new s(l,h||u,p),b=t?t+c:c;return u._events[b]?u._events[b].fn?u._events[b]=[u._events[b],g]:u._events[b].push(g):(u._events[b]=g,u._eventsCount++),u}function a(u,c){--u._eventsCount===0?u._events=new r:delete u._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],l,h;if(this._eventsCount===0)return c;for(h in l=this._events)e.call(l,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},o.prototype.listeners=function(c){var l=t?t+c:c,h=this._events[l];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,g=h.length,b=new Array(g);p<g;p++)b[p]=h[p].fn;return b},o.prototype.listenerCount=function(c){var l=t?t+c:c,h=this._events[l];return h?h.fn?1:h.length:0},o.prototype.emit=function(c,l,h,p,g,b){var w=t?t+c:c;if(!this._events[w])return!1;var O=this._events[w],C=arguments.length,k,j;if(O.fn){switch(O.once&&this.removeListener(c,O.fn,void 0,!0),C){case 1:return O.fn.call(O.context),!0;case 2:return O.fn.call(O.context,l),!0;case 3:return O.fn.call(O.context,l,h),!0;case 4:return O.fn.call(O.context,l,h,p),!0;case 5:return O.fn.call(O.context,l,h,p,g),!0;case 6:return O.fn.call(O.context,l,h,p,g,b),!0}for(j=1,k=new Array(C-1);j<C;j++)k[j-1]=arguments[j];O.fn.apply(O.context,k)}else{var S=O.length,U;for(j=0;j<S;j++)switch(O[j].once&&this.removeListener(c,O[j].fn,void 0,!0),C){case 1:O[j].fn.call(O[j].context);break;case 2:O[j].fn.call(O[j].context,l);break;case 3:O[j].fn.call(O[j].context,l,h);break;case 4:O[j].fn.call(O[j].context,l,h,p);break;default:if(!k)for(U=1,k=new Array(C-1);U<C;U++)k[U-1]=arguments[U];O[j].fn.apply(O[j].context,k)}}return!0},o.prototype.on=function(c,l,h){return i(this,c,l,h,!1)},o.prototype.once=function(c,l,h){return i(this,c,l,h,!0)},o.prototype.removeListener=function(c,l,h,p){var g=t?t+c:c;if(!this._events[g])return this;if(!l)return a(this,g),this;var b=this._events[g];if(b.fn)b.fn===l&&(!p||b.once)&&(!h||b.context===h)&&a(this,g);else{for(var w=0,O=[],C=b.length;w<C;w++)(b[w].fn!==l||p&&!b[w].once||h&&b[w].context!==h)&&O.push(b[w]);O.length?this._events[g]=O.length===1?O[0]:O:a(this,g)}return this},o.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&a(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(Ka);var hh=Ka.exports,Mr={exports:{}},fh=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const ph=fh;class Ja extends Error{constructor(e){super(e),this.name="TimeoutError"}}const Ga=(n,e,t)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const i=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(u){s(u)}return}const a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Ja(a);typeof n.cancel=="function"&&n.cancel(),s(o)},e);ph(n.then(r,s),()=>{clearTimeout(i)})});Mr.exports=Ga;Mr.exports.default=Ga;Mr.exports.TimeoutError=Ja;var mh=Mr.exports,Os={},Ts={};Object.defineProperty(Ts,"__esModule",{value:!0});function gh(n,e,t){let r=0,s=n.length;for(;s>0;){const i=s/2|0;let a=r+i;t(n[a],e)<=0?(r=++a,s-=i+1):s=i}return r}Ts.default=gh;Object.defineProperty(Os,"__esModule",{value:!0});const yh=Ts;class vh{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const s=yh.default(this._queue,r,(i,a)=>a.priority-i.priority);this._queue.splice(s,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}Os.default=vh;Object.defineProperty(Ha,"__esModule",{value:!0});const bh=hh,Wa=mh,_h=Os,wr=()=>{},wh=new Wa.TimeoutError;class Oh extends bh{constructor(e){var t,r,s,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=wr,this._resolveIdle=wr,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:_h.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=wr,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=wr,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,s)=>{const i=async()=>{this._pendingCount++,this._intervalCount++;try{const a=this._timeout===void 0&&t.timeout===void 0?e():Wa.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(wh)});r(await a)}catch(a){s(a)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var Re=Ha.default=Oh;const Th=[400,401,403,404,405,406,407,408,409];let Ps=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in Re?Re.default:Re;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>za(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt(r){var i;if(r.message.startsWith("Cancel")||r.message.startsWith("TimeoutError")||r.message.startsWith("AbortError")||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const s=(i=r==null?void 0:r.response)==null?void 0:i.status;if(s&&Th.includes(+s))throw r},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};const Or={},Ph=new Ps({});async function Eh(n,e){return n in Or||(Or[n]=Ph.fetch(`https://tiktoken.pages.dev/js/${n}.json`,{signal:e==null?void 0:e.signal}).then(t=>t.json()).catch(t=>{throw delete Or[n],t})),new Za(await Or[n],e==null?void 0:e.extendedSpecialTokens)}async function Ah(n,e){return Eh(sh(n),e)}class Sh{constructor(e){if(Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}splitOnSeparator(e,t){let r;if(t)if(this.keepSeparator){const s=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(new RegExp(`(?=${s})`))}else r=e.split(t);else r=e.split("");return r.filter(s=>s!=="")}async createDocuments(e,t=[],r={}){const s=t.length>0?t:new Array(e.length).fill({}),{chunkHeader:i="",chunkOverlapHeader:a="(cont'd) ",appendChunkOverlapHeader:o=!1}=r,u=new Array;for(let c=0;c<e.length;c+=1){const l=e[c];let h=1,p=null;for(const g of await this.splitText(l)){let b=i,w=0;if(p){const j=l.indexOf(g),S=l.indexOf(p)+p.length;w=(l.slice(S,j).match(/\n/g)||[]).length,o&&(b+=a)}h+=w;const O=(g.match(/\n/g)||[]).length,C=s[c].loc&&typeof s[c].loc=="object"?{...s[c].loc}:{};C.lines={from:h,to:h+O};const k={...s[c],loc:C};b+=g,u.push(new rt({pageContent:b,metadata:k})),h+=O,p=g}}return u}async splitDocuments(e,t={}){const r=e.filter(a=>a.pageContent!==void 0),s=r.map(a=>a.pageContent),i=r.map(a=>a.metadata);return this.createDocuments(s,i,t)}joinDocs(e,t){const r=e.join(t).trim();return r===""?null:r}mergeSplits(e,t){const r=[],s=[];let i=0;for(const o of e){const u=o.length;if(i+u+(s.length>0?t.length:0)>this.chunkSize&&(i>this.chunkSize&&console.warn(`Created a chunk of size ${i}, +
which is longer than the specified ${this.chunkSize}`),s.length>0)){const c=this.joinDocs(s,t);for(c!==null&&r.push(c);i>this.chunkOverlap||i+u>this.chunkSize&&i>0;)i-=s[0].length,s.shift()}s.push(o),i+=u}const a=this.joinDocs(s,t);return a!==null&&r.push(a),r}}class rr extends Sh{constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,t){const r=[];let s=t[t.length-1],i;for(let c=0;c<t.length;c+=1){const l=t[c];if(l===""){s=l;break}if(e.includes(l)){s=l,i=t.slice(c+1);break}}const a=this.splitOnSeparator(e,s);let o=[];const u=this.keepSeparator?"":s;for(const c of a)if(c.length<this.chunkSize)o.push(c);else{if(o.length){const l=this.mergeSplits(o,u);r.push(...l),o=[]}if(!i)r.push(c);else{const l=await this._splitText(c,i);r.push(...l)}}if(o.length){const c=this.mergeSplits(o,u);r.push(...c)}return r}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,t){return new rr({...t,separators:rr.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}var Ih=Object.defineProperty,Ch=(n,e,t)=>e in n?Ih(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ts=(n,e,t)=>(Ch(n,typeof e!="symbol"?e+"":e,t),t);class jh extends Tu{constructor(e,t){super(e,t),ts(this,"client"),ts(this,"storageUrl"),this.client=xa(this.config.url,this.config.anonKey,{auth:{persistSession:!1}}),this.storageUrl=`${this.config.url}/storage/v1/object/public/${this.config.bucket}`}async create(e){if(!e&&!this.data)throw new Error("ImageStorage error: No Storage Data");const t=e||this.data,{error:r}=await this.client.storage.from(this.config.bucket).upload(t.imgPath,t.imgData,{contentType:"image/svg+xml",cacheControl:"31536000",upsert:this.config.upsert||!0});if(r)throw r;return{url:`${this.storageUrl}/${t.imgPath}?v=stargramogimage&t=${Date.now()}`}}async update(e){if(!e&&!this.data)throw new Error("ImageStorage error: No Storage Data");const t=e||this.data,{error:r}=await this.client.storage.from(this.config.bucket).update(t.imgPath,t.imgData,{contentType:"image/svg+xml",cacheControl:"31536000"});if(r)throw r;return{url:`${this.storageUrl}/${t.imgPath}?v=stargramogimage&t=${Date.now()}`}}async query(e){const t=`${this.storageUrl}/${e}`;return{url:await Ae(t).then(r=>t).catch(r=>"")}}getConfig(){return this.config}getType(){return{type:"ImageStorage",name:"SupabaseImageStorage"}}}class kh extends Ta{constructor(e,t){super(e,t),ts(this,"client"),this.client=xa(this.config.url,this.config.anonKey,{auth:{persistSession:!1}})}async save(e){if(!e&&!this.data)throw new Error("VectorStorage error: No Storage Data");const t=e||this.data,r=new rt({pageContent:t.content,metadata:this.config.metaData}),s=await new rr({chunkSize:300,chunkOverlap:40}).splitDocuments([r]);await kr.fromDocuments(s,this.config.embeddingsInfo.embeddings,{client:this.client,tableName:this.config.embeddingsInfo.indexName})}async getRetriever(){return(await kr.fromExistingIndex(this.config.embeddingsInfo.embeddings,{client:this.client,tableName:this.config.embeddingsInfo.indexName,queryName:this.config.embeddingsInfo.queryName,filter:{appName:this.config.metaData.appName,botId:this.config.metaData.botId,userId:this.config.metaData.userId}})).asRetriever()}getConfig(){return this.config}getType(){return{type:"VectorStorage",name:"SupabaseVectorStorage"}}}let Tr;const Rh=new Uint8Array(16);function xh(){if(!Tr&&(Tr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Tr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Tr(Rh)}const ne=[];for(let n=0;n<256;++n)ne.push((n+256).toString(16).slice(1));function Dh(n,e=0){return(ne[n[e+0]]+ne[n[e+1]]+ne[n[e+2]]+ne[n[e+3]]+"-"+ne[n[e+4]]+ne[n[e+5]]+"-"+ne[n[e+6]]+ne[n[e+7]]+"-"+ne[n[e+8]]+ne[n[e+9]]+"-"+ne[n[e+10]]+ne[n[e+11]]+ne[n[e+12]]+ne[n[e+13]]+ne[n[e+14]]+ne[n[e+15]]).toLowerCase()}const $h=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),fi={randomUUID:$h};function Fe(n,e,t){if(fi.randomUUID&&!e&&!n)return fi.randomUUID();n=n||{};const r=n.random||(n.rng||xh)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return Dh(r)}class nr extends Ma{constructor(e,t){super(e,t),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"collection",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"collectionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numDimensions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.numDimensions=t.numDimensions,this.embeddings=e,this.collectionName=Nh(t.collectionName),"index"in t?this.index=t.index:"url"in t&&(this.url=t.url||"http://localhost:8000"),this.filter=t.filter}async addDocuments(e){const t=e.map(({pageContent:r})=>r);await this.addVectors(await this.embeddings.embedDocuments(t),e)}async ensureCollection(){if(!this.collection){if(!this.index){const{ChromaClient:e}=await nr.imports();this.index=new e({path:this.url})}try{this.collection=await this.index.getOrCreateCollection({name:this.collectionName})}catch(e){throw new Error(`Chroma getOrCreateCollection error: ${e}`)}}return this.collection}async addVectors(e,t){if(e.length===0)return;if(this.numDimensions===void 0&&(this.numDimensions=e[0].length),e.length!==t.length)throw new Error("Vectors and metadatas must have the same length");if(e[0].length!==this.numDimensions)throw new Error(`Vectors must have the same length as the number of dimensions (${this.numDimensions})`);const r=await this.ensureCollection(),s=await r.count();await r.add({ids:Array.from({length:e.length},(i,a)=>(s+a).toString()),embeddings:e,metadatas:t.map(({metadata:i})=>i),documents:t.map(({pageContent:i})=>i)})}async similaritySearchVectorWithScore(e,t,r){if(r&&this.filter)throw new Error("cannot provide both `filter` and `this.filter`");const s=r??this.filter,a=await(await this.ensureCollection()).query({queryEmbeddings:e,nResults:t,where:{...s}}),{ids:o,distances:u,documents:c,metadatas:l}=a;if(!o||!u||!c||!l)return[];const[h]=o,[p]=u,[g]=c,[b]=l,w=[];for(let O=0;O<h.length;O+=1)w.push([new rt({pageContent:(g==null?void 0:g[O])??"",metadata:(b==null?void 0:b[O])??{}}),p[O]]);return w}static async fromTexts(e,t,r,s){const i=[];for(let a=0;a<e.length;a+=1){const o=Array.isArray(t)?t[a]:t,u=new rt({pageContent:e[a],metadata:o});i.push(u)}return nr.fromDocuments(i,r,s)}static async fromDocuments(e,t,r){const s=new this(t,r);return await s.addDocuments(e),s}static async fromExistingCollection(e,t){const r=new this(e,t);return await r.ensureCollection(),r}static async imports(){try{const{ChromaClient:e}=await Pt(()=>import("../assets/index-319811fa.js"),[]);return{ChromaClient:e}}catch{throw new Error("Please install chromadb as a dependency with, e.g. `npm install -S chromadb`")}}}function Nh(n){return n||`langchain-${Fe()}`}class Lh extends Ta{constructor(e,t){super(e,t)}async save(e){if(!e&&!this.data)throw new Error("VectorStorage error: No Storage Data");const t=e||this.data,r=new rt({pageContent:t.content,metadata:this.config.metaData}),s=await new rr({chunkSize:300,chunkOverlap:40}).splitDocuments([r]);await nr.fromDocuments(s,this.config.embeddingsInfo.embeddings,{collectionName:this.config.embeddingsInfo.indexName,url:this.config.url})}async getRetriever(){return(await nr.fromExistingCollection(this.config.embeddingsInfo.embeddings,{collectionName:this.config.embeddingsInfo.indexName,url:this.config.url,filter:{appName:this.config.metaData.appName,botId:this.config.metaData.botId,userId:this.config.metaData.userId}})).asRetriever()}getConfig(){return this.config}getType(){return{type:"VectorStorage",name:"ChromaVectorConfig"}}}const rs={DataStorage:{NotionDataStorage:Pu},ImageStorage:{SupabaseImageStorage:jh},VectorStorage:{SupabaseVectorStorage:kh,ChromaVectorStorage:Lh}};var sr={},Ya={},Es={exports:{}},Qa=function(e,t){return function(){for(var s=new Array(arguments.length),i=0;i<s.length;i++)s[i]=arguments[i];return e.apply(t,s)}},Uh=Qa,Be=Object.prototype.toString;function As(n){return Array.isArray(n)}function ns(n){return typeof n>"u"}function Mh(n){return n!==null&&!ns(n)&&n.constructor!==null&&!ns(n.constructor)&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function Xa(n){return Be.call(n)==="[object ArrayBuffer]"}function Fh(n){return Be.call(n)==="[object FormData]"}function Zh(n){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Xa(n.buffer),e}function Vh(n){return typeof n=="string"}function Bh(n){return typeof n=="number"}function eo(n){return n!==null&&typeof n=="object"}function Ar(n){if(Be.call(n)!=="[object Object]")return!1;var e=Object.getPrototypeOf(n);return e===null||e===Object.prototype}function qh(n){return Be.call(n)==="[object Date]"}function zh(n){return Be.call(n)==="[object File]"}function Hh(n){return Be.call(n)==="[object Blob]"}function to(n){return Be.call(n)==="[object Function]"}function Kh(n){return eo(n)&&to(n.pipe)}function Jh(n){return Be.call(n)==="[object URLSearchParams]"}function Gh(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function Wh(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function Ss(n,e){if(!(n===null||typeof n>"u"))if(typeof n!="object"&&(n=[n]),As(n))for(var t=0,r=n.length;t<r;t++)e.call(null,n[t],t,n);else for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.call(null,n[s],s,n)}function ss(){var n={};function e(s,i){Ar(n[i])&&Ar(s)?n[i]=ss(n[i],s):Ar(s)?n[i]=ss({},s):As(s)?n[i]=s.slice():n[i]=s}for(var t=0,r=arguments.length;t<r;t++)Ss(arguments[t],e);return n}function Yh(n,e,t){return Ss(e,function(s,i){t&&typeof s=="function"?n[i]=Uh(s,t):n[i]=s}),n}function Qh(n){return n.charCodeAt(0)===65279&&(n=n.slice(1)),n}var de={isArray:As,isArrayBuffer:Xa,isBuffer:Mh,isFormData:Fh,isArrayBufferView:Zh,isString:Vh,isNumber:Bh,isObject:eo,isPlainObject:Ar,isUndefined:ns,isDate:qh,isFile:zh,isBlob:Hh,isFunction:to,isStream:Kh,isURLSearchParams:Jh,isStandardBrowserEnv:Wh,forEach:Ss,merge:ss,extend:Yh,trim:Gh,stripBOM:Qh},dt=de;function pi(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var ro=function(e,t,r){if(!t)return e;var s;if(r)s=r(t);else if(dt.isURLSearchParams(t))s=t.toString();else{var i=[];dt.forEach(t,function(u,c){u===null||typeof u>"u"||(dt.isArray(u)?c=c+"[]":u=[u],dt.forEach(u,function(h){dt.isDate(h)?h=h.toISOString():dt.isObject(h)&&(h=JSON.stringify(h)),i.push(pi(c)+"="+pi(h))}))}),s=i.join("&")}if(s){var a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+s}return e},Xh=de;function Fr(){this.handlers=[]}Fr.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1};Fr.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};Fr.prototype.forEach=function(e){Xh.forEach(this.handlers,function(r){r!==null&&e(r)})};var ef=Fr,tf=de,rf=function(e,t){tf.forEach(e,function(s,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=s,delete e[i])})},no=function(e,t,r,s,i){return e.config=t,r&&(e.code=r),e.request=s,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},so={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wn,mi;function io(){if(mi)return wn;mi=1;var n=no;return wn=function(t,r,s,i,a){var o=new Error(t);return n(o,r,s,i,a)},wn}var On,gi;function nf(){if(gi)return On;gi=1;var n=io();return On=function(t,r,s){var i=s.config.validateStatus;!s.status||!i||i(s.status)?t(s):r(n("Request failed with status code "+s.status,s.config,null,s.request,s))},On}var Tn,yi;function sf(){if(yi)return Tn;yi=1;var n=de;return Tn=n.isStandardBrowserEnv()?function(){return{write:function(r,s,i,a,o,u){var c=[];c.push(r+"="+encodeURIComponent(s)),n.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),n.isString(a)&&c.push("path="+a),n.isString(o)&&c.push("domain="+o),u===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(r){var s=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Tn}var Pn,vi;function af(){return vi||(vi=1,Pn=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}),Pn}var En,bi;function of(){return bi||(bi=1,En=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}),En}var An,_i;function cf(){if(_i)return An;_i=1;var n=af(),e=of();return An=function(r,s){return r&&!n(s)?e(r,s):s},An}var Sn,wi;function uf(){if(wi)return Sn;wi=1;var n=de,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Sn=function(r){var s={},i,a,o;return r&&n.forEach(r.split(`
`),function(c){if(o=c.indexOf(":"),i=n.trim(c.substr(0,o)).toLowerCase(),a=n.trim(c.substr(o+1)),i){if(s[i]&&e.indexOf(i)>=0)return;i==="set-cookie"?s[i]=(s[i]?s[i]:[]).concat([a]):s[i]=s[i]?s[i]+", "+a:a}}),s},Sn}var In,Oi;function lf(){if(Oi)return In;Oi=1;var n=de;return In=n.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),s;function i(a){var o=a;return t&&(r.setAttribute("href",o),o=r.href),r.setAttribute("href",o),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return s=i(window.location.href),function(o){var u=n.isString(o)?i(o):o;return u.protocol===s.protocol&&u.host===s.host}}():function(){return function(){return!0}}(),In}var Cn,Ti;function Zr(){if(Ti)return Cn;Ti=1;function n(e){this.message=e}return n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,Cn=n,Cn}var jn,Pi;function Ei(){if(Pi)return jn;Pi=1;var n=de,e=nf(),t=sf(),r=ro,s=cf(),i=uf(),a=lf(),o=io(),u=so,c=Zr();return jn=function(h){return new Promise(function(g,b){var w=h.data,O=h.headers,C=h.responseType,k;function j(){h.cancelToken&&h.cancelToken.unsubscribe(k),h.signal&&h.signal.removeEventListener("abort",k)}n.isFormData(w)&&delete O["Content-Type"];var S=new XMLHttpRequest;if(h.auth){var U=h.auth.username||"",J=h.auth.password?unescape(encodeURIComponent(h.auth.password)):"";O.Authorization="Basic "+btoa(U+":"+J)}var ee=s(h.baseURL,h.url);S.open(h.method.toUpperCase(),r(ee,h.params,h.paramsSerializer),!0),S.timeout=h.timeout;function Y(){if(S){var G="getAllResponseHeaders"in S?i(S.getAllResponseHeaders()):null,q=!C||C==="text"||C==="json"?S.responseText:S.response,Q={data:q,status:S.status,statusText:S.statusText,headers:G,config:h,request:S};e(function(T){g(T),j()},function(T){b(T),j()},Q),S=null}}if("onloadend"in S?S.onloadend=Y:S.onreadystatechange=function(){!S||S.readyState!==4||S.status===0&&!(S.responseURL&&S.responseURL.indexOf("file:")===0)||setTimeout(Y)},S.onabort=function(){S&&(b(o("Request aborted",h,"ECONNABORTED",S)),S=null)},S.onerror=function(){b(o("Network Error",h,null,S)),S=null},S.ontimeout=function(){var q=h.timeout?"timeout of "+h.timeout+"ms exceeded":"timeout exceeded",Q=h.transitional||u;h.timeoutErrorMessage&&(q=h.timeoutErrorMessage),b(o(q,h,Q.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",S)),S=null},n.isStandardBrowserEnv()){var re=(h.withCredentials||a(ee))&&h.xsrfCookieName?t.read(h.xsrfCookieName):void 0;re&&(O[h.xsrfHeaderName]=re)}"setRequestHeader"in S&&n.forEach(O,function(q,Q){typeof w>"u"&&Q.toLowerCase()==="content-type"?delete O[Q]:S.setRequestHeader(Q,q)}),n.isUndefined(h.withCredentials)||(S.withCredentials=!!h.withCredentials),C&&C!=="json"&&(S.responseType=h.responseType),typeof h.onDownloadProgress=="function"&&S.addEventListener("progress",h.onDownloadProgress),typeof h.onUploadProgress=="function"&&S.upload&&S.upload.addEventListener("progress",h.onUploadProgress),(h.cancelToken||h.signal)&&(k=function(G){S&&(b(!G||G&&G.type?new c("canceled"):G),S.abort(),S=null)},h.cancelToken&&h.cancelToken.subscribe(k),h.signal&&(h.signal.aborted?k():h.signal.addEventListener("abort",k))),w||(w=null),S.send(w)})},jn}var se=de,Ai=rf,df=no,hf=so,ff={"Content-Type":"application/x-www-form-urlencoded"};function Si(n,e){!se.isUndefined(n)&&se.isUndefined(n["Content-Type"])&&(n["Content-Type"]=e)}function pf(){var n;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(n=Ei()),n}function mf(n,e,t){if(se.isString(n))try{return(e||JSON.parse)(n),se.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}var Vr={transitional:hf,adapter:pf(),transformRequest:[function(e,t){return Ai(t,"Accept"),Ai(t,"Content-Type"),se.isFormData(e)||se.isArrayBuffer(e)||se.isBuffer(e)||se.isStream(e)||se.isFile(e)||se.isBlob(e)?e:se.isArrayBufferView(e)?e.buffer:se.isURLSearchParams(e)?(Si(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):se.isObject(e)||t&&t["Content-Type"]==="application/json"?(Si(t,"application/json"),mf(e)):e}],transformResponse:[function(e){var t=this.transitional||Vr.transitional,r=t&&t.silentJSONParsing,s=t&&t.forcedJSONParsing,i=!r&&this.responseType==="json";if(i||s&&se.isString(e)&&e.length)try{return JSON.parse(e)}catch(a){if(i)throw a.name==="SyntaxError"?df(a,this,"E_JSON_PARSE"):a}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};se.forEach(["delete","get","head"],function(e){Vr.headers[e]={}});se.forEach(["post","put","patch"],function(e){Vr.headers[e]=se.merge(ff)});var Is=Vr,gf=de,yf=Is,vf=function(e,t,r){var s=this||yf;return gf.forEach(r,function(a){e=a.call(s,e,t)}),e},kn,Ii;function ao(){return Ii||(Ii=1,kn=function(e){return!!(e&&e.__CANCEL__)}),kn}var Ci=de,Rn=vf,bf=ao(),_f=Is,wf=Zr();function xn(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new wf("canceled")}var Of=function(e){xn(e),e.headers=e.headers||{},e.data=Rn.call(e,e.data,e.headers,e.transformRequest),e.headers=Ci.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),Ci.forEach(["delete","get","head","post","put","patch","common"],function(s){delete e.headers[s]});var t=e.adapter||_f.adapter;return t(e).then(function(s){return xn(e),s.data=Rn.call(e,s.data,s.headers,e.transformResponse),s},function(s){return bf(s)||(xn(e),s&&s.response&&(s.response.data=Rn.call(e,s.response.data,s.response.headers,e.transformResponse))),Promise.reject(s)})},fe=de,oo=function(e,t){t=t||{};var r={};function s(l,h){return fe.isPlainObject(l)&&fe.isPlainObject(h)?fe.merge(l,h):fe.isPlainObject(h)?fe.merge({},h):fe.isArray(h)?h.slice():h}function i(l){if(fe.isUndefined(t[l])){if(!fe.isUndefined(e[l]))return s(void 0,e[l])}else return s(e[l],t[l])}function a(l){if(!fe.isUndefined(t[l]))return s(void 0,t[l])}function o(l){if(fe.isUndefined(t[l])){if(!fe.isUndefined(e[l]))return s(void 0,e[l])}else return s(void 0,t[l])}function u(l){if(l in t)return s(e[l],t[l]);if(l in e)return s(void 0,e[l])}var c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:u};return fe.forEach(Object.keys(e).concat(Object.keys(t)),function(h){var p=c[h]||i,g=p(h);fe.isUndefined(g)&&p!==u||(r[h]=g)}),r},Dn,ji;function co(){return ji||(ji=1,Dn={version:"0.26.1"}),Dn}var Tf=co().version,Cs={};["object","boolean","number","function","string","symbol"].forEach(function(n,e){Cs[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});var ki={};Cs.transitional=function(e,t,r){function s(i,a){return"[Axios v"+Tf+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return function(i,a,o){if(e===!1)throw new Error(s(a," has been removed"+(t?" in "+t:"")));return t&&!ki[a]&&(ki[a]=!0,console.warn(s(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,o):!0}};function Pf(n,e,t){if(typeof n!="object")throw new TypeError("options must be an object");for(var r=Object.keys(n),s=r.length;s-- >0;){var i=r[s],a=e[i];if(a){var o=n[i],u=o===void 0||a(o,i,n);if(u!==!0)throw new TypeError("option "+i+" must be "+u);continue}if(t!==!0)throw Error("Unknown option "+i)}}var Ef={assertOptions:Pf,validators:Cs},uo=de,Af=ro,Ri=ef,xi=Of,Br=oo,lo=Ef,ht=lo.validators;function cr(n){this.defaults=n,this.interceptors={request:new Ri,response:new Ri}}cr.prototype.request=function(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Br(this.defaults,t),t.method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;r!==void 0&&lo.assertOptions(r,{silentJSONParsing:ht.transitional(ht.boolean),forcedJSONParsing:ht.transitional(ht.boolean),clarifyTimeoutError:ht.transitional(ht.boolean)},!1);var s=[],i=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(i=i&&g.synchronous,s.unshift(g.fulfilled,g.rejected))});var a=[];this.interceptors.response.forEach(function(g){a.push(g.fulfilled,g.rejected)});var o;if(!i){var u=[xi,void 0];for(Array.prototype.unshift.apply(u,s),u=u.concat(a),o=Promise.resolve(t);u.length;)o=o.then(u.shift(),u.shift());return o}for(var c=t;s.length;){var l=s.shift(),h=s.shift();try{c=l(c)}catch(p){h(p);break}}try{o=xi(c)}catch(p){return Promise.reject(p)}for(;a.length;)o=o.then(a.shift(),a.shift());return o};cr.prototype.getUri=function(e){return e=Br(this.defaults,e),Af(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")};uo.forEach(["delete","get","head","options"],function(e){cr.prototype[e]=function(t,r){return this.request(Br(r||{},{method:e,url:t,data:(r||{}).data}))}});uo.forEach(["post","put","patch"],function(e){cr.prototype[e]=function(t,r,s){return this.request(Br(s||{},{method:e,url:t,data:r}))}});var Sf=cr,$n,Di;function If(){if(Di)return $n;Di=1;var n=Zr();function e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var r;this.promise=new Promise(function(a){r=a});var s=this;this.promise.then(function(i){if(s._listeners){var a,o=s._listeners.length;for(a=0;a<o;a++)s._listeners[a](i);s._listeners=null}}),this.promise.then=function(i){var a,o=new Promise(function(u){s.subscribe(u),a=u}).then(i);return o.cancel=function(){s.unsubscribe(a)},o},t(function(a){s.reason||(s.reason=new n(a),r(s.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]},e.prototype.unsubscribe=function(r){if(this._listeners){var s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}},e.source=function(){var r,s=new e(function(a){r=a});return{token:s,cancel:r}},$n=e,$n}var Nn,$i;function Cf(){return $i||($i=1,Nn=function(e){return function(r){return e.apply(null,r)}}),Nn}var Ln,Ni;function jf(){if(Ni)return Ln;Ni=1;var n=de;return Ln=function(t){return n.isObject(t)&&t.isAxiosError===!0},Ln}var Li=de,kf=Qa,Sr=Sf,Rf=oo,xf=Is;function ho(n){var e=new Sr(n),t=kf(Sr.prototype.request,e);return Li.extend(t,Sr.prototype,e),Li.extend(t,e),t.create=function(s){return ho(Rf(n,s))},t}var Ce=ho(xf);Ce.Axios=Sr;Ce.Cancel=Zr();Ce.CancelToken=If();Ce.isCancel=ao();Ce.VERSION=co().version;Ce.all=function(e){return Promise.all(e)};Ce.spread=Cf();Ce.isAxiosError=jf();Es.exports=Ce;Es.exports.default=Ce;var Df=Es.exports,js=Df;const Pr=or(js);var W={},ks={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.RequiredError=n.BaseAPI=n.COLLECTION_FORMATS=n.BASE_PATH=void 0;const e=js;n.BASE_PATH="https://api.openai.com/v1".replace(/\/+$/,""),n.COLLECTION_FORMATS={csv:",",ssv:" ",tsv:"	",pipes:"|"};class t{constructor(i,a=n.BASE_PATH,o=e.default){this.basePath=a,this.axios=o,i&&(this.configuration=i,this.basePath=i.basePath||this.basePath)}}n.BaseAPI=t;class r extends Error{constructor(i,a){super(a),this.field=i,this.name="RequiredError"}}n.RequiredError=r})(ks);var Rs=z&&z.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(r.next(l))}catch(h){a(h)}}function u(l){try{c(r.throw(l))}catch(h){a(h)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(W,"__esModule",{value:!0});W.createRequestFunction=W.toPathString=W.serializeDataIfNeeded=W.setSearchParams=W.setOAuthToObject=W.setBearerAuthToObject=W.setBasicAuthToObject=W.setApiKeyToObject=W.assertParamExists=W.DUMMY_BASE_URL=void 0;const $f=ks;W.DUMMY_BASE_URL="https://example.com";W.assertParamExists=function(n,e,t){if(t==null)throw new $f.RequiredError(e,`Required parameter ${e} was null or undefined when calling ${n}.`)};W.setApiKeyToObject=function(n,e,t){return Rs(this,void 0,void 0,function*(){if(t&&t.apiKey){const r=typeof t.apiKey=="function"?yield t.apiKey(e):yield t.apiKey;n[e]=r}})};W.setBasicAuthToObject=function(n,e){e&&(e.username||e.password)&&(n.auth={username:e.username,password:e.password})};W.setBearerAuthToObject=function(n,e){return Rs(this,void 0,void 0,function*(){if(e&&e.accessToken){const t=typeof e.accessToken=="function"?yield e.accessToken():yield e.accessToken;n.Authorization="Bearer "+t}})};W.setOAuthToObject=function(n,e,t,r){return Rs(this,void 0,void 0,function*(){if(r&&r.accessToken){const s=typeof r.accessToken=="function"?yield r.accessToken(e,t):yield r.accessToken;n.Authorization="Bearer "+s}})};function is(n,e,t=""){e!=null&&(typeof e=="object"?Array.isArray(e)?e.forEach(r=>is(n,r,t)):Object.keys(e).forEach(r=>is(n,e[r],`${t}${t!==""?".":""}${r}`)):n.has(t)?n.append(t,e):n.set(t,e))}W.setSearchParams=function(n,...e){const t=new URLSearchParams(n.search);is(t,e),n.search=t.toString()};W.serializeDataIfNeeded=function(n,e,t){const r=typeof n!="string";return(r&&t&&t.isJsonMime?t.isJsonMime(e.headers["Content-Type"]):r)?JSON.stringify(n!==void 0?n:{}):n||""};W.toPathString=function(n){return n.pathname+n.search+n.hash};W.createRequestFunction=function(n,e,t,r){return(s=e,i=t)=>{const a=Object.assign(Object.assign({},n.options),{url:((r==null?void 0:r.basePath)||i)+n.url});return s.request(a)}};(function(n){var e=z&&z.__awaiter||function(a,o,u,c){function l(h){return h instanceof u?h:new u(function(p){p(h)})}return new(u||(u=Promise))(function(h,p){function g(O){try{w(c.next(O))}catch(C){p(C)}}function b(O){try{w(c.throw(O))}catch(C){p(C)}}function w(O){O.done?h(O.value):l(O.value).then(g,b)}w((c=c.apply(a,o||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.OpenAIApi=n.OpenAIApiFactory=n.OpenAIApiFp=n.OpenAIApiAxiosParamCreator=n.CreateImageRequestResponseFormatEnum=n.CreateImageRequestSizeEnum=n.ChatCompletionResponseMessageRoleEnum=n.ChatCompletionRequestMessageRoleEnum=void 0;const t=js,r=W,s=ks;n.ChatCompletionRequestMessageRoleEnum={System:"system",User:"user",Assistant:"assistant",Function:"function"},n.ChatCompletionResponseMessageRoleEnum={System:"system",User:"user",Assistant:"assistant",Function:"function"},n.CreateImageRequestSizeEnum={_256x256:"256x256",_512x512:"512x512",_1024x1024:"1024x1024"},n.CreateImageRequestResponseFormatEnum={Url:"url",B64Json:"b64_json"},n.OpenAIApiAxiosParamCreator=function(a){return{cancelFineTune:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("cancelFineTune","fineTuneId",o);const c="/fine-tunes/{fine_tune_id}/cancel".replace("{fine_tune_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"POST"},h),u),g={},b={};r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),{url:r.toPathString(l),options:p}}),createAnswer:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createAnswer","createAnswerRequest",o);const c="/answers",l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"POST"},h),u),g={},b={};g["Content-Type"]="application/json",r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),p.data=r.serializeDataIfNeeded(o,p,a),{url:r.toPathString(l),options:p}}),createChatCompletion:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createChatCompletion","createChatCompletionRequest",o);const c="/chat/completions",l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"POST"},h),u),g={},b={};g["Content-Type"]="application/json",r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),p.data=r.serializeDataIfNeeded(o,p,a),{url:r.toPathString(l),options:p}}),createClassification:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createClassification","createClassificationRequest",o);const c="/classifications",l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"POST"},h),u),g={},b={};g["Content-Type"]="application/json",r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),p.data=r.serializeDataIfNeeded(o,p,a),{url:r.toPathString(l),options:p}}),createCompletion:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createCompletion","createCompletionRequest",o);const c="/completions",l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"POST"},h),u),g={},b={};g["Content-Type"]="application/json",r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),p.data=r.serializeDataIfNeeded(o,p,a),{url:r.toPathString(l),options:p}}),createEdit:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createEdit","createEditRequest",o);const c="/edits",l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"POST"},h),u),g={},b={};g["Content-Type"]="application/json",r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),p.data=r.serializeDataIfNeeded(o,p,a),{url:r.toPathString(l),options:p}}),createEmbedding:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createEmbedding","createEmbeddingRequest",o);const c="/embeddings",l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"POST"},h),u),g={},b={};g["Content-Type"]="application/json",r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),p.data=r.serializeDataIfNeeded(o,p,a),{url:r.toPathString(l),options:p}}),createFile:(o,u,c={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createFile","file",o),r.assertParamExists("createFile","purpose",u);const l="/files",h=new URL(l,r.DUMMY_BASE_URL);let p;a&&(p=a.baseOptions);const g=Object.assign(Object.assign({method:"POST"},p),c),b={},w={},O=new(a&&a.formDataCtor||FormData);o!==void 0&&O.append("file",o),u!==void 0&&O.append("purpose",u),b["Content-Type"]="multipart/form-data",r.setSearchParams(h,w);let C=p&&p.headers?p.headers:{};return g.headers=Object.assign(Object.assign(Object.assign(Object.assign({},b),O.getHeaders()),C),c.headers),g.data=O,{url:r.toPathString(h),options:g}}),createFineTune:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createFineTune","createFineTuneRequest",o);const c="/fine-tunes",l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"POST"},h),u),g={},b={};g["Content-Type"]="application/json",r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),p.data=r.serializeDataIfNeeded(o,p,a),{url:r.toPathString(l),options:p}}),createImage:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createImage","createImageRequest",o);const c="/images/generations",l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"POST"},h),u),g={},b={};g["Content-Type"]="application/json",r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),p.data=r.serializeDataIfNeeded(o,p,a),{url:r.toPathString(l),options:p}}),createImageEdit:(o,u,c,l,h,p,g,b={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createImageEdit","image",o),r.assertParamExists("createImageEdit","prompt",u);const w="/images/edits",O=new URL(w,r.DUMMY_BASE_URL);let C;a&&(C=a.baseOptions);const k=Object.assign(Object.assign({method:"POST"},C),b),j={},S={},U=new(a&&a.formDataCtor||FormData);o!==void 0&&U.append("image",o),c!==void 0&&U.append("mask",c),u!==void 0&&U.append("prompt",u),l!==void 0&&U.append("n",l),h!==void 0&&U.append("size",h),p!==void 0&&U.append("response_format",p),g!==void 0&&U.append("user",g),j["Content-Type"]="multipart/form-data",r.setSearchParams(O,S);let J=C&&C.headers?C.headers:{};return k.headers=Object.assign(Object.assign(Object.assign(Object.assign({},j),U.getHeaders()),J),b.headers),k.data=U,{url:r.toPathString(O),options:k}}),createImageVariation:(o,u,c,l,h,p={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createImageVariation","image",o);const g="/images/variations",b=new URL(g,r.DUMMY_BASE_URL);let w;a&&(w=a.baseOptions);const O=Object.assign(Object.assign({method:"POST"},w),p),C={},k={},j=new(a&&a.formDataCtor||FormData);o!==void 0&&j.append("image",o),u!==void 0&&j.append("n",u),c!==void 0&&j.append("size",c),l!==void 0&&j.append("response_format",l),h!==void 0&&j.append("user",h),C["Content-Type"]="multipart/form-data",r.setSearchParams(b,k);let S=w&&w.headers?w.headers:{};return O.headers=Object.assign(Object.assign(Object.assign(Object.assign({},C),j.getHeaders()),S),p.headers),O.data=j,{url:r.toPathString(b),options:O}}),createModeration:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createModeration","createModerationRequest",o);const c="/moderations",l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"POST"},h),u),g={},b={};g["Content-Type"]="application/json",r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),p.data=r.serializeDataIfNeeded(o,p,a),{url:r.toPathString(l),options:p}}),createSearch:(o,u,c={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createSearch","engineId",o),r.assertParamExists("createSearch","createSearchRequest",u);const l="/engines/{engine_id}/search".replace("{engine_id}",encodeURIComponent(String(o))),h=new URL(l,r.DUMMY_BASE_URL);let p;a&&(p=a.baseOptions);const g=Object.assign(Object.assign({method:"POST"},p),c),b={},w={};b["Content-Type"]="application/json",r.setSearchParams(h,w);let O=p&&p.headers?p.headers:{};return g.headers=Object.assign(Object.assign(Object.assign({},b),O),c.headers),g.data=r.serializeDataIfNeeded(u,g,a),{url:r.toPathString(h),options:g}}),createTranscription:(o,u,c,l,h,p,g={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createTranscription","file",o),r.assertParamExists("createTranscription","model",u);const b="/audio/transcriptions",w=new URL(b,r.DUMMY_BASE_URL);let O;a&&(O=a.baseOptions);const C=Object.assign(Object.assign({method:"POST"},O),g),k={},j={},S=new(a&&a.formDataCtor||FormData);o!==void 0&&S.append("file",o),u!==void 0&&S.append("model",u),c!==void 0&&S.append("prompt",c),l!==void 0&&S.append("response_format",l),h!==void 0&&S.append("temperature",h),p!==void 0&&S.append("language",p),k["Content-Type"]="multipart/form-data",r.setSearchParams(w,j);let U=O&&O.headers?O.headers:{};return C.headers=Object.assign(Object.assign(Object.assign(Object.assign({},k),S.getHeaders()),U),g.headers),C.data=S,{url:r.toPathString(w),options:C}}),createTranslation:(o,u,c,l,h,p={})=>e(this,void 0,void 0,function*(){r.assertParamExists("createTranslation","file",o),r.assertParamExists("createTranslation","model",u);const g="/audio/translations",b=new URL(g,r.DUMMY_BASE_URL);let w;a&&(w=a.baseOptions);const O=Object.assign(Object.assign({method:"POST"},w),p),C={},k={},j=new(a&&a.formDataCtor||FormData);o!==void 0&&j.append("file",o),u!==void 0&&j.append("model",u),c!==void 0&&j.append("prompt",c),l!==void 0&&j.append("response_format",l),h!==void 0&&j.append("temperature",h),C["Content-Type"]="multipart/form-data",r.setSearchParams(b,k);let S=w&&w.headers?w.headers:{};return O.headers=Object.assign(Object.assign(Object.assign(Object.assign({},C),j.getHeaders()),S),p.headers),O.data=j,{url:r.toPathString(b),options:O}}),deleteFile:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("deleteFile","fileId",o);const c="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"DELETE"},h),u),g={},b={};r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),{url:r.toPathString(l),options:p}}),deleteModel:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("deleteModel","model",o);const c="/models/{model}".replace("{model}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"DELETE"},h),u),g={},b={};r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),{url:r.toPathString(l),options:p}}),downloadFile:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("downloadFile","fileId",o);const c="/files/{file_id}/content".replace("{file_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"GET"},h),u),g={},b={};r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),{url:r.toPathString(l),options:p}}),listEngines:(o={})=>e(this,void 0,void 0,function*(){const u="/engines",c=new URL(u,r.DUMMY_BASE_URL);let l;a&&(l=a.baseOptions);const h=Object.assign(Object.assign({method:"GET"},l),o),p={},g={};r.setSearchParams(c,g);let b=l&&l.headers?l.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},p),b),o.headers),{url:r.toPathString(c),options:h}}),listFiles:(o={})=>e(this,void 0,void 0,function*(){const u="/files",c=new URL(u,r.DUMMY_BASE_URL);let l;a&&(l=a.baseOptions);const h=Object.assign(Object.assign({method:"GET"},l),o),p={},g={};r.setSearchParams(c,g);let b=l&&l.headers?l.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},p),b),o.headers),{url:r.toPathString(c),options:h}}),listFineTuneEvents:(o,u,c={})=>e(this,void 0,void 0,function*(){r.assertParamExists("listFineTuneEvents","fineTuneId",o);const l="/fine-tunes/{fine_tune_id}/events".replace("{fine_tune_id}",encodeURIComponent(String(o))),h=new URL(l,r.DUMMY_BASE_URL);let p;a&&(p=a.baseOptions);const g=Object.assign(Object.assign({method:"GET"},p),c),b={},w={};u!==void 0&&(w.stream=u),r.setSearchParams(h,w);let O=p&&p.headers?p.headers:{};return g.headers=Object.assign(Object.assign(Object.assign({},b),O),c.headers),{url:r.toPathString(h),options:g}}),listFineTunes:(o={})=>e(this,void 0,void 0,function*(){const u="/fine-tunes",c=new URL(u,r.DUMMY_BASE_URL);let l;a&&(l=a.baseOptions);const h=Object.assign(Object.assign({method:"GET"},l),o),p={},g={};r.setSearchParams(c,g);let b=l&&l.headers?l.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},p),b),o.headers),{url:r.toPathString(c),options:h}}),listModels:(o={})=>e(this,void 0,void 0,function*(){const u="/models",c=new URL(u,r.DUMMY_BASE_URL);let l;a&&(l=a.baseOptions);const h=Object.assign(Object.assign({method:"GET"},l),o),p={},g={};r.setSearchParams(c,g);let b=l&&l.headers?l.headers:{};return h.headers=Object.assign(Object.assign(Object.assign({},p),b),o.headers),{url:r.toPathString(c),options:h}}),retrieveEngine:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("retrieveEngine","engineId",o);const c="/engines/{engine_id}".replace("{engine_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"GET"},h),u),g={},b={};r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),{url:r.toPathString(l),options:p}}),retrieveFile:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("retrieveFile","fileId",o);const c="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"GET"},h),u),g={},b={};r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),{url:r.toPathString(l),options:p}}),retrieveFineTune:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("retrieveFineTune","fineTuneId",o);const c="/fine-tunes/{fine_tune_id}".replace("{fine_tune_id}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"GET"},h),u),g={},b={};r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),{url:r.toPathString(l),options:p}}),retrieveModel:(o,u={})=>e(this,void 0,void 0,function*(){r.assertParamExists("retrieveModel","model",o);const c="/models/{model}".replace("{model}",encodeURIComponent(String(o))),l=new URL(c,r.DUMMY_BASE_URL);let h;a&&(h=a.baseOptions);const p=Object.assign(Object.assign({method:"GET"},h),u),g={},b={};r.setSearchParams(l,b);let w=h&&h.headers?h.headers:{};return p.headers=Object.assign(Object.assign(Object.assign({},g),w),u.headers),{url:r.toPathString(l),options:p}})}},n.OpenAIApiFp=function(a){const o=n.OpenAIApiAxiosParamCreator(a);return{cancelFineTune(u,c){return e(this,void 0,void 0,function*(){const l=yield o.cancelFineTune(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createAnswer(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createAnswer(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createChatCompletion(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createChatCompletion(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createClassification(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createClassification(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createCompletion(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createCompletion(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createEdit(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createEdit(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createEmbedding(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createEmbedding(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createFile(u,c,l){return e(this,void 0,void 0,function*(){const h=yield o.createFile(u,c,l);return r.createRequestFunction(h,t.default,s.BASE_PATH,a)})},createFineTune(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createFineTune(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createImage(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createImage(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createImageEdit(u,c,l,h,p,g,b,w){return e(this,void 0,void 0,function*(){const O=yield o.createImageEdit(u,c,l,h,p,g,b,w);return r.createRequestFunction(O,t.default,s.BASE_PATH,a)})},createImageVariation(u,c,l,h,p,g){return e(this,void 0,void 0,function*(){const b=yield o.createImageVariation(u,c,l,h,p,g);return r.createRequestFunction(b,t.default,s.BASE_PATH,a)})},createModeration(u,c){return e(this,void 0,void 0,function*(){const l=yield o.createModeration(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},createSearch(u,c,l){return e(this,void 0,void 0,function*(){const h=yield o.createSearch(u,c,l);return r.createRequestFunction(h,t.default,s.BASE_PATH,a)})},createTranscription(u,c,l,h,p,g,b){return e(this,void 0,void 0,function*(){const w=yield o.createTranscription(u,c,l,h,p,g,b);return r.createRequestFunction(w,t.default,s.BASE_PATH,a)})},createTranslation(u,c,l,h,p,g){return e(this,void 0,void 0,function*(){const b=yield o.createTranslation(u,c,l,h,p,g);return r.createRequestFunction(b,t.default,s.BASE_PATH,a)})},deleteFile(u,c){return e(this,void 0,void 0,function*(){const l=yield o.deleteFile(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},deleteModel(u,c){return e(this,void 0,void 0,function*(){const l=yield o.deleteModel(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},downloadFile(u,c){return e(this,void 0,void 0,function*(){const l=yield o.downloadFile(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},listEngines(u){return e(this,void 0,void 0,function*(){const c=yield o.listEngines(u);return r.createRequestFunction(c,t.default,s.BASE_PATH,a)})},listFiles(u){return e(this,void 0,void 0,function*(){const c=yield o.listFiles(u);return r.createRequestFunction(c,t.default,s.BASE_PATH,a)})},listFineTuneEvents(u,c,l){return e(this,void 0,void 0,function*(){const h=yield o.listFineTuneEvents(u,c,l);return r.createRequestFunction(h,t.default,s.BASE_PATH,a)})},listFineTunes(u){return e(this,void 0,void 0,function*(){const c=yield o.listFineTunes(u);return r.createRequestFunction(c,t.default,s.BASE_PATH,a)})},listModels(u){return e(this,void 0,void 0,function*(){const c=yield o.listModels(u);return r.createRequestFunction(c,t.default,s.BASE_PATH,a)})},retrieveEngine(u,c){return e(this,void 0,void 0,function*(){const l=yield o.retrieveEngine(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},retrieveFile(u,c){return e(this,void 0,void 0,function*(){const l=yield o.retrieveFile(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},retrieveFineTune(u,c){return e(this,void 0,void 0,function*(){const l=yield o.retrieveFineTune(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})},retrieveModel(u,c){return e(this,void 0,void 0,function*(){const l=yield o.retrieveModel(u,c);return r.createRequestFunction(l,t.default,s.BASE_PATH,a)})}}},n.OpenAIApiFactory=function(a,o,u){const c=n.OpenAIApiFp(a);return{cancelFineTune(l,h){return c.cancelFineTune(l,h).then(p=>p(u,o))},createAnswer(l,h){return c.createAnswer(l,h).then(p=>p(u,o))},createChatCompletion(l,h){return c.createChatCompletion(l,h).then(p=>p(u,o))},createClassification(l,h){return c.createClassification(l,h).then(p=>p(u,o))},createCompletion(l,h){return c.createCompletion(l,h).then(p=>p(u,o))},createEdit(l,h){return c.createEdit(l,h).then(p=>p(u,o))},createEmbedding(l,h){return c.createEmbedding(l,h).then(p=>p(u,o))},createFile(l,h,p){return c.createFile(l,h,p).then(g=>g(u,o))},createFineTune(l,h){return c.createFineTune(l,h).then(p=>p(u,o))},createImage(l,h){return c.createImage(l,h).then(p=>p(u,o))},createImageEdit(l,h,p,g,b,w,O,C){return c.createImageEdit(l,h,p,g,b,w,O,C).then(k=>k(u,o))},createImageVariation(l,h,p,g,b,w){return c.createImageVariation(l,h,p,g,b,w).then(O=>O(u,o))},createModeration(l,h){return c.createModeration(l,h).then(p=>p(u,o))},createSearch(l,h,p){return c.createSearch(l,h,p).then(g=>g(u,o))},createTranscription(l,h,p,g,b,w,O){return c.createTranscription(l,h,p,g,b,w,O).then(C=>C(u,o))},createTranslation(l,h,p,g,b,w){return c.createTranslation(l,h,p,g,b,w).then(O=>O(u,o))},deleteFile(l,h){return c.deleteFile(l,h).then(p=>p(u,o))},deleteModel(l,h){return c.deleteModel(l,h).then(p=>p(u,o))},downloadFile(l,h){return c.downloadFile(l,h).then(p=>p(u,o))},listEngines(l){return c.listEngines(l).then(h=>h(u,o))},listFiles(l){return c.listFiles(l).then(h=>h(u,o))},listFineTuneEvents(l,h,p){return c.listFineTuneEvents(l,h,p).then(g=>g(u,o))},listFineTunes(l){return c.listFineTunes(l).then(h=>h(u,o))},listModels(l){return c.listModels(l).then(h=>h(u,o))},retrieveEngine(l,h){return c.retrieveEngine(l,h).then(p=>p(u,o))},retrieveFile(l,h){return c.retrieveFile(l,h).then(p=>p(u,o))},retrieveFineTune(l,h){return c.retrieveFineTune(l,h).then(p=>p(u,o))},retrieveModel(l,h){return c.retrieveModel(l,h).then(p=>p(u,o))}}};class i extends s.BaseAPI{cancelFineTune(o,u){return n.OpenAIApiFp(this.configuration).cancelFineTune(o,u).then(c=>c(this.axios,this.basePath))}createAnswer(o,u){return n.OpenAIApiFp(this.configuration).createAnswer(o,u).then(c=>c(this.axios,this.basePath))}createChatCompletion(o,u){return n.OpenAIApiFp(this.configuration).createChatCompletion(o,u).then(c=>c(this.axios,this.basePath))}createClassification(o,u){return n.OpenAIApiFp(this.configuration).createClassification(o,u).then(c=>c(this.axios,this.basePath))}createCompletion(o,u){return n.OpenAIApiFp(this.configuration).createCompletion(o,u).then(c=>c(this.axios,this.basePath))}createEdit(o,u){return n.OpenAIApiFp(this.configuration).createEdit(o,u).then(c=>c(this.axios,this.basePath))}createEmbedding(o,u){return n.OpenAIApiFp(this.configuration).createEmbedding(o,u).then(c=>c(this.axios,this.basePath))}createFile(o,u,c){return n.OpenAIApiFp(this.configuration).createFile(o,u,c).then(l=>l(this.axios,this.basePath))}createFineTune(o,u){return n.OpenAIApiFp(this.configuration).createFineTune(o,u).then(c=>c(this.axios,this.basePath))}createImage(o,u){return n.OpenAIApiFp(this.configuration).createImage(o,u).then(c=>c(this.axios,this.basePath))}createImageEdit(o,u,c,l,h,p,g,b){return n.OpenAIApiFp(this.configuration).createImageEdit(o,u,c,l,h,p,g,b).then(w=>w(this.axios,this.basePath))}createImageVariation(o,u,c,l,h,p){return n.OpenAIApiFp(this.configuration).createImageVariation(o,u,c,l,h,p).then(g=>g(this.axios,this.basePath))}createModeration(o,u){return n.OpenAIApiFp(this.configuration).createModeration(o,u).then(c=>c(this.axios,this.basePath))}createSearch(o,u,c){return n.OpenAIApiFp(this.configuration).createSearch(o,u,c).then(l=>l(this.axios,this.basePath))}createTranscription(o,u,c,l,h,p,g){return n.OpenAIApiFp(this.configuration).createTranscription(o,u,c,l,h,p,g).then(b=>b(this.axios,this.basePath))}createTranslation(o,u,c,l,h,p){return n.OpenAIApiFp(this.configuration).createTranslation(o,u,c,l,h,p).then(g=>g(this.axios,this.basePath))}deleteFile(o,u){return n.OpenAIApiFp(this.configuration).deleteFile(o,u).then(c=>c(this.axios,this.basePath))}deleteModel(o,u){return n.OpenAIApiFp(this.configuration).deleteModel(o,u).then(c=>c(this.axios,this.basePath))}downloadFile(o,u){return n.OpenAIApiFp(this.configuration).downloadFile(o,u).then(c=>c(this.axios,this.basePath))}listEngines(o){return n.OpenAIApiFp(this.configuration).listEngines(o).then(u=>u(this.axios,this.basePath))}listFiles(o){return n.OpenAIApiFp(this.configuration).listFiles(o).then(u=>u(this.axios,this.basePath))}listFineTuneEvents(o,u,c){return n.OpenAIApiFp(this.configuration).listFineTuneEvents(o,u,c).then(l=>l(this.axios,this.basePath))}listFineTunes(o){return n.OpenAIApiFp(this.configuration).listFineTunes(o).then(u=>u(this.axios,this.basePath))}listModels(o){return n.OpenAIApiFp(this.configuration).listModels(o).then(u=>u(this.axios,this.basePath))}retrieveEngine(o,u){return n.OpenAIApiFp(this.configuration).retrieveEngine(o,u).then(c=>c(this.axios,this.basePath))}retrieveFile(o,u){return n.OpenAIApiFp(this.configuration).retrieveFile(o,u).then(c=>c(this.axios,this.basePath))}retrieveFineTune(o,u){return n.OpenAIApiFp(this.configuration).retrieveFineTune(o,u).then(c=>c(this.axios,this.basePath))}retrieveModel(o,u){return n.OpenAIApiFp(this.configuration).retrieveModel(o,u).then(c=>c(this.axios,this.basePath))}}n.OpenAIApi=i})(Ya);var qr={};const Nf="openai",Lf="3.3.0",Uf="Node.js library for the OpenAI API",Mf={type:"git",url:"git@github.com:openai/openai-node.git"},Ff=["openai","open","ai","gpt-3","gpt3"],Zf="OpenAI",Vf="MIT",Bf="./dist/index.js",qf="./dist/index.d.ts",zf={build:"tsc --outDir dist/"},Hf={axios:"^0.26.0","form-data":"^4.0.0"},Kf={"@types/node":"^12.11.5",typescript:"^3.6.4"},Jf={name:Nf,version:Lf,description:Uf,repository:Mf,keywords:Ff,author:Zf,license:Vf,main:Bf,types:qf,scripts:zf,dependencies:Hf,devDependencies:Kf};var Un,Ui;function Gf(){return Ui||(Ui=1,Un=typeof self=="object"?self.FormData:window.FormData),Un}Object.defineProperty(qr,"__esModule",{value:!0});qr.Configuration=void 0;const Wf=Jf;class Yf{constructor(e={}){this.apiKey=e.apiKey,this.organization=e.organization,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor,this.baseOptions||(this.baseOptions={}),this.baseOptions.headers=Object.assign({"User-Agent":`OpenAI/NodeJS/${Wf.version}`,Authorization:`Bearer ${this.apiKey}`},this.baseOptions.headers),this.organization&&(this.baseOptions.headers["OpenAI-Organization"]=this.organization),this.formDataCtor||(this.formDataCtor=Gf())}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(;.*)?$","i");return e!==null&&(t.test(e)||e.toLowerCase()==="application/json-patch+json")}}qr.Configuration=Yf;(function(n){var e=z&&z.__createBinding||(Object.create?function(r,s,i,a){a===void 0&&(a=i),Object.defineProperty(r,a,{enumerable:!0,get:function(){return s[i]}})}:function(r,s,i,a){a===void 0&&(a=i),r[a]=s[i]}),t=z&&z.__exportStar||function(r,s){for(var i in r)i!=="default"&&!s.hasOwnProperty(i)&&e(s,r,i)};Object.defineProperty(n,"__esModule",{value:!0}),t(Ya,n),t(qr,n)})(sr);const Qf=()=>typeof window<"u"&&typeof window.document<"u",Xf=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",ep=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),fo=()=>typeof Deno<"u",xs=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!fo(),tp=()=>{let n;return Qf()?n="browser":xs()?n="node":Xf()?n="webworker":ep()?n="jsdom":fo()?n="deno":n="other",n};let Mn;async function rp(){return Mn===void 0&&(Mn={library:"langchain-js",runtime:tp()}),Mn}function te(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}const as="text/event-stream";async function np(n,e){const t=n.getReader();for(;;){const r=await t.read();if(r.done){e(new Uint8Array,!0);break}e(r.value)}}function sp(n){let e,t,r,s=!1;return function(a,o){if(o){n(a,0,!0);return}e===void 0?(e=a,t=0,r=-1):e=ap(e,a);const u=e.length;let c=0;for(;t<u;){s&&(e[t]===10&&(c=++t),s=!1);let l=-1;for(;t<u&&l===-1;++t)switch(e[t]){case 58:r===-1&&(r=t-c);break;case 13:s=!0;case 10:l=t;break}if(l===-1)break;n(e.subarray(c,l),r),c=t,r=-1}c===u?e=void 0:c!==0&&(e=e.subarray(c),t-=c)}}function ip(n,e,t){let r=Fn();const s=new TextDecoder;return function(a,o,u){if(u){op(r)||(n==null||n(r),r=Fn());return}if(a.length===0)n==null||n(r),r=Fn();else if(o>0){const c=s.decode(a.subarray(0,o)),l=o+(a[o+1]===32?2:1),h=s.decode(a.subarray(l));switch(c){case"data":r.data=r.data?r.data+`
`+h:h;break;case"event":r.event=h;break;case"id":e==null||e(r.id=h);break;case"retry":{const p=parseInt(h,10);Number.isNaN(p)||t==null||t(r.retry=p);break}}}}}function ap(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Fn(){return{data:"",event:"",id:"",retry:void 0}}function op(n){return n.data===""&&n.event===""&&n.id===""&&n.retry===void 0}function cp(n){try{return JSON.stringify(n)}catch{return n}}function up(n,e,t){const{validateStatus:r}=t.config;!t.status||!r||r(t.status)?n(t):e(Ir(`Request failed with status code ${t.status} and body ${typeof t.data=="string"?t.data:cp(t.data)}`,t.config,null,t.request,t))}function lp(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function dp(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}function Mi(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function hp(n,e,t){if(!e)return n;var r;if(t)r=t(e);else if(yp(e))r=e.toString();else{var s=[];Fi(e,function(o,u){o===null||typeof o>"u"||(po(o)?u=`${u}[]`:o=[o],Fi(o,function(l){gp(l)?l=l.toISOString():mp(l)&&(l=JSON.stringify(l)),s.push(`${Mi(u)}=${Mi(l)}`)}))}),r=s.join("&")}if(r){var i=n.indexOf("#");i!==-1&&(n=n.slice(0,i)),n+=(n.indexOf("?")===-1?"?":"&")+r}return n}function fp(n,e){return n&&!lp(e)?dp(n,e):e}function pp(n){return typeof n>"u"}function mp(n){return n!==null&&typeof n=="object"}function gp(n){return toString.call(n)==="[object Date]"}function yp(n){return toString.call(n)==="[object URLSearchParams]"}function po(n){return Array.isArray(n)}function Fi(n,e){if(!(n===null||typeof n>"u"))if(typeof n!="object"&&(n=[n]),po(n))for(var t=0,r=n.length;t<r;t++)e.call(null,n[t],t,n);else for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.call(null,n[s],s,n)}function vp(n){return toString.call(n)==="[object FormData]"}function bp(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}async function os(n){const e=wp(n),t=await _p(e,n);return new Promise((r,s)=>{t instanceof Error?s(t):Object.prototype.toString.call(n.settle)==="[object Function]"?n.settle(r,s,t):up(r,s,t)})}async function _p(n,e){let t;try{t=await fetch(n)}catch(i){return i&&i.name==="AbortError"?Ir("Request aborted",e,"ECONNABORTED",n):i&&i.name==="TimeoutError"?Ir("Request timeout",e,"ECONNABORTED",n):Ir("Network Error",e,"ERR_NETWORK",n)}const r={};t.headers.forEach((i,a)=>{r[a]=i});const s={ok:t.ok,status:t.status,statusText:t.statusText,headers:r,config:e,request:n};if(t.status>=200&&t.status!==204)if(e.responseType==="stream"){const i=t.headers.get("content-type");if(!(i!=null&&i.startsWith(as))){if(t.status>=400)return i!=null&&i.startsWith("application/json")?(s.data=await t.json(),s):(s.data=await t.text(),s);throw new Error(`Expected content-type to be ${as}, Actual: ${i}`)}await np(t.body,sp(ip(e.onmessage)))}else switch(e.responseType){case"arraybuffer":s.data=await t.arrayBuffer();break;case"blob":s.data=await t.blob();break;case"json":s.data=await t.json();break;case"formData":s.data=await t.formData();break;default:s.data=await t.text();break}return s}function wp(n){const e=new Headers(n.headers);if(n.auth){const a=n.auth.username||"",o=n.auth.password?decodeURI(encodeURIComponent(n.auth.password)):"";e.set("Authorization",`Basic ${btoa(`${a}:${o}`)}`)}const t=n.method.toUpperCase(),r={headers:e,method:t};t!=="GET"&&t!=="HEAD"&&(r.body=n.data,vp(r.body)&&bp()&&e.delete("Content-Type")),typeof r.body=="string"&&(r.body=new TextEncoder().encode(r.body)),n.mode&&(r.mode=n.mode),n.cache&&(r.cache=n.cache),n.integrity&&(r.integrity=n.integrity),n.redirect&&(r.redirect=n.redirect),n.referrer&&(r.referrer=n.referrer),n.timeout&&n.timeout>0&&(r.signal=AbortSignal.timeout(n.timeout)),n.signal&&(r.signal=n.signal),pp(n.withCredentials)||(r.credentials=n.withCredentials?"include":"omit"),n.responseType==="stream"&&r.headers.set("Accept",as);const s=fp(n.baseURL,n.url),i=hp(s,n.params,n.paramsSerializer);return new Request(i,r)}function Ir(n,e,t,r,s){if(Pr.AxiosError&&typeof Pr.AxiosError=="function")return new Pr.AxiosError(n,Pr.AxiosError[t],e,r,s);const i=new Error(n);return Op(i,e,t,r,s)}function Op(n,e,t,r,s){return n.config=e,t&&(n.code=t),n.request=r,n.response=s,n.isAxiosError=!0,n.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},n}const Tp=(n,e)=>n.reduce((t,r,s)=>{const i=Math.floor(s/e),a=t[i]||[];return t[i]=a.concat([r]),t},[]);class Pp{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new Ps(e??{})}}class Ep extends Pp{constructor(e,t){super(e??{}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const r=(e==null?void 0:e.openAIApiKey)??te("OPENAI_API_KEY"),s=(e==null?void 0:e.azureOpenAIApiKey)??te("AZURE_OPENAI_API_KEY");if(!s&&!r)throw new Error("(Azure) OpenAI API key not found");const i=(e==null?void 0:e.azureOpenAIApiInstanceName)??te("AZURE_OPENAI_API_INSTANCE_NAME"),a=((e==null?void 0:e.azureOpenAIApiEmbeddingsDeploymentName)||(e==null?void 0:e.azureOpenAIApiDeploymentName))??(te("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||te("AZURE_OPENAI_API_DEPLOYMENT_NAME")),o=(e==null?void 0:e.azureOpenAIApiVersion)??te("AZURE_OPENAI_API_VERSION");if(this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.batchSize=(e==null?void 0:e.batchSize)??s?1:this.batchSize,this.stripNewLines=(e==null?void 0:e.stripNewLines)??this.stripNewLines,this.timeout=e==null?void 0:e.timeout,this.azureOpenAIApiVersion=o,this.azureOpenAIApiKey=s,this.azureOpenAIApiInstanceName=i,this.azureOpenAIApiDeploymentName=a,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found")}this.clientConfig={apiKey:r,...t}}async embedDocuments(e){const t=Tp(this.stripNewLines?e.map(s=>s.replaceAll(`
`," ")):e,this.batchSize),r=[];for(let s=0;s<t.length;s+=1){const i=t[s],{data:a}=await this.embeddingWithRetry({model:this.modelName,input:i});for(let o=0;o<i.length;o+=1)r.push(a.data[o].embedding)}return r}async embedQuery(e){const{data:t}=await this.embeddingWithRetry({model:this.modelName,input:this.stripNewLines?e.replaceAll(`
`," "):e});return t.data[0].embedding}async embeddingWithRetry(e){if(!this.client){const r=this.azureOpenAIApiKey?`https://${this.azureOpenAIApiInstanceName}.openai.azure.com/openai/deployments/${this.azureOpenAIApiDeploymentName}`:this.clientConfig.basePath,s=new sr.Configuration({...this.clientConfig,basePath:r,baseOptions:{timeout:this.timeout,adapter:xs()?void 0:os,...this.clientConfig.baseOptions}});this.client=new sr.OpenAIApi(s)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.params={"api-version":this.azureOpenAIApiVersion,...t.params}),this.caller.call(this.client.createEmbedding.bind(this.client),e,t)}}const cs=n=>n.startsWith("gpt-3.5-turbo-16k-")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k-")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n,Ap=()=>!1;class Sp extends tr{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??Ap(),this.callbacks=e.callbacks,this.tags=e.tags??[]}}class Ip extends Sp{get callKeys(){return["stop","timeout","signal"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new Ps(r??{})}async getNumTokens(e){let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await Ah("modelName"in this?cs(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return this._encoding&&(t=this._encoding.encode(e).length),t}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){const{_type:t,_model:r,...s}=e;if(r&&r!=="base_chat_model")throw new Error(`Cannot load LLM with model ${r}`);const i={openai:(await Pt(()=>Promise.resolve().then(()=>Lm),void 0)).ChatOpenAI}[t];if(i===void 0)throw new Error(`Cannot load  LLM with type ${t}`);return new i(s)}}class Cp{}class ur extends Cp{get lc_namespace(){return["langchain","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e){var t;super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:typeof process<"u"?((t=process.env)==null?void 0:t.LANGCHAIN_CALLBACKS_BACKGROUND)!=="true":!0}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent)}copy(){return new this.constructor(this)}toJSON(){return tr.prototype.toJSON.call(this)}toJSONNotImplemented(){return tr.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends ur{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Fe()}),Object.assign(this,e)}}return new t}}var Ds={exports:{}};Ds.exports;(function(n){const t=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,r=(i=0)=>(a,o,u)=>`\x1B[${38+i};2;${a};${o};${u}m`;function s(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,u]of Object.entries(a)){for(const[c,l]of Object.entries(u))a[c]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},u[c]=a[c],i.set(l[0],l[1]);Object.defineProperty(a,o,{value:u,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=r(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,u,c)=>o===u&&u===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:c}=u.groups;c.length===3&&(c=c.split("").map(h=>h+h).join(""));const l=Number.parseInt(c,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(n,"exports",{enumerable:!0,get:s})})(Ds);var jp=Ds.exports;const mo=or(jp);class $s extends ur{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}_startTrace(e){if(e.parent_run_id!==void 0){const t=this.runMap.get(e.parent_run_id);t&&this._addChildRun(t,e)}this.runMap.set(e.id,e)}async _endTrace(e){const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,s,i,a){var l;const o=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:u}],inputs:{prompts:t},execution_order:o,child_runs:[],child_execution_order:o,run_type:"llm",extra:i??{},tags:a||[]};this._startTrace(c),await((l=this.onLLMStart)==null?void 0:l.call(this,c))}async handleChatModelStart(e,t,r,s,i,a){var l;const o=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:u}],inputs:{messages:t},execution_order:o,child_runs:[],child_execution_order:o,run_type:"llm",extra:i??{},tags:a||[]};this._startTrace(c),await((l=this.onLLMStart)==null?void 0:l.call(this,c))}async handleLLMEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:r.end_time}),await((s=this.onLLMEnd)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleLLMError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await((s=this.onLLMError)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleChainStart(e,t,r,s,i){var c;const a=this._getExecutionOrder(s),o=Date.now(),u={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:o,serialized:e,events:[{name:"start",time:o}],inputs:t,execution_order:a,child_execution_order:a,run_type:"chain",child_runs:[],extra:{},tags:i||[]};this._startTrace(u),await((c=this.onChainStart)==null?void 0:c.call(this,u))}async handleChainEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")throw new Error("No chain run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:r.end_time}),await((s=this.onChainEnd)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleChainError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")throw new Error("No chain run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await((s=this.onChainError)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleToolStart(e,t,r,s,i){var c;const a=this._getExecutionOrder(s),o=Date.now(),u={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:o,serialized:e,events:[{name:"start",time:o}],inputs:{input:t},execution_order:a,child_execution_order:a,run_type:"tool",child_runs:[],extra:{},tags:i||[]};this._startTrace(u),await((c=this.onToolStart)==null?void 0:c.call(this,u))}async handleToolEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:r.end_time}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleToolError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:r.end_time}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleAgentAction(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:Date.now(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleText(e,t){var s;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:Date.now(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}}function ge(n,e){return`${n.open}${e}${n.close}`}function Ne(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function ft(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:_e}=mo;class Zi extends $s{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)t.push(s),r=s;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?ge(mo.bold,o):o}).join(" > ");return ge(_e.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${ge(_e.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Ne(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ge(_e.cyan,"[chain/end]")} [${t}] [${ft(e)}] Exiting Chain run with output: ${Ne(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${ge(_e.red,"[chain/error]")} [${t}] [${ft(e)}] Chain run errored with error: ${Ne(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${ge(_e.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Ne(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ge(_e.cyan,"[llm/end]")} [${t}] [${ft(e)}] Exiting LLM run with output: ${Ne(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${ge(_e.red,"[llm/error]")} [${t}] [${ft(e)}] LLM run errored with error: ${Ne(e.error,"[error]")}`)}onToolStart(e){var r;const t=this.getBreadcrumbs(e);console.log(`${ge(_e.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(r=e.inputs.input)==null?void 0:r.trim()}"`)}onToolEnd(e){var r,s;const t=this.getBreadcrumbs(e);console.log(`${ge(_e.cyan,"[tool/end]")} [${t}] [${ft(e)}] Exiting Tool run with output: "${(s=(r=e.outputs)==null?void 0:r.output)==null?void 0:s.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${ge(_e.red,"[tool/error]")} [${t}] [${ft(e)}] Tool run errored with error: ${Ne(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${ge(_e.blue,"[agent/action]")} [${r}] Agent selected action: ${Ne(t.actions[t.actions.length-1],"[action]")}`)}}const kp=[400,401,403,404,405,406,407,408,409];class Rp{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in Re?Re.default:Re;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>za(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt(r){var i;if(r.message.startsWith("Cancel")||r.message.startsWith("TimeoutError")||r.message.startsWith("AbortError")||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const s=(i=r==null?void 0:r.response)==null?void 0:i.status;if(s&&kp.includes(+s))throw r},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}const xp=()=>typeof window<"u"&&typeof window.document<"u",Dp=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",$p=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),go=()=>typeof Deno<"u",Np=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!go(),Lp=()=>{let n;return xp()?n="browser":Np()?n="node":Dp()?n="webworker":$p()?n="jsdom":go()?n="deno":n="other",n};let Zn;async function Up(){return Zn===void 0&&(Zn={library:"langchainplus-sdk",runtime:Lp()}),Zn}function Vi(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}const Mp=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"},Vn=async(n,e)=>{const t=await n.text();if(!n.ok)throw new Error(`Failed to ${e}: ${n.status} ${n.statusText} ${t}`)};class Ns{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=Ns.getDefaultClientConfig();this.apiUrl=e.apiUrl??t.apiUrl,this.apiKey=e.apiKey??t.apiKey,this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??4e3,this.caller=new Rp(e.callerOptions??{})}static getDefaultClientConfig(){return{apiUrl:Vi("LANGCHAIN_ENDPOINT")??"http://localhost:1984",apiKey:Vi("LANGCHAIN_API_KEY")}}validateApiKeyIfHosted(){if(!Mp(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangChain+ API")}get headers(){const e={};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async _get(e,t){const r=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i.json()}async createRun(e){const t={...this.headers,"Content-Type":"application/json"},r=e.extra??{},s=await Up(),i={...e,extra:{...e.extra,runtime:{...s,...r.runtime}}},a=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)});await Vn(a,"create run")}async updateRun(e,t){const r={...this.headers,"Content-Type":"application/json"},s=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:r,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await Vn(s,"update run")}async readRun(e){return await this._get(`/runs/${e}`)}async listRuns({sessionId:e,sessionName:t,executionOrder:r,runType:s,error:i}){const a=new URLSearchParams;let o=e;if(t){if(e)throw new Error("Only one of sessionId or sessionName may be given");o=(await this.readSession({sessionName:t})).id}return o&&a.append("session",o),r&&a.append("execution_order",r.toString()),s&&a.append("run_type",s),i!==void 0&&a.append("error",i.toString()),this._get("/runs",a)}async createSession({sessionName:e,sessionExtra:t}){const r=`${this.apiUrl}/sessions?upsert=true`,s={name:e,extra:t},i=await this.caller.call(fetch,r,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)}),a=await i.json();if(!i.ok)throw new Error(`Failed to create session ${e}: ${i.status} ${i.statusText}`);return a}async readSession({sessionId:e,sessionName:t}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either sessionName or sessionId, not both");if(e!==void 0)r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide sessionName or sessionId");const i=await this._get(r,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Session[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async listSessions(){return this._get("/sessions")}async deleteSession({sessionId:e,sessionName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide sessionName or sessionId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either sessionName or sessionId, not both");e===void 0?r=(await this.readSession({sessionName:t})).id:r=e;const s=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await Vn(s,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:i}){const a=`${this.apiUrl}/datasets/upload`,o=new FormData;o.append("file",e,t),o.append("input_keys",r.join(",")),o.append("output_keys",s.join(",")),i&&o.append("description",i);const u=await this.caller.call(fetch,a,{method:"POST",headers:this.headers,body:o,signal:AbortSignal.timeout(this.timeout_ms)});if(!u.ok){const l=await u.json();throw l.detail&&l.detail.includes("already exists")?new Error(`Dataset ${t} already exists`):new Error(`Failed to upload CSV: ${u.status} ${u.statusText}`)}return await u.json()}async createDataset(e,{description:t}={}){const r=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:e,description:t}),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok){const i=await r.json();throw i.detail&&i.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${r.status} ${r.statusText}`)}return await r.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async listDatasets({limit:e=100}={}){const t="/datasets",r=new URLSearchParams({limit:e.toString()}),s=await this._get(t,r);if(!Array.isArray(s))throw new Error(`Expected ${t} to return an array, but got ${s}`);return s}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to delete ${r}: ${i.status} ${i.statusText}`);return await i.json()}async createExample(e,t,{datasetId:r,datasetName:s,createdAt:i}){let a=r;if(a===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:s})).id);const u={dataset_id:a,inputs:e,outputs:t,created_at:(i||new Date).toISOString()},c=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok)throw new Error(`Failed to create example: ${c.status} ${c.statusText}`);return await c.json()}async readExample(e){const t=`/examples/${e}`;return await this._get(t)}async listExamples({datasetId:e,datasetName:t}={}){let r;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)r=e;else if(t!==void 0)r=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const s=await this._get("/examples",new URLSearchParams({dataset:r}));if(!Array.isArray(s))throw new Error(`Expected /examples to return an array, but got ${s}`);return s}async deleteExample(e){const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);return await r.json()}async updateExample(e,t){const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r}={}){let s;if(typeof e=="string")s=await this.readRun(e);else if(typeof e=="object"&&"id"in e)s=e;else throw new Error(`Invalid run type: ${typeof e}`);let i;s.reference_example_id!==null&&s.reference_example_id!==void 0&&(i=await this.readExample(s.reference_example_id));const a=await t.evaluateRun(s,i);let o=r??{};return a.evaluatorInfo&&(o={...o,...a.evaluatorInfo}),await this.createFeedback(s.id,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,feedbackSourceType:"MODEL"})}async createFeedback(e,t,{score:r,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:u="API"}){let c;if(u==="API")c={type:"api",metadata:o??{}};else if(u==="MODEL")c={type:"model",metadata:o??{}};else throw new Error(`Unknown feedback source type ${u}`);const l={id:Fe(),run_id:e,key:t,score:r,value:s,correction:i,comment:a,feedback_source:c},h=await this.caller.call(fetch,`${this.apiUrl}/feedback`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!h.ok)throw new Error(`Failed to create feedback for run ${e}: ${h.status} ${h.statusText}`);return await h.json()}async readFeedback(e){const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);return await r.json()}async listFeedback({runIds:e}={}){const t=new URLSearchParams;return e&&t.append("run",e.join(",")),await this._get("/feedback",t)}}class Fp extends $s{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"sessionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,sessionName:r,client:s}=e;this.sessionName=r??te("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??new Ns({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await rp()},child_runs:void 0,session_name:this.sessionName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events};await this.client.updateRun(e.id,t)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}function yo(n,e="Human",t="AI"){const r=[];for(const s of n){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s}`);r.push(`${i}: ${s.text}`)}return r.join(`
`)}class Zp extends $s{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:te("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=te("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){var i;const t=this.session??await this.loadDefaultSession(),r=e.serialized;let s;if(e.run_type==="llm"){const a=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(u=>yo(u));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:a,response:e.outputs}}else if(e.run_type==="chain"){const a=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:a.filter(u=>u.type==="llm"),child_chain_runs:a.filter(u=>u.type==="chain"),child_tool_runs:a.filter(u=>u.type==="tool")}}else if(e.run_type==="tool"){const a=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:(i=e.outputs)==null?void 0:i.output,action:JSON.stringify(r),child_llm_runs:a.filter(u=>u.type==="llm"),child_chain_runs:a.filter(u=>u.type==="chain"),child_tool_runs:a.filter(u=>u.type==="tool")}}else throw new Error(`Unknown run type: ${e.run_type}`);return s}async persistRun(e){let t,r;e.run_type!==void 0?r=await this.convertV2RunToRun(e):r=e,r.type==="llm"?t=`${this.endpoint}/llm-runs`:r.type==="chain"?t=`${this.endpoint}/chain-runs`:t=`${this.endpoint}/tool-runs`;const s=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});s.ok||console.error(`Failed to persist run: ${s.status} ${s.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let r;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),r={id:1,start_time:Date.now()},this.session=r,r;const s=await t.json();return s.length===0?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=s,this.session=r,r)}}async function Vp(n){const e=new Zp;return n?await e.loadSession(n):await e.loadDefaultSession(),e}async function Bp(){return new Fp}let Bn;function qp(){const n="default"in Re?Re.default:Re;return new n({autoStart:!0,concurrency:1})}async function le(n,e){e===!0?await n():(typeof Bn>"u"&&(Bn=qp()),Bn.add(n))}class zp{setHandler(e){return this.setHandlers([e])}}class Ls{constructor(e,t,r,s,i,a){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:a})}async handleText(e){await Promise.all(this.handlers.map(t=>le(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleText: ${s}`)}},t.awaitHandlers)))}}class Bi extends Ls{async handleLLMNewToken(e){await Promise.all(this.handlers.map(t=>le(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMNewToken)==null?void 0:r.call(t,e,this.runId,this._parentRunId))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMNewToken: ${s}`)}},t.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>le(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMError)==null?void 0:r.call(t,e,this.runId,this._parentRunId))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${s}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${s}`)}},t.awaitHandlers)))}}class Hp extends Ls{getChild(e){const t=new tt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),e&&t.addTags([e],!1),t}async handleChainError(e){await Promise.all(this.handlers.map(t=>le(async()=>{var r;if(!t.ignoreChain)try{await((r=t.handleChainError)==null?void 0:r.call(t,e,this.runId,this._parentRunId))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${s}`)}},t.awaitHandlers)))}async handleChainEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{var r;if(!t.ignoreChain)try{await((r=t.handleChainEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${s}`)}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>le(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`)}},t.awaitHandlers)))}}class Kp extends Ls{getChild(e){const t=new tt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>le(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${s}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`)}},t.awaitHandlers)))}}class tt extends zp{constructor(e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=[],this.inheritableHandlers=[],this._parentRunId=e}async handleLLMStart(e,t,r=Fe(),s=void 0,i=void 0){return await Promise.all(this.handlers.map(a=>le(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMStart)==null?void 0:o.call(a,e,t,r,this._parentRunId,i,this.tags))}catch(u){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${u}`)}},a.awaitHandlers))),new Bi(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this._parentRunId)}async handleChatModelStart(e,t,r=Fe(),s=void 0,i=void 0){let a;return await Promise.all(this.handlers.map(o=>le(async()=>{var u,c;if(!o.ignoreLLM)try{o.handleChatModelStart?await((u=o.handleChatModelStart)==null?void 0:u.call(o,e,t,r,this._parentRunId,i,this.tags)):o.handleLLMStart&&(a=t.map(l=>yo(l)),await((c=o.handleLLMStart)==null?void 0:c.call(o,e,a,r,this._parentRunId,i,this.tags)))}catch(l){console.error(`Error in handler ${o.constructor.name}, handleLLMStart: ${l}`)}},o.awaitHandlers))),new Bi(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this._parentRunId)}async handleChainStart(e,t,r=Fe()){return await Promise.all(this.handlers.map(s=>le(async()=>{var i;if(!s.ignoreChain)try{await((i=s.handleChainStart)==null?void 0:i.call(s,e,t,r,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${s.constructor.name}, handleChainStart: ${a}`)}},s.awaitHandlers))),new Hp(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this._parentRunId)}async handleToolStart(e,t,r=Fe()){return await Promise.all(this.handlers.map(s=>le(async()=>{var i;if(!s.ignoreAgent)try{await((i=s.handleToolStart)==null?void 0:i.call(s,e,t,r,this._parentRunId,this.tags))}catch(a){console.error(`Error in handler ${s.constructor.name}, handleToolStart: ${a}`)}},s.awaitHandlers))),new Kp(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}copy(e=[],t=!0){const r=new tt(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);r.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);r.addTags([s],i)}for(const s of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||r.addHandler(s,t);return r}static fromHandlers(e){class t extends ur{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Fe()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,s,i){let a;(e||t)&&(Array.isArray(e)||!e?(a=new tt,a.setHandlers((e==null?void 0:e.map(qi))??[],!0)):a=e,a=a.copy(Array.isArray(t)?t.map(qi):t==null?void 0:t.handlers,!1));const o=te("LANGCHAIN_VERBOSE")||(i==null?void 0:i.verbose),u=te("LANGCHAIN_TRACING_V2")??!1,c=u||(te("LANGCHAIN_TRACING")??!1);if(o||c){if(a||(a=new tt),o&&!a.handlers.some(l=>l.name===Zi.prototype.name)){const l=new Zi;a.addHandler(l,!0)}if(c&&!a.handlers.some(l=>l.name==="langchain_tracer"))if(u)a.addHandler(await Bp(),!0);else{const l=te("LANGCHAIN_SESSION");a.addHandler(await Vp(l),!0)}}return(r||s)&&a&&(a.addTags(r??[]),a.addTags(s??[],!1)),a}}function qi(n){return"name"in n?n:ur.fromMethods(n)}class Jp extends Ip{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}async generate(e,t,r){var h;const s=[],i=[];let a;Array.isArray(t)?a={stop:t}:t!=null&&t.timeout&&!t.signal?a={...t,signal:AbortSignal.timeout(t.timeout)}:a=t??{};const o=await tt.configure(r,this.callbacks,a.tags,this.tags,{verbose:this.verbose}),u={options:a,invocation_params:this==null?void 0:this.invocationParams()},c=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),e,void 0,void 0,u));try{const p=await Promise.all(e.map(g=>this._generate(g,a,c)));for(const g of p)g.llmOutput&&i.push(g.llmOutput),s.push(g.generations)}catch(p){throw await(c==null?void 0:c.handleLLMError(p)),p}const l={generations:s,llmOutput:i.length?(h=this._combineLLMOutput)==null?void 0:h.call(this,...i):void 0};return await(c==null?void 0:c.handleLLMEnd(l)),Object.defineProperty(l,Ud,{value:c?{runId:c==null?void 0:c.runId}:void 0,configurable:!0}),l}invocationParams(){return{}}_modelType(){return"base_chat_model"}async generatePrompt(e,t,r){const s=e.map(i=>i.toChatMessages());return this.generate(s,t,r)}async call(e,t,r){return(await this.generate([e],t,r)).generations[0][0].message}async callPrompt(e,t,r){const s=e.toChatMessages();return this.call(s,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const s=new Ua(e);return(await this.call([s],t,r)).text}}const Gp=async(n,e,t,r,s,i,a,o,u)=>(await n.call(fetch,"https://api.promptlayer.com/track-request",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({function_name:e,provider:"langchain",args:t,kwargs:r,tags:s,request_response:i,request_start_time:Math.floor(a/1e3),request_end_time:Math.floor(o/1e3),api_key:u})})).json();var vo={},zr={},$t={},Hr={},us={},Se={},Kr={},lr={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getParsedType=n.ZodParsedType=n.objectUtil=n.util=void 0;var e;(function(r){r.assertEqual=o=>o;function s(o){}r.assertIs=s;function i(o){throw new Error}r.assertNever=i,r.arrayToEnum=o=>{const u={};for(const c of o)u[c]=c;return u},r.getValidEnumValues=o=>{const u=r.objectKeys(o).filter(l=>typeof o[o[l]]!="number"),c={};for(const l of u)c[l]=o[l];return r.objectValues(c)},r.objectValues=o=>r.objectKeys(o).map(function(u){return o[u]}),r.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{const u=[];for(const c in o)Object.prototype.hasOwnProperty.call(o,c)&&u.push(c);return u},r.find=(o,u)=>{for(const c of o)if(u(c))return c},r.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&isFinite(o)&&Math.floor(o)===o;function a(o,u=" | "){return o.map(c=>typeof c=="string"?`'${c}'`:c).join(u)}r.joinValues=a,r.jsonStringifyReplacer=(o,u)=>typeof u=="bigint"?u.toString():u})(e=n.util||(n.util={})),function(r){r.mergeShapes=(s,i)=>({...s,...i})}(n.objectUtil||(n.objectUtil={})),n.ZodParsedType=e.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);const t=r=>{switch(typeof r){case"undefined":return n.ZodParsedType.undefined;case"string":return n.ZodParsedType.string;case"number":return isNaN(r)?n.ZodParsedType.nan:n.ZodParsedType.number;case"boolean":return n.ZodParsedType.boolean;case"function":return n.ZodParsedType.function;case"bigint":return n.ZodParsedType.bigint;case"symbol":return n.ZodParsedType.symbol;case"object":return Array.isArray(r)?n.ZodParsedType.array:r===null?n.ZodParsedType.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?n.ZodParsedType.promise:typeof Map<"u"&&r instanceof Map?n.ZodParsedType.map:typeof Set<"u"&&r instanceof Set?n.ZodParsedType.set:typeof Date<"u"&&r instanceof Date?n.ZodParsedType.date:n.ZodParsedType.object;default:return n.ZodParsedType.unknown}};n.getParsedType=t})(lr);var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.ZodError=Ie.quotelessJson=Ie.ZodIssueCode=void 0;const bo=lr;Ie.ZodIssueCode=bo.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);const Wp=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");Ie.quotelessJson=Wp;class ls extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,u=0;for(;u<a.path.length;){const c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return s(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,bo.util.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Ie.ZodError=ls;ls.create=n=>new ls(n);Object.defineProperty(Kr,"__esModule",{value:!0});const Ke=lr,oe=Ie,Yp=(n,e)=>{let t;switch(n.code){case oe.ZodIssueCode.invalid_type:n.received===Ke.ZodParsedType.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case oe.ZodIssueCode.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,Ke.util.jsonStringifyReplacer)}`;break;case oe.ZodIssueCode.unrecognized_keys:t=`Unrecognized key(s) in object: ${Ke.util.joinValues(n.keys,", ")}`;break;case oe.ZodIssueCode.invalid_union:t="Invalid input";break;case oe.ZodIssueCode.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Ke.util.joinValues(n.options)}`;break;case oe.ZodIssueCode.invalid_enum_value:t=`Invalid enum value. Expected ${Ke.util.joinValues(n.options)}, received '${n.received}'`;break;case oe.ZodIssueCode.invalid_arguments:t="Invalid function arguments";break;case oe.ZodIssueCode.invalid_return_type:t="Invalid function return type";break;case oe.ZodIssueCode.invalid_date:t="Invalid date";break;case oe.ZodIssueCode.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:Ke.util.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case oe.ZodIssueCode.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case oe.ZodIssueCode.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case oe.ZodIssueCode.custom:t="Invalid input";break;case oe.ZodIssueCode.invalid_intersection_types:t="Intersection results could not be merged";break;case oe.ZodIssueCode.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case oe.ZodIssueCode.not_finite:t="Number must be finite";break;default:t=e.defaultError,Ke.util.assertNever(n)}return{message:t}};Kr.default=Yp;var Qp=z&&z.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Se,"__esModule",{value:!0});Se.getErrorMap=Se.setErrorMap=Se.defaultErrorMap=void 0;const _o=Qp(Kr);Se.defaultErrorMap=_o.default;let wo=_o.default;function Xp(n){wo=n}Se.setErrorMap=Xp;function em(){return wo}Se.getErrorMap=em;var Us={};(function(n){var e=z&&z.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(n,"__esModule",{value:!0}),n.isAsync=n.isValid=n.isDirty=n.isAborted=n.OK=n.DIRTY=n.INVALID=n.ParseStatus=n.addIssueToContext=n.EMPTY_PATH=n.makeIssue=void 0;const t=Se,r=e(Kr),s=g=>{const{data:b,path:w,errorMaps:O,issueData:C}=g,k=[...w,...C.path||[]],j={...C,path:k};let S="";const U=O.filter(J=>!!J).slice().reverse();for(const J of U)S=J(j,{data:b,defaultError:S}).message;return{...C,path:k,message:C.message||S}};n.makeIssue=s,n.EMPTY_PATH=[];function i(g,b){const w=(0,n.makeIssue)({issueData:b,data:g.data,path:g.path,errorMaps:[g.common.contextualErrorMap,g.schemaErrorMap,(0,t.getErrorMap)(),r.default].filter(O=>!!O)});g.common.issues.push(w)}n.addIssueToContext=i;class a{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(b,w){const O=[];for(const C of w){if(C.status==="aborted")return n.INVALID;C.status==="dirty"&&b.dirty(),O.push(C.value)}return{status:b.value,value:O}}static async mergeObjectAsync(b,w){const O=[];for(const C of w)O.push({key:await C.key,value:await C.value});return a.mergeObjectSync(b,O)}static mergeObjectSync(b,w){const O={};for(const C of w){const{key:k,value:j}=C;if(k.status==="aborted"||j.status==="aborted")return n.INVALID;k.status==="dirty"&&b.dirty(),j.status==="dirty"&&b.dirty(),(typeof j.value<"u"||C.alwaysSet)&&(O[k.value]=j.value)}return{status:b.value,value:O}}}n.ParseStatus=a,n.INVALID=Object.freeze({status:"aborted"});const o=g=>({status:"dirty",value:g});n.DIRTY=o;const u=g=>({status:"valid",value:g});n.OK=u;const c=g=>g.status==="aborted";n.isAborted=c;const l=g=>g.status==="dirty";n.isDirty=l;const h=g=>g.status==="valid";n.isValid=h;const p=g=>typeof Promise<"u"&&g instanceof Promise;n.isAsync=p})(Us);var Oo={};Object.defineProperty(Oo,"__esModule",{value:!0});var To={},Po={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.errorUtil=void 0,function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message}(n.errorUtil||(n.errorUtil={}))})(Po);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.discriminatedUnion=n.date=n.boolean=n.bigint=n.array=n.any=n.coerce=n.ZodFirstPartyTypeKind=n.late=n.ZodSchema=n.Schema=n.custom=n.ZodPipeline=n.ZodBranded=n.BRAND=n.ZodNaN=n.ZodCatch=n.ZodDefault=n.ZodNullable=n.ZodOptional=n.ZodTransformer=n.ZodEffects=n.ZodPromise=n.ZodNativeEnum=n.ZodEnum=n.ZodLiteral=n.ZodLazy=n.ZodFunction=n.ZodSet=n.ZodMap=n.ZodRecord=n.ZodTuple=n.ZodIntersection=n.ZodDiscriminatedUnion=n.ZodUnion=n.ZodObject=n.ZodArray=n.ZodVoid=n.ZodNever=n.ZodUnknown=n.ZodAny=n.ZodNull=n.ZodUndefined=n.ZodSymbol=n.ZodDate=n.ZodBoolean=n.ZodBigInt=n.ZodNumber=n.ZodString=n.ZodType=void 0,n.NEVER=n.void=n.unknown=n.union=n.undefined=n.tuple=n.transformer=n.symbol=n.string=n.strictObject=n.set=n.record=n.promise=n.preprocess=n.pipeline=n.ostring=n.optional=n.onumber=n.oboolean=n.object=n.number=n.nullable=n.null=n.never=n.nativeEnum=n.nan=n.map=n.literal=n.lazy=n.intersection=n.instanceof=n.function=n.enum=n.effect=void 0;const e=Se,t=Po,r=Us,s=lr,i=Ie;class a{constructor(d,f,m,_){this._cachedPath=[],this.parent=d,this.data=f,this._path=m,this._key=_}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const o=(y,d)=>{if((0,r.isValid)(d))return{success:!0,data:d.value};if(!y.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const f=new i.ZodError(y.common.issues);return this._error=f,this._error}}};function u(y){if(!y)return{};const{errorMap:d,invalid_type_error:f,required_error:m,description:_}=y;if(d&&(f||m))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return d?{errorMap:d,description:_}:{errorMap:(I,P)=>I.code!=="invalid_type"?{message:P.defaultError}:typeof P.data>"u"?{message:m??P.defaultError}:{message:f??P.defaultError},description:_}}class c{constructor(d){this.spa=this.safeParseAsync,this._def=d,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(d){return(0,s.getParsedType)(d.data)}_getOrReturnCtx(d,f){return f||{common:d.parent.common,data:d.data,parsedType:(0,s.getParsedType)(d.data),schemaErrorMap:this._def.errorMap,path:d.path,parent:d.parent}}_processInputParams(d){return{status:new r.ParseStatus,ctx:{common:d.parent.common,data:d.data,parsedType:(0,s.getParsedType)(d.data),schemaErrorMap:this._def.errorMap,path:d.path,parent:d.parent}}}_parseSync(d){const f=this._parse(d);if((0,r.isAsync)(f))throw new Error("Synchronous parse encountered promise.");return f}_parseAsync(d){const f=this._parse(d);return Promise.resolve(f)}parse(d,f){const m=this.safeParse(d,f);if(m.success)return m.data;throw m.error}safeParse(d,f){var m;const _={common:{issues:[],async:(m=f==null?void 0:f.async)!==null&&m!==void 0?m:!1,contextualErrorMap:f==null?void 0:f.errorMap},path:(f==null?void 0:f.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:d,parsedType:(0,s.getParsedType)(d)},v=this._parseSync({data:d,path:_.path,parent:_});return o(_,v)}async parseAsync(d,f){const m=await this.safeParseAsync(d,f);if(m.success)return m.data;throw m.error}async safeParseAsync(d,f){const m={common:{issues:[],contextualErrorMap:f==null?void 0:f.errorMap,async:!0},path:(f==null?void 0:f.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:d,parsedType:(0,s.getParsedType)(d)},_=this._parse({data:d,path:m.path,parent:m}),v=await((0,r.isAsync)(_)?_:Promise.resolve(_));return o(m,v)}refine(d,f){const m=_=>typeof f=="string"||typeof f>"u"?{message:f}:typeof f=="function"?f(_):f;return this._refinement((_,v)=>{const I=d(_),P=()=>v.addIssue({code:i.ZodIssueCode.custom,...m(_)});return typeof Promise<"u"&&I instanceof Promise?I.then(x=>x?!0:(P(),!1)):I?!0:(P(),!1)})}refinement(d,f){return this._refinement((m,_)=>d(m)?!0:(_.addIssue(typeof f=="function"?f(m,_):f),!1))}_refinement(d){return new be({schema:this,typeName:L.ZodEffects,effect:{type:"refinement",refinement:d}})}superRefine(d){return this._refinement(d)}optional(){return je.create(this,this._def)}nullable(){return ze.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Z.create(this,this._def)}promise(){return at.create(this,this._def)}or(d){return F.create([this,d],this._def)}and(d){return Te.create(this,d,this._def)}transform(d){return new be({...u(this._def),schema:this,typeName:L.ZodEffects,effect:{type:"transform",transform:d}})}default(d){const f=typeof d=="function"?d:()=>d;return new kt({...u(this._def),innerType:this,defaultValue:f,typeName:L.ZodDefault})}brand(){return new Bs({typeName:L.ZodBranded,type:this,...u(this._def)})}catch(d){const f=typeof d=="function"?d:()=>d;return new hr({...u(this._def),innerType:this,catchValue:f,typeName:L.ZodCatch})}describe(d){const f=this.constructor;return new f({...this._def,description:d})}pipe(d){return Rt.create(this,d)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}n.ZodType=c,n.Schema=c,n.ZodSchema=c;const l=/^c[^\s-]{8,}$/i,h=/^[a-z][a-z0-9]*$/,p=/[0-9A-HJKMNP-TV-Z]{26}/,g=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\])|(\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\.[A-Za-z]{2,})+))$/,w=/^(\p{Extended_Pictographic}|\p{Emoji_Component})+$/u,O=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,C=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,k=y=>y.precision?y.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${y.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${y.precision}}Z$`):y.precision===0?y.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):y.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function j(y,d){return!!((d==="v4"||!d)&&O.test(y)||(d==="v6"||!d)&&C.test(y))}class S extends c{constructor(){super(...arguments),this._regex=(d,f,m)=>this.refinement(_=>d.test(_),{validation:f,code:i.ZodIssueCode.invalid_string,...t.errorUtil.errToObj(m)}),this.nonempty=d=>this.min(1,t.errorUtil.errToObj(d)),this.trim=()=>new S({...this._def,checks:[...this._def.checks,{kind:"trim"}]}),this.toLowerCase=()=>new S({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]}),this.toUpperCase=()=>new S({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}_parse(d){if(this._def.coerce&&(d.data=String(d.data)),this._getType(d)!==s.ZodParsedType.string){const v=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(v,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.string,received:v.parsedType}),r.INVALID}const m=new r.ParseStatus;let _;for(const v of this._def.checks)if(v.kind==="min")d.data.length<v.value&&(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{code:i.ZodIssueCode.too_small,minimum:v.value,type:"string",inclusive:!0,exact:!1,message:v.message}),m.dirty());else if(v.kind==="max")d.data.length>v.value&&(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{code:i.ZodIssueCode.too_big,maximum:v.value,type:"string",inclusive:!0,exact:!1,message:v.message}),m.dirty());else if(v.kind==="length"){const I=d.data.length>v.value,P=d.data.length<v.value;(I||P)&&(_=this._getOrReturnCtx(d,_),I?(0,r.addIssueToContext)(_,{code:i.ZodIssueCode.too_big,maximum:v.value,type:"string",inclusive:!0,exact:!0,message:v.message}):P&&(0,r.addIssueToContext)(_,{code:i.ZodIssueCode.too_small,minimum:v.value,type:"string",inclusive:!0,exact:!0,message:v.message}),m.dirty())}else if(v.kind==="email")b.test(d.data)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{validation:"email",code:i.ZodIssueCode.invalid_string,message:v.message}),m.dirty());else if(v.kind==="emoji")w.test(d.data)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{validation:"emoji",code:i.ZodIssueCode.invalid_string,message:v.message}),m.dirty());else if(v.kind==="uuid")g.test(d.data)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{validation:"uuid",code:i.ZodIssueCode.invalid_string,message:v.message}),m.dirty());else if(v.kind==="cuid")l.test(d.data)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{validation:"cuid",code:i.ZodIssueCode.invalid_string,message:v.message}),m.dirty());else if(v.kind==="cuid2")h.test(d.data)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{validation:"cuid2",code:i.ZodIssueCode.invalid_string,message:v.message}),m.dirty());else if(v.kind==="ulid")p.test(d.data)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{validation:"ulid",code:i.ZodIssueCode.invalid_string,message:v.message}),m.dirty());else if(v.kind==="url")try{new URL(d.data)}catch{_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{validation:"url",code:i.ZodIssueCode.invalid_string,message:v.message}),m.dirty()}else v.kind==="regex"?(v.regex.lastIndex=0,v.regex.test(d.data)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{validation:"regex",code:i.ZodIssueCode.invalid_string,message:v.message}),m.dirty())):v.kind==="trim"?d.data=d.data.trim():v.kind==="includes"?d.data.includes(v.value,v.position)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{code:i.ZodIssueCode.invalid_string,validation:{includes:v.value,position:v.position},message:v.message}),m.dirty()):v.kind==="toLowerCase"?d.data=d.data.toLowerCase():v.kind==="toUpperCase"?d.data=d.data.toUpperCase():v.kind==="startsWith"?d.data.startsWith(v.value)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{code:i.ZodIssueCode.invalid_string,validation:{startsWith:v.value},message:v.message}),m.dirty()):v.kind==="endsWith"?d.data.endsWith(v.value)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{code:i.ZodIssueCode.invalid_string,validation:{endsWith:v.value},message:v.message}),m.dirty()):v.kind==="datetime"?k(v).test(d.data)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{code:i.ZodIssueCode.invalid_string,validation:"datetime",message:v.message}),m.dirty()):v.kind==="ip"?j(d.data,v.version)||(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{validation:"ip",code:i.ZodIssueCode.invalid_string,message:v.message}),m.dirty()):s.util.assertNever(v);return{status:m.value,value:d.data}}_addCheck(d){return new S({...this._def,checks:[...this._def.checks,d]})}email(d){return this._addCheck({kind:"email",...t.errorUtil.errToObj(d)})}url(d){return this._addCheck({kind:"url",...t.errorUtil.errToObj(d)})}emoji(d){return this._addCheck({kind:"emoji",...t.errorUtil.errToObj(d)})}uuid(d){return this._addCheck({kind:"uuid",...t.errorUtil.errToObj(d)})}cuid(d){return this._addCheck({kind:"cuid",...t.errorUtil.errToObj(d)})}cuid2(d){return this._addCheck({kind:"cuid2",...t.errorUtil.errToObj(d)})}ulid(d){return this._addCheck({kind:"ulid",...t.errorUtil.errToObj(d)})}ip(d){return this._addCheck({kind:"ip",...t.errorUtil.errToObj(d)})}datetime(d){var f;return typeof d=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:d}):this._addCheck({kind:"datetime",precision:typeof(d==null?void 0:d.precision)>"u"?null:d==null?void 0:d.precision,offset:(f=d==null?void 0:d.offset)!==null&&f!==void 0?f:!1,...t.errorUtil.errToObj(d==null?void 0:d.message)})}regex(d,f){return this._addCheck({kind:"regex",regex:d,...t.errorUtil.errToObj(f)})}includes(d,f){return this._addCheck({kind:"includes",value:d,position:f==null?void 0:f.position,...t.errorUtil.errToObj(f==null?void 0:f.message)})}startsWith(d,f){return this._addCheck({kind:"startsWith",value:d,...t.errorUtil.errToObj(f)})}endsWith(d,f){return this._addCheck({kind:"endsWith",value:d,...t.errorUtil.errToObj(f)})}min(d,f){return this._addCheck({kind:"min",value:d,...t.errorUtil.errToObj(f)})}max(d,f){return this._addCheck({kind:"max",value:d,...t.errorUtil.errToObj(f)})}length(d,f){return this._addCheck({kind:"length",value:d,...t.errorUtil.errToObj(f)})}get isDatetime(){return!!this._def.checks.find(d=>d.kind==="datetime")}get isEmail(){return!!this._def.checks.find(d=>d.kind==="email")}get isURL(){return!!this._def.checks.find(d=>d.kind==="url")}get isEmoji(){return!!this._def.checks.find(d=>d.kind==="emoji")}get isUUID(){return!!this._def.checks.find(d=>d.kind==="uuid")}get isCUID(){return!!this._def.checks.find(d=>d.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(d=>d.kind==="cuid2")}get isULID(){return!!this._def.checks.find(d=>d.kind==="ulid")}get isIP(){return!!this._def.checks.find(d=>d.kind==="ip")}get minLength(){let d=null;for(const f of this._def.checks)f.kind==="min"&&(d===null||f.value>d)&&(d=f.value);return d}get maxLength(){let d=null;for(const f of this._def.checks)f.kind==="max"&&(d===null||f.value<d)&&(d=f.value);return d}}n.ZodString=S,S.create=y=>{var d;return new S({checks:[],typeName:L.ZodString,coerce:(d=y==null?void 0:y.coerce)!==null&&d!==void 0?d:!1,...u(y)})};function U(y,d){const f=(y.toString().split(".")[1]||"").length,m=(d.toString().split(".")[1]||"").length,_=f>m?f:m,v=parseInt(y.toFixed(_).replace(".","")),I=parseInt(d.toFixed(_).replace(".",""));return v%I/Math.pow(10,_)}class J extends c{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(d){if(this._def.coerce&&(d.data=Number(d.data)),this._getType(d)!==s.ZodParsedType.number){const v=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(v,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.number,received:v.parsedType}),r.INVALID}let m;const _=new r.ParseStatus;for(const v of this._def.checks)v.kind==="int"?s.util.isInteger(d.data)||(m=this._getOrReturnCtx(d,m),(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:v.message}),_.dirty()):v.kind==="min"?(v.inclusive?d.data<v.value:d.data<=v.value)&&(m=this._getOrReturnCtx(d,m),(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.too_small,minimum:v.value,type:"number",inclusive:v.inclusive,exact:!1,message:v.message}),_.dirty()):v.kind==="max"?(v.inclusive?d.data>v.value:d.data>=v.value)&&(m=this._getOrReturnCtx(d,m),(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.too_big,maximum:v.value,type:"number",inclusive:v.inclusive,exact:!1,message:v.message}),_.dirty()):v.kind==="multipleOf"?U(d.data,v.value)!==0&&(m=this._getOrReturnCtx(d,m),(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.not_multiple_of,multipleOf:v.value,message:v.message}),_.dirty()):v.kind==="finite"?Number.isFinite(d.data)||(m=this._getOrReturnCtx(d,m),(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.not_finite,message:v.message}),_.dirty()):s.util.assertNever(v);return{status:_.value,value:d.data}}gte(d,f){return this.setLimit("min",d,!0,t.errorUtil.toString(f))}gt(d,f){return this.setLimit("min",d,!1,t.errorUtil.toString(f))}lte(d,f){return this.setLimit("max",d,!0,t.errorUtil.toString(f))}lt(d,f){return this.setLimit("max",d,!1,t.errorUtil.toString(f))}setLimit(d,f,m,_){return new J({...this._def,checks:[...this._def.checks,{kind:d,value:f,inclusive:m,message:t.errorUtil.toString(_)}]})}_addCheck(d){return new J({...this._def,checks:[...this._def.checks,d]})}int(d){return this._addCheck({kind:"int",message:t.errorUtil.toString(d)})}positive(d){return this._addCheck({kind:"min",value:0,inclusive:!1,message:t.errorUtil.toString(d)})}negative(d){return this._addCheck({kind:"max",value:0,inclusive:!1,message:t.errorUtil.toString(d)})}nonpositive(d){return this._addCheck({kind:"max",value:0,inclusive:!0,message:t.errorUtil.toString(d)})}nonnegative(d){return this._addCheck({kind:"min",value:0,inclusive:!0,message:t.errorUtil.toString(d)})}multipleOf(d,f){return this._addCheck({kind:"multipleOf",value:d,message:t.errorUtil.toString(f)})}finite(d){return this._addCheck({kind:"finite",message:t.errorUtil.toString(d)})}safe(d){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:t.errorUtil.toString(d)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:t.errorUtil.toString(d)})}get minValue(){let d=null;for(const f of this._def.checks)f.kind==="min"&&(d===null||f.value>d)&&(d=f.value);return d}get maxValue(){let d=null;for(const f of this._def.checks)f.kind==="max"&&(d===null||f.value<d)&&(d=f.value);return d}get isInt(){return!!this._def.checks.find(d=>d.kind==="int"||d.kind==="multipleOf"&&s.util.isInteger(d.value))}get isFinite(){let d=null,f=null;for(const m of this._def.checks){if(m.kind==="finite"||m.kind==="int"||m.kind==="multipleOf")return!0;m.kind==="min"?(f===null||m.value>f)&&(f=m.value):m.kind==="max"&&(d===null||m.value<d)&&(d=m.value)}return Number.isFinite(f)&&Number.isFinite(d)}}n.ZodNumber=J,J.create=y=>new J({checks:[],typeName:L.ZodNumber,coerce:(y==null?void 0:y.coerce)||!1,...u(y)});class ee extends c{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(d){if(this._def.coerce&&(d.data=BigInt(d.data)),this._getType(d)!==s.ZodParsedType.bigint){const v=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(v,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.bigint,received:v.parsedType}),r.INVALID}let m;const _=new r.ParseStatus;for(const v of this._def.checks)v.kind==="min"?(v.inclusive?d.data<v.value:d.data<=v.value)&&(m=this._getOrReturnCtx(d,m),(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.too_small,type:"bigint",minimum:v.value,inclusive:v.inclusive,message:v.message}),_.dirty()):v.kind==="max"?(v.inclusive?d.data>v.value:d.data>=v.value)&&(m=this._getOrReturnCtx(d,m),(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.too_big,type:"bigint",maximum:v.value,inclusive:v.inclusive,message:v.message}),_.dirty()):v.kind==="multipleOf"?d.data%v.value!==BigInt(0)&&(m=this._getOrReturnCtx(d,m),(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.not_multiple_of,multipleOf:v.value,message:v.message}),_.dirty()):s.util.assertNever(v);return{status:_.value,value:d.data}}gte(d,f){return this.setLimit("min",d,!0,t.errorUtil.toString(f))}gt(d,f){return this.setLimit("min",d,!1,t.errorUtil.toString(f))}lte(d,f){return this.setLimit("max",d,!0,t.errorUtil.toString(f))}lt(d,f){return this.setLimit("max",d,!1,t.errorUtil.toString(f))}setLimit(d,f,m,_){return new ee({...this._def,checks:[...this._def.checks,{kind:d,value:f,inclusive:m,message:t.errorUtil.toString(_)}]})}_addCheck(d){return new ee({...this._def,checks:[...this._def.checks,d]})}positive(d){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:t.errorUtil.toString(d)})}negative(d){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:t.errorUtil.toString(d)})}nonpositive(d){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:t.errorUtil.toString(d)})}nonnegative(d){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:t.errorUtil.toString(d)})}multipleOf(d,f){return this._addCheck({kind:"multipleOf",value:d,message:t.errorUtil.toString(f)})}get minValue(){let d=null;for(const f of this._def.checks)f.kind==="min"&&(d===null||f.value>d)&&(d=f.value);return d}get maxValue(){let d=null;for(const f of this._def.checks)f.kind==="max"&&(d===null||f.value<d)&&(d=f.value);return d}}n.ZodBigInt=ee,ee.create=y=>{var d;return new ee({checks:[],typeName:L.ZodBigInt,coerce:(d=y==null?void 0:y.coerce)!==null&&d!==void 0?d:!1,...u(y)})};class Y extends c{_parse(d){if(this._def.coerce&&(d.data=!!d.data),this._getType(d)!==s.ZodParsedType.boolean){const m=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.boolean,received:m.parsedType}),r.INVALID}return(0,r.OK)(d.data)}}n.ZodBoolean=Y,Y.create=y=>new Y({typeName:L.ZodBoolean,coerce:(y==null?void 0:y.coerce)||!1,...u(y)});class re extends c{_parse(d){if(this._def.coerce&&(d.data=new Date(d.data)),this._getType(d)!==s.ZodParsedType.date){const v=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(v,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.date,received:v.parsedType}),r.INVALID}if(isNaN(d.data.getTime())){const v=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(v,{code:i.ZodIssueCode.invalid_date}),r.INVALID}const m=new r.ParseStatus;let _;for(const v of this._def.checks)v.kind==="min"?d.data.getTime()<v.value&&(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{code:i.ZodIssueCode.too_small,message:v.message,inclusive:!0,exact:!1,minimum:v.value,type:"date"}),m.dirty()):v.kind==="max"?d.data.getTime()>v.value&&(_=this._getOrReturnCtx(d,_),(0,r.addIssueToContext)(_,{code:i.ZodIssueCode.too_big,message:v.message,inclusive:!0,exact:!1,maximum:v.value,type:"date"}),m.dirty()):s.util.assertNever(v);return{status:m.value,value:new Date(d.data.getTime())}}_addCheck(d){return new re({...this._def,checks:[...this._def.checks,d]})}min(d,f){return this._addCheck({kind:"min",value:d.getTime(),message:t.errorUtil.toString(f)})}max(d,f){return this._addCheck({kind:"max",value:d.getTime(),message:t.errorUtil.toString(f)})}get minDate(){let d=null;for(const f of this._def.checks)f.kind==="min"&&(d===null||f.value>d)&&(d=f.value);return d!=null?new Date(d):null}get maxDate(){let d=null;for(const f of this._def.checks)f.kind==="max"&&(d===null||f.value<d)&&(d=f.value);return d!=null?new Date(d):null}}n.ZodDate=re,re.create=y=>new re({checks:[],coerce:(y==null?void 0:y.coerce)||!1,typeName:L.ZodDate,...u(y)});class G extends c{_parse(d){if(this._getType(d)!==s.ZodParsedType.symbol){const m=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.symbol,received:m.parsedType}),r.INVALID}return(0,r.OK)(d.data)}}n.ZodSymbol=G,G.create=y=>new G({typeName:L.ZodSymbol,...u(y)});class q extends c{_parse(d){if(this._getType(d)!==s.ZodParsedType.undefined){const m=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.undefined,received:m.parsedType}),r.INVALID}return(0,r.OK)(d.data)}}n.ZodUndefined=q,q.create=y=>new q({typeName:L.ZodUndefined,...u(y)});class Q extends c{_parse(d){if(this._getType(d)!==s.ZodParsedType.null){const m=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.null,received:m.parsedType}),r.INVALID}return(0,r.OK)(d.data)}}n.ZodNull=Q,Q.create=y=>new Q({typeName:L.ZodNull,...u(y)});class X extends c{constructor(){super(...arguments),this._any=!0}_parse(d){return(0,r.OK)(d.data)}}n.ZodAny=X,X.create=y=>new X({typeName:L.ZodAny,...u(y)});class T extends c{constructor(){super(...arguments),this._unknown=!0}_parse(d){return(0,r.OK)(d.data)}}n.ZodUnknown=T,T.create=y=>new T({typeName:L.ZodUnknown,...u(y)});class E extends c{_parse(d){const f=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(f,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.never,received:f.parsedType}),r.INVALID}}n.ZodNever=E,E.create=y=>new E({typeName:L.ZodNever,...u(y)});class R extends c{_parse(d){if(this._getType(d)!==s.ZodParsedType.undefined){const m=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.void,received:m.parsedType}),r.INVALID}return(0,r.OK)(d.data)}}n.ZodVoid=R,R.create=y=>new R({typeName:L.ZodVoid,...u(y)});class Z extends c{_parse(d){const{ctx:f,status:m}=this._processInputParams(d),_=this._def;if(f.parsedType!==s.ZodParsedType.array)return(0,r.addIssueToContext)(f,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.array,received:f.parsedType}),r.INVALID;if(_.exactLength!==null){const I=f.data.length>_.exactLength.value,P=f.data.length<_.exactLength.value;(I||P)&&((0,r.addIssueToContext)(f,{code:I?i.ZodIssueCode.too_big:i.ZodIssueCode.too_small,minimum:P?_.exactLength.value:void 0,maximum:I?_.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:_.exactLength.message}),m.dirty())}if(_.minLength!==null&&f.data.length<_.minLength.value&&((0,r.addIssueToContext)(f,{code:i.ZodIssueCode.too_small,minimum:_.minLength.value,type:"array",inclusive:!0,exact:!1,message:_.minLength.message}),m.dirty()),_.maxLength!==null&&f.data.length>_.maxLength.value&&((0,r.addIssueToContext)(f,{code:i.ZodIssueCode.too_big,maximum:_.maxLength.value,type:"array",inclusive:!0,exact:!1,message:_.maxLength.message}),m.dirty()),f.common.async)return Promise.all([...f.data].map((I,P)=>_.type._parseAsync(new a(f,I,f.path,P)))).then(I=>r.ParseStatus.mergeArray(m,I));const v=[...f.data].map((I,P)=>_.type._parseSync(new a(f,I,f.path,P)));return r.ParseStatus.mergeArray(m,v)}get element(){return this._def.type}min(d,f){return new Z({...this._def,minLength:{value:d,message:t.errorUtil.toString(f)}})}max(d,f){return new Z({...this._def,maxLength:{value:d,message:t.errorUtil.toString(f)}})}length(d,f){return new Z({...this._def,exactLength:{value:d,message:t.errorUtil.toString(f)}})}nonempty(d){return this.min(1,d)}}n.ZodArray=Z,Z.create=(y,d)=>new Z({type:y,minLength:null,maxLength:null,exactLength:null,typeName:L.ZodArray,...u(d)});function H(y){if(y instanceof A){const d={};for(const f in y.shape){const m=y.shape[f];d[f]=je.create(H(m))}return new A({...y._def,shape:()=>d})}else return y instanceof Z?new Z({...y._def,type:H(y.element)}):y instanceof je?je.create(H(y.unwrap())):y instanceof ze?ze.create(H(y.unwrap())):y instanceof he?he.create(y.items.map(d=>H(d))):y}class A extends c{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const d=this._def.shape(),f=s.util.objectKeys(d);return this._cached={shape:d,keys:f}}_parse(d){if(this._getType(d)!==s.ZodParsedType.object){const D=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(D,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.object,received:D.parsedType}),r.INVALID}const{status:m,ctx:_}=this._processInputParams(d),{shape:v,keys:I}=this._getCached(),P=[];if(!(this._def.catchall instanceof E&&this._def.unknownKeys==="strip"))for(const D in _.data)I.includes(D)||P.push(D);const x=[];for(const D of I){const M=v[D],ot=_.data[D];x.push({key:{status:"valid",value:D},value:M._parse(new a(_,ot,_.path,D)),alwaysSet:D in _.data})}if(this._def.catchall instanceof E){const D=this._def.unknownKeys;if(D==="passthrough")for(const M of P)x.push({key:{status:"valid",value:M},value:{status:"valid",value:_.data[M]}});else if(D==="strict")P.length>0&&((0,r.addIssueToContext)(_,{code:i.ZodIssueCode.unrecognized_keys,keys:P}),m.dirty());else if(D!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const D=this._def.catchall;for(const M of P){const ot=_.data[M];x.push({key:{status:"valid",value:M},value:D._parse(new a(_,ot,_.path,M)),alwaysSet:M in _.data})}}return _.common.async?Promise.resolve().then(async()=>{const D=[];for(const M of x){const ot=await M.key;D.push({key:ot,value:await M.value,alwaysSet:M.alwaysSet})}return D}).then(D=>r.ParseStatus.mergeObjectSync(m,D)):r.ParseStatus.mergeObjectSync(m,x)}get shape(){return this._def.shape()}strict(d){return t.errorUtil.errToObj,new A({...this._def,unknownKeys:"strict",...d!==void 0?{errorMap:(f,m)=>{var _,v,I,P;const x=(I=(v=(_=this._def).errorMap)===null||v===void 0?void 0:v.call(_,f,m).message)!==null&&I!==void 0?I:m.defaultError;return f.code==="unrecognized_keys"?{message:(P=t.errorUtil.errToObj(d).message)!==null&&P!==void 0?P:x}:{message:x}}}:{}})}strip(){return new A({...this._def,unknownKeys:"strip"})}passthrough(){return new A({...this._def,unknownKeys:"passthrough"})}extend(d){return new A({...this._def,shape:()=>({...this._def.shape(),...d})})}merge(d){return new A({unknownKeys:d._def.unknownKeys,catchall:d._def.catchall,shape:()=>({...this._def.shape(),...d._def.shape()}),typeName:L.ZodObject})}setKey(d,f){return this.augment({[d]:f})}catchall(d){return new A({...this._def,catchall:d})}pick(d){const f={};return s.util.objectKeys(d).forEach(m=>{d[m]&&this.shape[m]&&(f[m]=this.shape[m])}),new A({...this._def,shape:()=>f})}omit(d){const f={};return s.util.objectKeys(this.shape).forEach(m=>{d[m]||(f[m]=this.shape[m])}),new A({...this._def,shape:()=>f})}deepPartial(){return H(this)}partial(d){const f={};return s.util.objectKeys(this.shape).forEach(m=>{const _=this.shape[m];d&&!d[m]?f[m]=_:f[m]=_.optional()}),new A({...this._def,shape:()=>f})}required(d){const f={};return s.util.objectKeys(this.shape).forEach(m=>{if(d&&!d[m])f[m]=this.shape[m];else{let v=this.shape[m];for(;v instanceof je;)v=v._def.innerType;f[m]=v}}),new A({...this._def,shape:()=>f})}keyof(){return Vs(s.util.objectKeys(this.shape))}}n.ZodObject=A,A.create=(y,d)=>new A({shape:()=>y,unknownKeys:"strip",catchall:E.create(),typeName:L.ZodObject,...u(d)}),A.strictCreate=(y,d)=>new A({shape:()=>y,unknownKeys:"strict",catchall:E.create(),typeName:L.ZodObject,...u(d)}),A.lazycreate=(y,d)=>new A({shape:y,unknownKeys:"strip",catchall:E.create(),typeName:L.ZodObject,...u(d)});class F extends c{_parse(d){const{ctx:f}=this._processInputParams(d),m=this._def.options;function _(v){for(const P of v)if(P.result.status==="valid")return P.result;for(const P of v)if(P.result.status==="dirty")return f.common.issues.push(...P.ctx.common.issues),P.result;const I=v.map(P=>new i.ZodError(P.ctx.common.issues));return(0,r.addIssueToContext)(f,{code:i.ZodIssueCode.invalid_union,unionErrors:I}),r.INVALID}if(f.common.async)return Promise.all(m.map(async v=>{const I={...f,common:{...f.common,issues:[]},parent:null};return{result:await v._parseAsync({data:f.data,path:f.path,parent:I}),ctx:I}})).then(_);{let v;const I=[];for(const x of m){const D={...f,common:{...f.common,issues:[]},parent:null},M=x._parseSync({data:f.data,path:f.path,parent:D});if(M.status==="valid")return M;M.status==="dirty"&&!v&&(v={result:M,ctx:D}),D.common.issues.length&&I.push(D.common.issues)}if(v)return f.common.issues.push(...v.ctx.common.issues),v.result;const P=I.map(x=>new i.ZodError(x));return(0,r.addIssueToContext)(f,{code:i.ZodIssueCode.invalid_union,unionErrors:P}),r.INVALID}}get options(){return this._def.options}}n.ZodUnion=F,F.create=(y,d)=>new F({options:y,typeName:L.ZodUnion,...u(d)});const $=y=>y instanceof It?$(y.schema):y instanceof be?$(y.innerType()):y instanceof Ct?[y.value]:y instanceof xe?y.options:y instanceof jt?Object.keys(y.enum):y instanceof kt?$(y._def.innerType):y instanceof q?[void 0]:y instanceof Q?[null]:null;class ae extends c{_parse(d){const{ctx:f}=this._processInputParams(d);if(f.parsedType!==s.ZodParsedType.object)return(0,r.addIssueToContext)(f,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.object,received:f.parsedType}),r.INVALID;const m=this.discriminator,_=f.data[m],v=this.optionsMap.get(_);return v?f.common.async?v._parseAsync({data:f.data,path:f.path,parent:f}):v._parseSync({data:f.data,path:f.path,parent:f}):((0,r.addIssueToContext)(f,{code:i.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[m]}),r.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(d,f,m){const _=new Map;for(const v of f){const I=$(v.shape[d]);if(!I)throw new Error(`A discriminator value for key \`${d}\` could not be extracted from all schema options`);for(const P of I){if(_.has(P))throw new Error(`Discriminator property ${String(d)} has duplicate value ${String(P)}`);_.set(P,v)}}return new ae({typeName:L.ZodDiscriminatedUnion,discriminator:d,options:f,optionsMap:_,...u(m)})}}n.ZodDiscriminatedUnion=ae;function st(y,d){const f=(0,s.getParsedType)(y),m=(0,s.getParsedType)(d);if(y===d)return{valid:!0,data:y};if(f===s.ZodParsedType.object&&m===s.ZodParsedType.object){const _=s.util.objectKeys(d),v=s.util.objectKeys(y).filter(P=>_.indexOf(P)!==-1),I={...y,...d};for(const P of v){const x=st(y[P],d[P]);if(!x.valid)return{valid:!1};I[P]=x.data}return{valid:!0,data:I}}else if(f===s.ZodParsedType.array&&m===s.ZodParsedType.array){if(y.length!==d.length)return{valid:!1};const _=[];for(let v=0;v<y.length;v++){const I=y[v],P=d[v],x=st(I,P);if(!x.valid)return{valid:!1};_.push(x.data)}return{valid:!0,data:_}}else return f===s.ZodParsedType.date&&m===s.ZodParsedType.date&&+y==+d?{valid:!0,data:y}:{valid:!1}}class Te extends c{_parse(d){const{status:f,ctx:m}=this._processInputParams(d),_=(v,I)=>{if((0,r.isAborted)(v)||(0,r.isAborted)(I))return r.INVALID;const P=st(v.value,I.value);return P.valid?(((0,r.isDirty)(v)||(0,r.isDirty)(I))&&f.dirty(),{status:f.value,value:P.data}):((0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_intersection_types}),r.INVALID)};return m.common.async?Promise.all([this._def.left._parseAsync({data:m.data,path:m.path,parent:m}),this._def.right._parseAsync({data:m.data,path:m.path,parent:m})]).then(([v,I])=>_(v,I)):_(this._def.left._parseSync({data:m.data,path:m.path,parent:m}),this._def.right._parseSync({data:m.data,path:m.path,parent:m}))}}n.ZodIntersection=Te,Te.create=(y,d,f)=>new Te({left:y,right:d,typeName:L.ZodIntersection,...u(f)});class he extends c{_parse(d){const{status:f,ctx:m}=this._processInputParams(d);if(m.parsedType!==s.ZodParsedType.array)return(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.array,received:m.parsedType}),r.INVALID;if(m.data.length<this._def.items.length)return(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.INVALID;!this._def.rest&&m.data.length>this._def.items.length&&((0,r.addIssueToContext)(m,{code:i.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),f.dirty());const v=[...m.data].map((I,P)=>{const x=this._def.items[P]||this._def.rest;return x?x._parse(new a(m,I,m.path,P)):null}).filter(I=>!!I);return m.common.async?Promise.all(v).then(I=>r.ParseStatus.mergeArray(f,I)):r.ParseStatus.mergeArray(f,v)}get items(){return this._def.items}rest(d){return new he({...this._def,rest:d})}}n.ZodTuple=he,he.create=(y,d)=>{if(!Array.isArray(y))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new he({items:y,typeName:L.ZodTuple,rest:null,...u(d)})};class St extends c{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(d){const{status:f,ctx:m}=this._processInputParams(d);if(m.parsedType!==s.ZodParsedType.object)return(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.object,received:m.parsedType}),r.INVALID;const _=[],v=this._def.keyType,I=this._def.valueType;for(const P in m.data)_.push({key:v._parse(new a(m,P,m.path,P)),value:I._parse(new a(m,m.data[P],m.path,P))});return m.common.async?r.ParseStatus.mergeObjectAsync(f,_):r.ParseStatus.mergeObjectSync(f,_)}get element(){return this._def.valueType}static create(d,f,m){return f instanceof c?new St({keyType:d,valueType:f,typeName:L.ZodRecord,...u(m)}):new St({keyType:S.create(),valueType:d,typeName:L.ZodRecord,...u(f)})}}n.ZodRecord=St;class dr extends c{_parse(d){const{status:f,ctx:m}=this._processInputParams(d);if(m.parsedType!==s.ZodParsedType.map)return(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.map,received:m.parsedType}),r.INVALID;const _=this._def.keyType,v=this._def.valueType,I=[...m.data.entries()].map(([P,x],D)=>({key:_._parse(new a(m,P,m.path,[D,"key"])),value:v._parse(new a(m,x,m.path,[D,"value"]))}));if(m.common.async){const P=new Map;return Promise.resolve().then(async()=>{for(const x of I){const D=await x.key,M=await x.value;if(D.status==="aborted"||M.status==="aborted")return r.INVALID;(D.status==="dirty"||M.status==="dirty")&&f.dirty(),P.set(D.value,M.value)}return{status:f.value,value:P}})}else{const P=new Map;for(const x of I){const D=x.key,M=x.value;if(D.status==="aborted"||M.status==="aborted")return r.INVALID;(D.status==="dirty"||M.status==="dirty")&&f.dirty(),P.set(D.value,M.value)}return{status:f.value,value:P}}}}n.ZodMap=dr,dr.create=(y,d,f)=>new dr({valueType:d,keyType:y,typeName:L.ZodMap,...u(f)});class qe extends c{_parse(d){const{status:f,ctx:m}=this._processInputParams(d);if(m.parsedType!==s.ZodParsedType.set)return(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.set,received:m.parsedType}),r.INVALID;const _=this._def;_.minSize!==null&&m.data.size<_.minSize.value&&((0,r.addIssueToContext)(m,{code:i.ZodIssueCode.too_small,minimum:_.minSize.value,type:"set",inclusive:!0,exact:!1,message:_.minSize.message}),f.dirty()),_.maxSize!==null&&m.data.size>_.maxSize.value&&((0,r.addIssueToContext)(m,{code:i.ZodIssueCode.too_big,maximum:_.maxSize.value,type:"set",inclusive:!0,exact:!1,message:_.maxSize.message}),f.dirty());const v=this._def.valueType;function I(x){const D=new Set;for(const M of x){if(M.status==="aborted")return r.INVALID;M.status==="dirty"&&f.dirty(),D.add(M.value)}return{status:f.value,value:D}}const P=[...m.data.values()].map((x,D)=>v._parse(new a(m,x,m.path,D)));return m.common.async?Promise.all(P).then(x=>I(x)):I(P)}min(d,f){return new qe({...this._def,minSize:{value:d,message:t.errorUtil.toString(f)}})}max(d,f){return new qe({...this._def,maxSize:{value:d,message:t.errorUtil.toString(f)}})}size(d,f){return this.min(d,f).max(d,f)}nonempty(d){return this.min(1,d)}}n.ZodSet=qe,qe.create=(y,d)=>new qe({valueType:y,minSize:null,maxSize:null,typeName:L.ZodSet,...u(d)});class it extends c{constructor(){super(...arguments),this.validate=this.implement}_parse(d){const{ctx:f}=this._processInputParams(d);if(f.parsedType!==s.ZodParsedType.function)return(0,r.addIssueToContext)(f,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.function,received:f.parsedType}),r.INVALID;function m(P,x){return(0,r.makeIssue)({data:P,path:f.path,errorMaps:[f.common.contextualErrorMap,f.schemaErrorMap,(0,e.getErrorMap)(),e.defaultErrorMap].filter(D=>!!D),issueData:{code:i.ZodIssueCode.invalid_arguments,argumentsError:x}})}function _(P,x){return(0,r.makeIssue)({data:P,path:f.path,errorMaps:[f.common.contextualErrorMap,f.schemaErrorMap,(0,e.getErrorMap)(),e.defaultErrorMap].filter(D=>!!D),issueData:{code:i.ZodIssueCode.invalid_return_type,returnTypeError:x}})}const v={errorMap:f.common.contextualErrorMap},I=f.data;return this._def.returns instanceof at?(0,r.OK)(async(...P)=>{const x=new i.ZodError([]),D=await this._def.args.parseAsync(P,v).catch(ln=>{throw x.addIssue(m(P,ln)),x}),M=await I(...D);return await this._def.returns._def.type.parseAsync(M,v).catch(ln=>{throw x.addIssue(_(M,ln)),x})}):(0,r.OK)((...P)=>{const x=this._def.args.safeParse(P,v);if(!x.success)throw new i.ZodError([m(P,x.error)]);const D=I(...x.data),M=this._def.returns.safeParse(D,v);if(!M.success)throw new i.ZodError([_(D,M.error)]);return M.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...d){return new it({...this._def,args:he.create(d).rest(T.create())})}returns(d){return new it({...this._def,returns:d})}implement(d){return this.parse(d)}strictImplement(d){return this.parse(d)}static create(d,f,m){return new it({args:d||he.create([]).rest(T.create()),returns:f||T.create(),typeName:L.ZodFunction,...u(m)})}}n.ZodFunction=it;class It extends c{get schema(){return this._def.getter()}_parse(d){const{ctx:f}=this._processInputParams(d);return this._def.getter()._parse({data:f.data,path:f.path,parent:f})}}n.ZodLazy=It,It.create=(y,d)=>new It({getter:y,typeName:L.ZodLazy,...u(d)});class Ct extends c{_parse(d){if(d.data!==this._def.value){const f=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(f,{received:f.data,code:i.ZodIssueCode.invalid_literal,expected:this._def.value}),r.INVALID}return{status:"valid",value:d.data}}get value(){return this._def.value}}n.ZodLiteral=Ct,Ct.create=(y,d)=>new Ct({value:y,typeName:L.ZodLiteral,...u(d)});function Vs(y,d){return new xe({values:y,typeName:L.ZodEnum,...u(d)})}class xe extends c{_parse(d){if(typeof d.data!="string"){const f=this._getOrReturnCtx(d),m=this._def.values;return(0,r.addIssueToContext)(f,{expected:s.util.joinValues(m),received:f.parsedType,code:i.ZodIssueCode.invalid_type}),r.INVALID}if(this._def.values.indexOf(d.data)===-1){const f=this._getOrReturnCtx(d),m=this._def.values;return(0,r.addIssueToContext)(f,{received:f.data,code:i.ZodIssueCode.invalid_enum_value,options:m}),r.INVALID}return(0,r.OK)(d.data)}get options(){return this._def.values}get enum(){const d={};for(const f of this._def.values)d[f]=f;return d}get Values(){const d={};for(const f of this._def.values)d[f]=f;return d}get Enum(){const d={};for(const f of this._def.values)d[f]=f;return d}extract(d){return xe.create(d)}exclude(d){return xe.create(this.options.filter(f=>!d.includes(f)))}}n.ZodEnum=xe,xe.create=Vs;class jt extends c{_parse(d){const f=s.util.getValidEnumValues(this._def.values),m=this._getOrReturnCtx(d);if(m.parsedType!==s.ZodParsedType.string&&m.parsedType!==s.ZodParsedType.number){const _=s.util.objectValues(f);return(0,r.addIssueToContext)(m,{expected:s.util.joinValues(_),received:m.parsedType,code:i.ZodIssueCode.invalid_type}),r.INVALID}if(f.indexOf(d.data)===-1){const _=s.util.objectValues(f);return(0,r.addIssueToContext)(m,{received:m.data,code:i.ZodIssueCode.invalid_enum_value,options:_}),r.INVALID}return(0,r.OK)(d.data)}get enum(){return this._def.values}}n.ZodNativeEnum=jt,jt.create=(y,d)=>new jt({values:y,typeName:L.ZodNativeEnum,...u(d)});class at extends c{unwrap(){return this._def.type}_parse(d){const{ctx:f}=this._processInputParams(d);if(f.parsedType!==s.ZodParsedType.promise&&f.common.async===!1)return(0,r.addIssueToContext)(f,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.promise,received:f.parsedType}),r.INVALID;const m=f.parsedType===s.ZodParsedType.promise?f.data:Promise.resolve(f.data);return(0,r.OK)(m.then(_=>this._def.type.parseAsync(_,{path:f.path,errorMap:f.common.contextualErrorMap})))}}n.ZodPromise=at,at.create=(y,d)=>new at({type:y,typeName:L.ZodPromise,...u(d)});class be extends c{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===L.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(d){const{status:f,ctx:m}=this._processInputParams(d),_=this._def.effect||null;if(_.type==="preprocess"){const I=_.transform(m.data);return m.common.async?Promise.resolve(I).then(P=>this._def.schema._parseAsync({data:P,path:m.path,parent:m})):this._def.schema._parseSync({data:I,path:m.path,parent:m})}const v={addIssue:I=>{(0,r.addIssueToContext)(m,I),I.fatal?f.abort():f.dirty()},get path(){return m.path}};if(v.addIssue=v.addIssue.bind(v),_.type==="refinement"){const I=P=>{const x=_.refinement(P,v);if(m.common.async)return Promise.resolve(x);if(x instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return P};if(m.common.async===!1){const P=this._def.schema._parseSync({data:m.data,path:m.path,parent:m});return P.status==="aborted"?r.INVALID:(P.status==="dirty"&&f.dirty(),I(P.value),{status:f.value,value:P.value})}else return this._def.schema._parseAsync({data:m.data,path:m.path,parent:m}).then(P=>P.status==="aborted"?r.INVALID:(P.status==="dirty"&&f.dirty(),I(P.value).then(()=>({status:f.value,value:P.value}))))}if(_.type==="transform")if(m.common.async===!1){const I=this._def.schema._parseSync({data:m.data,path:m.path,parent:m});if(!(0,r.isValid)(I))return I;const P=_.transform(I.value,v);if(P instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:f.value,value:P}}else return this._def.schema._parseAsync({data:m.data,path:m.path,parent:m}).then(I=>(0,r.isValid)(I)?Promise.resolve(_.transform(I.value,v)).then(P=>({status:f.value,value:P})):I);s.util.assertNever(_)}}n.ZodEffects=be,n.ZodTransformer=be,be.create=(y,d,f)=>new be({schema:y,typeName:L.ZodEffects,effect:d,...u(f)}),be.createWithPreprocess=(y,d,f)=>new be({schema:d,effect:{type:"preprocess",transform:y},typeName:L.ZodEffects,...u(f)});class je extends c{_parse(d){return this._getType(d)===s.ZodParsedType.undefined?(0,r.OK)(void 0):this._def.innerType._parse(d)}unwrap(){return this._def.innerType}}n.ZodOptional=je,je.create=(y,d)=>new je({innerType:y,typeName:L.ZodOptional,...u(d)});class ze extends c{_parse(d){return this._getType(d)===s.ZodParsedType.null?(0,r.OK)(null):this._def.innerType._parse(d)}unwrap(){return this._def.innerType}}n.ZodNullable=ze,ze.create=(y,d)=>new ze({innerType:y,typeName:L.ZodNullable,...u(d)});class kt extends c{_parse(d){const{ctx:f}=this._processInputParams(d);let m=f.data;return f.parsedType===s.ZodParsedType.undefined&&(m=this._def.defaultValue()),this._def.innerType._parse({data:m,path:f.path,parent:f})}removeDefault(){return this._def.innerType}}n.ZodDefault=kt,kt.create=(y,d)=>new kt({innerType:y,typeName:L.ZodDefault,defaultValue:typeof d.default=="function"?d.default:()=>d.default,...u(d)});class hr extends c{_parse(d){const{ctx:f}=this._processInputParams(d),m={...f,common:{...f.common,issues:[]}},_=this._def.innerType._parse({data:m.data,path:m.path,parent:{...m}});return(0,r.isAsync)(_)?_.then(v=>({status:"valid",value:v.status==="valid"?v.value:this._def.catchValue({get error(){return new i.ZodError(m.common.issues)},input:m.data})})):{status:"valid",value:_.status==="valid"?_.value:this._def.catchValue({get error(){return new i.ZodError(m.common.issues)},input:m.data})}}removeCatch(){return this._def.innerType}}n.ZodCatch=hr,hr.create=(y,d)=>new hr({innerType:y,typeName:L.ZodCatch,catchValue:typeof d.catch=="function"?d.catch:()=>d.catch,...u(d)});class fr extends c{_parse(d){if(this._getType(d)!==s.ZodParsedType.nan){const m=this._getOrReturnCtx(d);return(0,r.addIssueToContext)(m,{code:i.ZodIssueCode.invalid_type,expected:s.ZodParsedType.nan,received:m.parsedType}),r.INVALID}return{status:"valid",value:d.data}}}n.ZodNaN=fr,fr.create=y=>new fr({typeName:L.ZodNaN,...u(y)}),n.BRAND=Symbol("zod_brand");class Bs extends c{_parse(d){const{ctx:f}=this._processInputParams(d),m=f.data;return this._def.type._parse({data:m,path:f.path,parent:f})}unwrap(){return this._def.type}}n.ZodBranded=Bs;class Rt extends c{_parse(d){const{status:f,ctx:m}=this._processInputParams(d);if(m.common.async)return(async()=>{const v=await this._def.in._parseAsync({data:m.data,path:m.path,parent:m});return v.status==="aborted"?r.INVALID:v.status==="dirty"?(f.dirty(),(0,r.DIRTY)(v.value)):this._def.out._parseAsync({data:v.value,path:m.path,parent:m})})();{const _=this._def.in._parseSync({data:m.data,path:m.path,parent:m});return _.status==="aborted"?r.INVALID:_.status==="dirty"?(f.dirty(),{status:"dirty",value:_.value}):this._def.out._parseSync({data:_.value,path:m.path,parent:m})}}static create(d,f){return new Rt({in:d,out:f,typeName:L.ZodPipeline})}}n.ZodPipeline=Rt;const Io=(y,d={},f)=>y?X.create().superRefine((m,_)=>{var v,I;if(!y(m)){const P=typeof d=="function"?d(m):typeof d=="string"?{message:d}:d,x=(I=(v=P.fatal)!==null&&v!==void 0?v:f)!==null&&I!==void 0?I:!0,D=typeof P=="string"?{message:P}:P;_.addIssue({code:"custom",...D,fatal:x})}}):X.create();n.custom=Io,n.late={object:A.lazycreate};var L;(function(y){y.ZodString="ZodString",y.ZodNumber="ZodNumber",y.ZodNaN="ZodNaN",y.ZodBigInt="ZodBigInt",y.ZodBoolean="ZodBoolean",y.ZodDate="ZodDate",y.ZodSymbol="ZodSymbol",y.ZodUndefined="ZodUndefined",y.ZodNull="ZodNull",y.ZodAny="ZodAny",y.ZodUnknown="ZodUnknown",y.ZodNever="ZodNever",y.ZodVoid="ZodVoid",y.ZodArray="ZodArray",y.ZodObject="ZodObject",y.ZodUnion="ZodUnion",y.ZodDiscriminatedUnion="ZodDiscriminatedUnion",y.ZodIntersection="ZodIntersection",y.ZodTuple="ZodTuple",y.ZodRecord="ZodRecord",y.ZodMap="ZodMap",y.ZodSet="ZodSet",y.ZodFunction="ZodFunction",y.ZodLazy="ZodLazy",y.ZodLiteral="ZodLiteral",y.ZodEnum="ZodEnum",y.ZodEffects="ZodEffects",y.ZodNativeEnum="ZodNativeEnum",y.ZodOptional="ZodOptional",y.ZodNullable="ZodNullable",y.ZodDefault="ZodDefault",y.ZodCatch="ZodCatch",y.ZodPromise="ZodPromise",y.ZodBranded="ZodBranded",y.ZodPipeline="ZodPipeline"})(L=n.ZodFirstPartyTypeKind||(n.ZodFirstPartyTypeKind={}));const Co=(y,d={message:`Input not instance of ${y.name}`})=>(0,n.custom)(f=>f instanceof y,d);n.instanceof=Co;const qs=S.create;n.string=qs;const zs=J.create;n.number=zs;const jo=fr.create;n.nan=jo;const ko=ee.create;n.bigint=ko;const Hs=Y.create;n.boolean=Hs;const Ro=re.create;n.date=Ro;const xo=G.create;n.symbol=xo;const Do=q.create;n.undefined=Do;const $o=Q.create;n.null=$o;const No=X.create;n.any=No;const Lo=T.create;n.unknown=Lo;const Uo=E.create;n.never=Uo;const Mo=R.create;n.void=Mo;const Fo=Z.create;n.array=Fo;const Zo=A.create;n.object=Zo;const Vo=A.strictCreate;n.strictObject=Vo;const Bo=F.create;n.union=Bo;const qo=ae.create;n.discriminatedUnion=qo;const zo=Te.create;n.intersection=zo;const Ho=he.create;n.tuple=Ho;const Ko=St.create;n.record=Ko;const Jo=dr.create;n.map=Jo;const Go=qe.create;n.set=Go;const Wo=it.create;n.function=Wo;const Yo=It.create;n.lazy=Yo;const Qo=Ct.create;n.literal=Qo;const Xo=xe.create;n.enum=Xo;const ec=jt.create;n.nativeEnum=ec;const tc=at.create;n.promise=tc;const Ks=be.create;n.effect=Ks,n.transformer=Ks;const rc=je.create;n.optional=rc;const nc=ze.create;n.nullable=nc;const sc=be.createWithPreprocess;n.preprocess=sc;const ic=Rt.create;n.pipeline=ic;const ac=()=>qs().optional();n.ostring=ac;const oc=()=>zs().optional();n.onumber=oc;const cc=()=>Hs().optional();n.oboolean=cc,n.coerce={string:y=>S.create({...y,coerce:!0}),number:y=>J.create({...y,coerce:!0}),boolean:y=>Y.create({...y,coerce:!0}),bigint:y=>ee.create({...y,coerce:!0}),date:y=>re.create({...y,coerce:!0})},n.NEVER=r.INVALID})(To);(function(n){var e=z&&z.__createBinding||(Object.create?function(r,s,i,a){a===void 0&&(a=i),Object.defineProperty(r,a,{enumerable:!0,get:function(){return s[i]}})}:function(r,s,i,a){a===void 0&&(a=i),r[a]=s[i]}),t=z&&z.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&e(s,r,i)};Object.defineProperty(n,"__esModule",{value:!0}),t(Se,n),t(Us,n),t(Oo,n),t(lr,n),t(To,n),t(Ie,n)})(us);(function(n){var e=z&&z.__createBinding||(Object.create?function(a,o,u,c){c===void 0&&(c=u),Object.defineProperty(a,c,{enumerable:!0,get:function(){return o[u]}})}:function(a,o,u,c){c===void 0&&(c=u),a[c]=o[u]}),t=z&&z.__setModuleDefault||(Object.create?function(a,o){Object.defineProperty(a,"default",{enumerable:!0,value:o})}:function(a,o){a.default=o}),r=z&&z.__importStar||function(a){if(a&&a.__esModule)return a;var o={};if(a!=null)for(var u in a)u!=="default"&&Object.prototype.hasOwnProperty.call(a,u)&&e(o,a,u);return t(o,a),o},s=z&&z.__exportStar||function(a,o){for(var u in a)u!=="default"&&!Object.prototype.hasOwnProperty.call(o,u)&&e(o,a,u)};Object.defineProperty(n,"__esModule",{value:!0}),n.z=void 0;const i=r(us);n.z=i,s(us,n),n.default=i})(Hr);var Jr={};Object.defineProperty(Jr,"__esModule",{value:!0});Jr.parseAnyDef=void 0;function tm(){return{}}Jr.parseAnyDef=tm;var Nt={},Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.setResponseValueAndErrors=Oe.addErrorMessage=void 0;function Eo(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage=Object.assign(Object.assign({},n.errorMessage),{[e]:t}))}Oe.addErrorMessage=Eo;function rm(n,e,t,r,s){n[e]=t,Eo(n,e,r,s)}Oe.setResponseValueAndErrors=rm;var zi;function nm(){if(zi)return Nt;zi=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.parseArrayDef=void 0;const n=Hr,e=Oe,t=ie();function r(s,i){var a,o;const u={type:"array"};return((o=(a=s.type)===null||a===void 0?void 0:a._def)===null||o===void 0?void 0:o.typeName)!==n.ZodFirstPartyTypeKind.ZodAny&&(u.items=(0,t.parseDef)(s.type._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"items"]}))),s.minLength&&(0,e.setResponseValueAndErrors)(u,"minItems",s.minLength.value,s.minLength.message,i),s.maxLength&&(0,e.setResponseValueAndErrors)(u,"maxItems",s.maxLength.value,s.maxLength.message,i),u}return Nt.parseArrayDef=r,Nt}var Gr={};Object.defineProperty(Gr,"__esModule",{value:!0});Gr.parseBigintDef=void 0;const Je=Oe;function sm(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?(0,Je.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e):(0,Je.setResponseValueAndErrors)(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),(0,Je.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?(0,Je.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e):(0,Je.setResponseValueAndErrors)(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),(0,Je.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e));break;case"multipleOf":(0,Je.setResponseValueAndErrors)(t,"multipleOf",r.value,r.message,e);break}return t}Gr.parseBigintDef=sm;var Wr={};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.parseBooleanDef=void 0;function im(){return{type:"boolean"}}Wr.parseBooleanDef=im;var Lt={},Hi;function am(){if(Hi)return Lt;Hi=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.parseBrandedDef=void 0;const n=ie();function e(t,r){return(0,n.parseDef)(t.type._def,r)}return Lt.parseBrandedDef=e,Lt}var Ut={},Ki;function om(){if(Ki)return Ut;Ki=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.parseCatchDef=void 0;const n=ie(),e=(t,r)=>(0,n.parseDef)(t.innerType._def,r);return Ut.parseCatchDef=e,Ut}var Yr={};Object.defineProperty(Yr,"__esModule",{value:!0});Yr.parseDateDef=void 0;const Ji=Oe;function cm(n,e){return e.dateStrategy=="integer"?um(n,e):{type:"string",format:"date-time"}}Yr.parseDateDef=cm;const um=(n,e)=>{const t={type:"integer",format:"unix-time"};for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"&&(0,Ji.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e);break;case"max":e.target==="jsonSchema7"&&(0,Ji.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e);break}return t};var Mt={},Gi;function lm(){if(Gi)return Mt;Gi=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.parseDefaultDef=void 0;const n=ie();function e(t,r){return Object.assign(Object.assign({},(0,n.parseDef)(t.innerType._def,r)),{default:t.defaultValue()})}return Mt.parseDefaultDef=e,Mt}var Ft={},Wi;function dm(){if(Wi)return Ft;Wi=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.parseEffectsDef=void 0;const n=ie();function e(t,r){return r.effectStrategy==="input"?(0,n.parseDef)(t.schema._def,r):{}}return Ft.parseEffectsDef=e,Ft}var Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.parseEnumDef=void 0;function hm(n){return{type:"string",enum:n.values}}Qr.parseEnumDef=hm;var Zt={},Yi;function fm(){if(Yi)return Zt;Yi=1;var n=z&&z.__rest||function(s,i){var a={};for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&i.indexOf(o)<0&&(a[o]=s[o]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,o=Object.getOwnPropertySymbols(s);u<o.length;u++)i.indexOf(o[u])<0&&Object.prototype.propertyIsEnumerable.call(s,o[u])&&(a[o[u]]=s[o[u]]);return a};Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.parseIntersectionDef=void 0;const e=ie(),t=s=>"type"in s&&s.type==="string"?!1:"allOf"in s;function r(s,i){const a=[(0,e.parseDef)(s.left._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"allOf","0"]})),(0,e.parseDef)(s.right._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"allOf","1"]}))].filter(c=>!!c);let o=i.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const u=[];return a.forEach(c=>{if(t(c))u.push(...c.allOf),c.unevaluatedProperties===void 0&&(o=void 0);else{let l=c;"additionalProperties"in c&&c.additionalProperties===!1?l=n(c,["additionalProperties"]):o=void 0,u.push(l)}}),u.length?Object.assign({allOf:u},o):void 0}return Zt.parseIntersectionDef=r,Zt}var Xr={};Object.defineProperty(Xr,"__esModule",{value:!0});Xr.parseLiteralDef=void 0;function pm(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}Xr.parseLiteralDef=pm;var Vt={},Qi;function mm(){if(Qi)return Vt;Qi=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.parseMapDef=void 0;const n=ie();function e(t,r){const s=(0,n.parseDef)(t.keyType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items","items","0"]}))||{},i=(0,n.parseDef)(t.valueType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items","items","1"]}))||{};return{type:"array",maxItems:125,items:{type:"array",items:[s,i],minItems:2,maxItems:2}}}return Vt.parseMapDef=e,Vt}var en={};Object.defineProperty(en,"__esModule",{value:!0});en.parseNativeEnumDef=void 0;function gm(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}en.parseNativeEnumDef=gm;var tn={};Object.defineProperty(tn,"__esModule",{value:!0});tn.parseNeverDef=void 0;function ym(){return{not:{}}}tn.parseNeverDef=ym;var rn={};Object.defineProperty(rn,"__esModule",{value:!0});rn.parseNullDef=void 0;function vm(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}rn.parseNullDef=vm;var Bt={},qn={},Xi;function Ao(){return Xi||(Xi=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseUnionDef=n.primitiveMappings=void 0;const e=ie();n.primitiveMappings={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function t(s,i){if(i.target==="openApi3")return r(s,i);const a=s.options instanceof Map?Array.from(s.options.values()):s.options;if(a.every(o=>o._def.typeName in n.primitiveMappings&&(!o._def.checks||!o._def.checks.length))){const o=a.reduce((u,c)=>{const l=n.primitiveMappings[c._def.typeName];return l&&!u.includes(l)?[...u,l]:u},[]);return{type:o.length>1?o:o[0]}}else if(a.every(o=>o._def.typeName==="ZodLiteral"&&!o.description)){const o=a.reduce((u,c)=>{const l=typeof c._def.value;switch(l){case"string":case"number":case"boolean":return[...u,l];case"bigint":return[...u,"integer"];case"object":if(c._def.value===null)return[...u,"null"];case"symbol":case"undefined":case"function":default:return u}},[]);if(o.length===a.length){const u=o.filter((c,l,h)=>h.indexOf(c)===l);return{type:u.length>1?u:u[0],enum:a.reduce((c,l)=>c.includes(l._def.value)?c:[...c,l._def.value],[])}}}else if(a.every(o=>o._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((o,u)=>[...o,...u._def.values.filter(c=>!o.includes(c))],[])};return r(s,i)}n.parseUnionDef=t;const r=(s,i)=>{const a=(s.options instanceof Map?Array.from(s.options.values()):s.options).map((o,u)=>(0,e.parseDef)(o._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"anyOf",`${u}`]}))).filter(o=>!!o&&(!i.strictUnions||typeof o=="object"&&Object.keys(o).length>0));return a.length?{anyOf:a}:void 0}}(qn)),qn}var ea;function bm(){if(ea)return Bt;ea=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.parseNullableDef=void 0;const n=ie(),e=Ao();function t(r,s){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return s.target==="openApi3"?{type:e.primitiveMappings[r.innerType._def.typeName],nullable:!0}:{type:[e.primitiveMappings[r.innerType._def.typeName],"null"]};const i=(0,n.parseDef)(r.innerType._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"anyOf","0"]}));return i?s.target==="openApi3"?Object.assign(Object.assign({},i),{nullable:!0}):{anyOf:[i,{type:"null"}]}:void 0}return Bt.parseNullableDef=t,Bt}var nn={};Object.defineProperty(nn,"__esModule",{value:!0});nn.parseNumberDef=void 0;const Le=Oe;function _m(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",(0,Le.addErrorMessage)(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?(0,Le.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e):(0,Le.setResponseValueAndErrors)(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),(0,Le.setResponseValueAndErrors)(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?(0,Le.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e):(0,Le.setResponseValueAndErrors)(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),(0,Le.setResponseValueAndErrors)(t,"maximum",r.value,r.message,e));break;case"multipleOf":(0,Le.setResponseValueAndErrors)(t,"multipleOf",r.value,r.message,e);break}return t}nn.parseNumberDef=_m;var Ge={},ta;function wm(){if(ta)return Ge;ta=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.parseObjectDef=Ge.parseObjectDefX=void 0;const n=ie();function e(r,s){var i,a;Object.keys(r.shape()).reduce((u,c)=>{let l=r.shape()[c];const h=l.isOptional();h||(l=Object.assign({},l._def.innerSchema));const p=(0,n.parseDef)(l._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"properties",c],propertyPath:[...s.currentPath,"properties",c]}));return p!==void 0&&(u.properties[c]=p,h||(u.required||(u.required=[]),u.required.push(c))),u},{type:"object",properties:{},additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(i=(0,n.parseDef)(r.catchall._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"additionalProperties"]})))!==null&&i!==void 0?i:!0});const o=Object.assign(Object.assign({type:"object"},Object.entries(r.shape()).reduce((u,[c,l])=>{if(l===void 0||l._def===void 0)return u;const h=(0,n.parseDef)(l._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"properties",c],propertyPath:[...s.currentPath,"properties",c]}));return h===void 0?u:{properties:Object.assign(Object.assign({},u.properties),{[c]:h}),required:l.isOptional()?u.required:[...u.required,c]}},{properties:{},required:[]})),{additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(a=(0,n.parseDef)(r.catchall._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"additionalProperties"]})))!==null&&a!==void 0?a:!0});return o.required.length||delete o.required,o}Ge.parseObjectDefX=e;function t(r,s){var i;const a=Object.assign(Object.assign({type:"object"},Object.entries(r.shape()).reduce((o,[u,c])=>{if(c===void 0||c._def===void 0)return o;const l=(0,n.parseDef)(c._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"properties",u],propertyPath:[...s.currentPath,"properties",u]}));return l===void 0?o:{properties:Object.assign(Object.assign({},o.properties),{[u]:l}),required:c.isOptional()?o.required:[...o.required,u]}},{properties:{},required:[]})),{additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(i=(0,n.parseDef)(r.catchall._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"additionalProperties"]})))!==null&&i!==void 0?i:!0});return a.required.length||delete a.required,a}return Ge.parseObjectDef=t,Ge}var qt={},ra;function Om(){if(ra)return qt;ra=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.parseOptionalDef=void 0;const n=ie(),e=(t,r)=>{var s;if(r.currentPath.toString()===((s=r.propertyPath)===null||s===void 0?void 0:s.toString()))return(0,n.parseDef)(t.innerType._def,r);const i=(0,n.parseDef)(t.innerType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"anyOf","1"]}));return i?{anyOf:[{not:{}},i]}:{}};return qt.parseOptionalDef=e,qt}var zt={},na;function Tm(){if(na)return zt;na=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.parsePipelineDef=void 0;const n=ie(),e=(t,r)=>{if(r.pipeStrategy==="input")return(0,n.parseDef)(t.in._def,r);const s=(0,n.parseDef)(t.in._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"allOf","0"]})),i=(0,n.parseDef)(t.out._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"allOf",s?"1":"0"]}));return{allOf:[s,i].filter(a=>a!==void 0)}};return zt.parsePipelineDef=e,zt}var Ht={},sa;function Pm(){if(sa)return Ht;sa=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.parsePromiseDef=void 0;const n=ie();function e(t,r){return(0,n.parseDef)(t.type._def,r)}return Ht.parsePromiseDef=e,Ht}var Kt={},Ms={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseStringDef=n.emojiPattern=n.ulidPattern=n.cuid2Pattern=n.cuidPattern=n.emailPattern=void 0;const e=Oe;n.emailPattern='^(([^<>()[\\]\\\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$',n.cuidPattern="^c[^\\s-]{8,}$",n.cuid2Pattern="^[a-z][a-z0-9]*$",n.ulidPattern="/[0-9A-HJKMNP-TV-Z]{26}/",n.emojiPattern="/^(p{Extended_Pictographic}|p{Emoji_Component})+$/u";function t(a,o){const u={type:"string"};if(a.checks)for(const c of a.checks)switch(c.kind){case"min":(0,e.setResponseValueAndErrors)(u,"minLength",typeof u.minLength=="number"?Math.max(u.minLength,c.value):c.value,c.message,o);break;case"max":(0,e.setResponseValueAndErrors)(u,"maxLength",typeof u.maxLength=="number"?Math.min(u.maxLength,c.value):c.value,c.message,o);break;case"email":switch(o.emailStrategy){case"format:email":s(u,"email",c.message,o);break;case"format:idn-email":s(u,"idn-email",c.message,o);break;case"pattern:zod":i(u,n.emailPattern,c.message,o);break}break;case"url":s(u,"uri",c.message,o);break;case"uuid":s(u,"uuid",c.message,o);break;case"regex":i(u,c.regex.source,c.message,o);break;case"cuid":i(u,n.cuidPattern,c.message,o);break;case"cuid2":i(u,n.cuid2Pattern,c.message,o);break;case"startsWith":i(u,"^"+r(c.value),c.message,o);break;case"endsWith":i(u,r(c.value)+"$",c.message,o);break;case"datetime":s(u,"date-time",c.message,o);break;case"length":(0,e.setResponseValueAndErrors)(u,"minLength",typeof u.minLength=="number"?Math.max(u.minLength,c.value):c.value,c.message,o),(0,e.setResponseValueAndErrors)(u,"maxLength",typeof u.maxLength=="number"?Math.min(u.maxLength,c.value):c.value,c.message,o);break;case"includes":{i(u,r(c.value),c.message,o);break}case"ip":{c.version!=="v6"&&s(u,"ipv4",c.message,o),c.version!=="v4"&&s(u,"ipv6",c.message,o);break}case"emoji":i(u,n.emojiPattern,c.message,o);break;case"ulid":{i(u,n.ulidPattern,c.message,o);break}}return u}n.parseStringDef=t;const r=a=>Array.from(a).map(o=>/[a-zA-Z0-9]/.test(o)?o:`\\${o}`).join(""),s=(a,o,u,c)=>{var l;a.format||!((l=a.anyOf)===null||l===void 0)&&l.some(h=>h.format)?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push(Object.assign({format:a.format},a.errorMessage&&c.errorMessages&&{errorMessage:{format:a.errorMessage.format}})),delete a.format,a.errorMessage&&(delete a.errorMessage.format,Object.keys(a.errorMessage).length===0&&delete a.errorMessage)),a.anyOf.push(Object.assign({format:o},u&&c.errorMessages&&{errorMessage:{format:u}}))):(0,e.setResponseValueAndErrors)(a,"format",o,u,c)},i=(a,o,u,c)=>{var l;a.pattern||!((l=a.allOf)===null||l===void 0)&&l.some(h=>h.pattern)?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push(Object.assign({pattern:a.pattern},a.errorMessage&&c.errorMessages&&{errorMessage:{pattern:a.errorMessage.pattern}})),delete a.pattern,a.errorMessage&&(delete a.errorMessage.pattern,Object.keys(a.errorMessage).length===0&&delete a.errorMessage)),a.allOf.push(Object.assign({pattern:o},u&&c.errorMessages&&{errorMessage:{pattern:u}}))):(0,e.setResponseValueAndErrors)(a,"pattern",o,u,c)}})(Ms);var ia;function Em(){if(ia)return Kt;ia=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.parseRecordDef=void 0;const n=Hr,e=ie(),t=Ms;function r(s,i){var a,o,u,c,l;if(i.target==="openApi3"&&((a=s.keyType)===null||a===void 0?void 0:a._def.typeName)===n.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:s.keyType._def.values,properties:s.keyType._def.values.reduce((p,g)=>{var b;return Object.assign(Object.assign({},p),{[g]:(b=(0,e.parseDef)(s.valueType._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"properties",g]})))!==null&&b!==void 0?b:{}})},{}),additionalProperties:!1};const h={type:"object",additionalProperties:(o=(0,e.parseDef)(s.valueType._def,Object.assign(Object.assign({},i),{currentPath:[...i.currentPath,"additionalProperties"]})))!==null&&o!==void 0?o:{}};if(i.target==="openApi3")return h;if(((u=s.keyType)===null||u===void 0?void 0:u._def.typeName)===n.ZodFirstPartyTypeKind.ZodString&&(!((c=s.keyType._def.checks)===null||c===void 0)&&c.length)){const p=Object.entries((0,t.parseStringDef)(s.keyType._def,i)).reduce((g,[b,w])=>b==="type"?g:Object.assign(Object.assign({},g),{[b]:w}),{});return Object.assign(Object.assign({},h),{propertyNames:p})}else if(((l=s.keyType)===null||l===void 0?void 0:l._def.typeName)===n.ZodFirstPartyTypeKind.ZodEnum)return Object.assign(Object.assign({},h),{propertyNames:{enum:s.keyType._def.values}});return h}return Kt.parseRecordDef=r,Kt}var Jt={},aa;function Am(){if(aa)return Jt;aa=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.parseSetDef=void 0;const n=Oe,e=ie();function t(r,s){const a={type:"array",uniqueItems:!0,items:(0,e.parseDef)(r.valueType._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"items"]}))};return r.minSize&&(0,n.setResponseValueAndErrors)(a,"minItems",r.minSize.value,r.minSize.message,s),r.maxSize&&(0,n.setResponseValueAndErrors)(a,"maxItems",r.maxSize.value,r.maxSize.message,s),a}return Jt.parseSetDef=t,Jt}var Gt={},oa;function Sm(){if(oa)return Gt;oa=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.parseTupleDef=void 0;const n=ie();function e(t,r){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((s,i)=>(0,n.parseDef)(s._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items",`${i}`]}))).reduce((s,i)=>i===void 0?s:[...s,i],[]),additionalItems:(0,n.parseDef)(t.rest._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"additionalItems"]}))}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((s,i)=>(0,n.parseDef)(s._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items",`${i}`]}))).reduce((s,i)=>i===void 0?s:[...s,i],[])}}return Gt.parseTupleDef=e,Gt}var sn={};Object.defineProperty(sn,"__esModule",{value:!0});sn.parseUndefinedDef=void 0;function Im(){return{not:{}}}sn.parseUndefinedDef=Im;var an={};Object.defineProperty(an,"__esModule",{value:!0});an.parseUnknownDef=void 0;function Cm(){return{}}an.parseUnknownDef=Cm;var ca;function ie(){if(ca)return $t;ca=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.parseDef=void 0;const n=Hr,e=Jr,t=nm(),r=Gr,s=Wr,i=am(),a=om(),o=Yr,u=lm(),c=dm(),l=Qr,h=fm(),p=Xr,g=mm(),b=en,w=tn,O=rn,C=bm(),k=nn,j=wm(),S=Om(),U=Tm(),J=Pm(),ee=Em(),Y=Am(),re=Ms,G=Sm(),q=sn,Q=Ao(),X=an;function T(A,F,$=!1){const ae=F.seen.get(A);if(ae&&!$){const he=E(ae,F);if(he!==void 0)return he}const st={def:A,path:F.currentPath,jsonSchema:void 0};F.seen.set(A,st);const Te=Z(A,A.typeName,F);return Te&&H(A,F,Te),st.jsonSchema=Te,Te}$t.parseDef=T;const E=(A,F)=>{switch(F.$refStrategy){case"root":return{$ref:A.path.length===0?"":A.path.length===1?`${A.path[0]}/`:A.path.join("/")};case"relative":return{$ref:R(F.currentPath,A.path)};case"none":return A.path.length<F.currentPath.length&&A.path.every(($,ae)=>F.currentPath[ae]===$)?(console.warn(`Recursive reference detected at ${F.currentPath.join("/")}! Defaulting to any`),{}):void 0;case"seen":return A.path.length<F.currentPath.length&&A.path.every(($,ae)=>F.currentPath[ae]===$)?(console.warn(`Recursive reference detected at ${F.currentPath.join("/")}! Defaulting to any`),{}):A.jsonSchema}},R=(A,F)=>{let $=0;for(;$<A.length&&$<F.length&&A[$]===F[$];$++);return[(A.length-$).toString(),...F.slice($)].join("/")},Z=(A,F,$)=>{switch(F){case n.ZodFirstPartyTypeKind.ZodString:return(0,re.parseStringDef)(A,$);case n.ZodFirstPartyTypeKind.ZodNumber:return(0,k.parseNumberDef)(A,$);case n.ZodFirstPartyTypeKind.ZodObject:return(0,j.parseObjectDef)(A,$);case n.ZodFirstPartyTypeKind.ZodBigInt:return(0,r.parseBigintDef)(A,$);case n.ZodFirstPartyTypeKind.ZodBoolean:return(0,s.parseBooleanDef)();case n.ZodFirstPartyTypeKind.ZodDate:return(0,o.parseDateDef)(A,$);case n.ZodFirstPartyTypeKind.ZodUndefined:return(0,q.parseUndefinedDef)();case n.ZodFirstPartyTypeKind.ZodNull:return(0,O.parseNullDef)($);case n.ZodFirstPartyTypeKind.ZodArray:return(0,t.parseArrayDef)(A,$);case n.ZodFirstPartyTypeKind.ZodUnion:case n.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return(0,Q.parseUnionDef)(A,$);case n.ZodFirstPartyTypeKind.ZodIntersection:return(0,h.parseIntersectionDef)(A,$);case n.ZodFirstPartyTypeKind.ZodTuple:return(0,G.parseTupleDef)(A,$);case n.ZodFirstPartyTypeKind.ZodRecord:return(0,ee.parseRecordDef)(A,$);case n.ZodFirstPartyTypeKind.ZodLiteral:return(0,p.parseLiteralDef)(A,$);case n.ZodFirstPartyTypeKind.ZodEnum:return(0,l.parseEnumDef)(A);case n.ZodFirstPartyTypeKind.ZodNativeEnum:return(0,b.parseNativeEnumDef)(A);case n.ZodFirstPartyTypeKind.ZodNullable:return(0,C.parseNullableDef)(A,$);case n.ZodFirstPartyTypeKind.ZodOptional:return(0,S.parseOptionalDef)(A,$);case n.ZodFirstPartyTypeKind.ZodMap:return(0,g.parseMapDef)(A,$);case n.ZodFirstPartyTypeKind.ZodSet:return(0,Y.parseSetDef)(A,$);case n.ZodFirstPartyTypeKind.ZodLazy:return T(A.getter()._def,$);case n.ZodFirstPartyTypeKind.ZodPromise:return(0,J.parsePromiseDef)(A,$);case n.ZodFirstPartyTypeKind.ZodNaN:case n.ZodFirstPartyTypeKind.ZodNever:return(0,w.parseNeverDef)();case n.ZodFirstPartyTypeKind.ZodEffects:return(0,c.parseEffectsDef)(A,$);case n.ZodFirstPartyTypeKind.ZodAny:return(0,e.parseAnyDef)();case n.ZodFirstPartyTypeKind.ZodUnknown:return(0,X.parseUnknownDef)();case n.ZodFirstPartyTypeKind.ZodDefault:return(0,u.parseDefaultDef)(A,$);case n.ZodFirstPartyTypeKind.ZodBranded:return(0,i.parseBrandedDef)(A,$);case n.ZodFirstPartyTypeKind.ZodCatch:return(0,a.parseCatchDef)(A,$);case n.ZodFirstPartyTypeKind.ZodPipeline:return(0,U.parsePipelineDef)(A,$);case n.ZodFirstPartyTypeKind.ZodFunction:case n.ZodFirstPartyTypeKind.ZodVoid:case n.ZodFirstPartyTypeKind.ZodSymbol:return;default:return(ae=>{})()}},H=(A,F,$)=>(A.description&&($.description=A.description,F.markdownDescription&&($.markdownDescription=A.description)),$);return $t}var on={},So={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultOptions=n.defaultOptions=void 0,n.defaultOptions={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,emailStrategy:"format:email"};const e=t=>typeof t=="string"?Object.assign(Object.assign({},n.defaultOptions),{name:t}):Object.assign(Object.assign({},n.defaultOptions),t);n.getDefaultOptions=e})(So);Object.defineProperty(on,"__esModule",{value:!0});on.getRefs=void 0;const jm=So,km=n=>{const e=(0,jm.getDefaultOptions)(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return Object.assign(Object.assign({},e),{currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))})};on.getRefs=km;Object.defineProperty(zr,"__esModule",{value:!0});zr.zodToJsonSchema=void 0;const ua=ie(),Rm=on,xm=(n,e)=>{var t;const r=(0,Rm.getRefs)(e),s=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,l])=>{var h;return Object.assign(Object.assign({},u),{[c]:(h=(0,ua.parseDef)(l._def,Object.assign(Object.assign({},r),{currentPath:[...r.basePath,r.definitionPath,c]}),!0))!==null&&h!==void 0?h:{}})},{}):void 0,i=typeof e=="string"?e:e==null?void 0:e.name,a=(t=(0,ua.parseDef)(n._def,i===void 0?r:Object.assign(Object.assign({},r),{currentPath:[...r.basePath,r.definitionPath,i]}),!1))!==null&&t!==void 0?t:{},o=i===void 0?s?Object.assign(Object.assign({},a),{[r.definitionPath]:s}):a:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,i].join("/"),[r.definitionPath]:Object.assign(Object.assign({},s),{[i]:a})};return r.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":r.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};zr.zodToJsonSchema=xm;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.zodToJsonSchema=void 0;const e=zr;Object.defineProperty(n,"zodToJsonSchema",{enumerable:!0,get:function(){return e.zodToJsonSchema}}),n.default=e.zodToJsonSchema})(vo);function Dm(n){return{name:n.name,description:n.description,parameters:vo.zodToJsonSchema(n.schema)}}function ds(n){switch(n){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";default:throw new Error(`Unknown message type: ${n}`)}}function $m(n){switch(n.role){case"user":return new Ua(n.content||"");case"assistant":return new Md(n.content||"",{function_call:n.function_call});case"system":return new Fd(n.content||"");default:return new Zd(n.content||"",n.role??"unknown")}}class Fs extends Jp{get callKeys(){return["stop","signal","timeout","options","functions","tools"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??te("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??te("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("(Azure) OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??te("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e==null?void 0:e.azureOpenAIApiDeploymentName)??te("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??te("AZURE_OPENAI_API_VERSION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.streaming=(e==null?void 0:e.streaming)??!1,this.streaming&&this.n>1)throw new Error("Cannot stream results when n > 1");if(this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found")}this.clientConfig={apiKey:this.openAIApiKey,...t,...e==null?void 0:e.configuration}}invocationParams(){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,n:this.n,logit_bias:this.logitBias,stop:this.stop,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){var p;const s={};if(this.stop&&(t!=null&&t.stop))throw new Error("Stop found in input and default params");const i=this.invocationParams();i.stop=(t==null?void 0:t.stop)??i.stop,i.functions=(t==null?void 0:t.functions)??(t!=null&&t.tools?t==null?void 0:t.tools.map(Dm):void 0),i.function_call=t==null?void 0:t.function_call;const a=e.map(g=>({role:ds(g._getType()),content:g.text,name:g.name})),o=i.stream?await new Promise((g,b)=>{let w,O=!1,C=!1;this.completionWithRetry({...i,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options,adapter:os,responseType:"stream",onmessage:k=>{var j,S,U,J,ee,Y,re,G,q,Q;if(((S=(j=k.data)==null?void 0:j.trim)==null?void 0:S.call(j))==="[DONE]"){if(C||O)return;C=!0,g(w)}else{const X=JSON.parse(k.data);if(X!=null&&X.error){if(O)return;O=!0,b(X.error);return}const T=X;w||(w={id:T.id,object:T.object,created:T.created,model:T.model,choices:[]});for(const E of T.choices??[])if(E!=null){let R=w.choices.find(Z=>Z.index===E.index);R||(R={index:E.index,finish_reason:E.finish_reason??void 0},w.choices[E.index]=R),R.message||(R.message={role:(U=E.delta)==null?void 0:U.role,content:""}),E.delta.function_call&&!R.message.function_call&&(R.message.function_call={name:"",arguments:""}),R.message.content+=((J=E.delta)==null?void 0:J.content)??"",R.message.function_call&&(R.message.function_call.name+=((Y=(ee=E.delta)==null?void 0:ee.function_call)==null?void 0:Y.name)??"",R.message.function_call.arguments+=((G=(re=E.delta)==null?void 0:re.function_call)==null?void 0:G.arguments)??""),r==null||r.handleLLMNewToken(((q=E.delta)==null?void 0:q.content)??"")}!C&&!O&&((Q=T.choices)!=null&&Q.every(E=>E.finish_reason!=null))&&(C=!0,g(w))}}}).catch(k=>{O||(O=!0,b(k))})}):await this.completionWithRetry({...i,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}),{completion_tokens:u,prompt_tokens:c,total_tokens:l}=o.usage??{};u&&(s.completionTokens=(s.completionTokens??0)+u),c&&(s.promptTokens=(s.promptTokens??0)+c),l&&(s.totalTokens=(s.totalTokens??0)+l);const h=[];for(const g of o.choices){const b=((p=g.message)==null?void 0:p.content)??"";h.push({text:b,message:$m(g.message??{role:"assistant"})})}return{generations:h,llmOutput:{tokenUsage:s}}}async getNumTokensFromMessages(e){let t=0,r=0,s=0;cs(this.modelName)==="gpt-3.5-turbo"?(r=4,s=-1):cs(this.modelName).startsWith("gpt-4")&&(r=3,s=1);const i=await Promise.all(e.map(async a=>{const o=await this.getNumTokens(a.text),u=await this.getNumTokens(ds(a._getType())),c=a.name!==void 0?s+await this.getNumTokens(a.name):0,l=o+r+u+c;return t+=l,l}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){if(!this.client){const s=this.azureOpenAIApiKey?`https://${this.azureOpenAIApiInstanceName}.openai.azure.com/openai/deployments/${this.azureOpenAIApiDeploymentName}`:this.clientConfig.basePath,i=new sr.Configuration({...this.clientConfig,basePath:s,baseOptions:{timeout:this.timeout,...this.clientConfig.baseOptions}});this.client=new sr.OpenAIApi(i)}const r={adapter:xs()?void 0:os,...this.clientConfig.baseOptions,...t};return this.azureOpenAIApiKey&&(r.headers={"api-key":this.azureOpenAIApiKey,...r.headers},r.params={"api-version":this.azureOpenAIApiVersion,...r.params}),this.caller.call(this.client.createChatCompletion.bind(this.client),e,r).then(s=>s.data)}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}class Nm extends Fs{constructor(e){var t;super(e),Object.defineProperty(this,"promptLayerApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"plTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnPromptLayerId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.promptLayerApiKey=(e==null?void 0:e.promptLayerApiKey)??(typeof process<"u"?(t=process.env)==null?void 0:t.PROMPTLAYER_API_KEY:void 0),this.plTags=(e==null?void 0:e.plTags)??[],this.returnPromptLayerId=(e==null?void 0:e.returnPromptLayerId)??!1}async _generate(e,t,r){const s=Date.now();let i;Array.isArray(t)?i={stop:t}:t!=null&&t.timeout&&!t.signal?i={...t,signal:AbortSignal.timeout(t.timeout)}:i=t??{};const a=await super._generate(e,i,r),o=Date.now(),u=l=>{let h;if(l._getType()==="human")h={role:"user",content:l.text};else if(l._getType()==="ai")h={role:"assistant",content:l.text};else if(l._getType()==="system")h={role:"system",content:l.text};else if(l._getType()==="generic")h={role:l.role,content:l.text};else throw new Error(`Got unknown type ${l}`);return h},c=(l,h)=>{const p={...this.invocationParams(),model:this.modelName};if(h!=null&&h.stop&&Object.keys(p).includes("stop"))throw new Error("`stop` found in both the input and default params.");return l.map(b=>u(b))};for(let l=0;l<a.generations.length;l+=1){const h=a.generations[l],p=c(e,i);let g;const b=[{content:h.text,role:ds(h.message._getType())}],w=await Gp(this.caller,"langchain.PromptLayerChatOpenAI",p,this._identifyingParams(),this.plTags,b,s,o,this.promptLayerApiKey);this.returnPromptLayerId===!0&&(w.success===!0&&(g=w.request_id),(!h.generationInfo||typeof h.generationInfo!="object")&&(h.generationInfo={}),h.generationInfo.promptLayerRequestId=g)}return a}}const Lm=Object.freeze(Object.defineProperty({__proto__:null,ChatOpenAI:Fs,PromptLayerChatOpenAI:Nm},Symbol.toStringTag,{value:"Module"}));var Um=Object.defineProperty,Mm=(n,e,t)=>e in n?Um(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,la=(n,e,t)=>(Mm(n,typeof e!="symbol"?e+"":e,t),t);class Fm{constructor(e,t){la(this,"config"),la(this,"webData"),this.config=e,this.webData=t}}function Zm(n=""){const e=n?n.replace(/&#39;/g,"'").replace(/(\r\n)+/g,`\r
`).replace(/(\s{2,})/g," ").replace(/^(\s)+|(\s)$/g,""):"";return Bm(e)}const da=14e3,Vm=1300;function Bm(n){let e=n;const t=zm(n).length;if(t>da){const r=da/t;e=n.substring(0,Math.floor(n.length*r))}return qm(e)}function qm(n){const e=Vm;let t=Hn(n);if(t>e){let r=n;for(;t>e;){const s=t-e;r=r.substring(0,r.length-(s/2<10?10:s/2)),t=Hn(r)}return r}return n}function zm(n){return decodeURIComponent(encodeURIComponent(escape(n))).replace(/%([0-9A-F]{2})/gi,(e,t)=>{const r=Number.parseInt(t,16);return String.fromCharCode(r)})}class Hm extends Fm{constructor(e,t){super(e,t)}async summarize(e){if(!e&&!this.webData)throw new Error("OpenaiSummarizeContent error: No WebInfo Data");const t=e||this.webData;return await Km(this.config.apiKey,t,this.config.lang,this.config.apiHost)}embeddingsInfo(){const e=new Ep({openAIApiKey:this.config.apiKey},{basePath:`${this.config.apiHost}/v1`});return{llmModel:new Fs({openAIApiKey:this.config.apiKey,modelName:"gpt-3.5-turbo",temperature:.2},{basePath:`${this.config.apiHost}/v1`}),embeddings:e,indexName:"openai_documents",queryName:"openai_match_documents"}}}async function Km(n,e,t="zh-CN",r=Ws){let s="",i=[],a=e.content;a=fc(a);const o=Hn(a),u=r===Ws?`${r}/v1`:r;if(o>40){a=Zm(a);const l={content:a,language:bu[t],webprompts:e.meta.prompts||""},h=pc(vu,l),p=(await Ae(`${u}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:{model:"gpt-3.5-turbo",messages:[{role:"system",content:yu},{role:"user",content:h}],max_tokens:800,temperature:.3}})).choices[0].message.content,g=JSON.parse(p);s=g.summary,i=g.categories}else s=a;const c=i&&i.length?i:["Others"];return{summary:s,categories:c}}const Jm={Openai:Hm},Gm="https://stargram.cc";let vt=!1,bt=!1,cn=!1,un=!1,wt=0,Xe=0,Ve=0,et=0,mt=0,gt=0,hs=[],Wt=[],ir=0,Ot=0,ar=0,Tt=0,Rr=!0;const Ze=3,zn=100;function Cr(n){const e={};return Object.keys(n).forEach(t=>{e[t]=n[t].value}),Object.keys(e).length?e:null}async function ha(n){chrome.tabs.query({active:!0,lastFocusedWindow:!0},e=>{e.length&&n.tabId&&e[0].id&&n.tabId!==e[0].id&&chrome.tabs.sendMessage(e[0].id,{action:"savedStatusToContent",data:n})}),n.tabId?chrome.tabs.sendMessage(n.tabId,{action:"savedStatusToContent",data:n}):chrome.tabs.query({active:!0,lastFocusedWindow:!0},e=>{e.length!==0&&e[0].id&&chrome.tabs.sendMessage(e[0].id,{action:"savedStatusToContent",data:n})}),chrome.runtime.sendMessage({action:"savedStatusToPopup",data:n})}function jr(){chrome.runtime.sendMessage({action:"syncBookmarksStatus",syncStatus:{index:Xe,count:wt,state:vt,isEnd:cn,successCount:ir,failCount:Ot}})}function Wm(){ir+Ot===wt&&chrome.tabs.query({active:!0,lastFocusedWindow:!0},n=>{n.length!==0&&n[0].id&&chrome.tabs.sendMessage(n[0].id,{action:"syncBookmarksStatus",syncStatus:{index:Xe,count:wt,state:vt,isEnd:cn,successCount:ir,failCount:Ot}})})}function fs(){if(mt%Ze===0||wt-Xe<Ze){mt=mt%Ze;for(let n=0;n<Ze;n++)if(Xe<wt)if(vt)jr();else{const e={webUrl:hs[Xe],starred:!1};Zs(e).then(t=>{t.error?Ot++:ir++}).catch(()=>{Ot++}).finally(()=>{mt++,jr(),fs()}),Xe++}else{cn=!0,jr(),Wm();break}}}function Xt(){chrome.runtime.sendMessage({action:"syncGithubStatus",syncStatus:{index:et,count:Ve,state:bt,fetchEnd:Rr,isEnd:un,successCount:ar,failCount:Tt}})}function Ym(){ar+Tt===Ve&&chrome.tabs.query({active:!0,lastFocusedWindow:!0},n=>{n.length!==0&&n[0].id&&chrome.tabs.sendMessage(n[0].id,{action:"syncGithubStatus",syncStatus:{index:et,count:Ve,state:bt,fetchEnd:Rr,isEnd:un,successCount:ar,failCount:Tt}})})}function ps(){if(gt%Ze===0||Ve-et<Ze){gt=gt%Ze;for(let n=0;n<Ze;n++)if(et<Ve)if(bt)Xt();else{const e={webUrl:Wt[et],starred:!1};Zs(e).then(t=>{t.error?Tt++:ar++}).catch(()=>{Tt++}).finally(()=>{gt++,Xt(),ps()}),et++}else{un=!0,Xt(),Ym();break}}}chrome.runtime.onInstalled.addListener(async()=>{const n=await chrome.storage.sync.get(["uiLang","userConfig"]),e=n.uiLang??"en",t=n.userConfig??"";await chrome.storage.sync.set({uiLang:e,userConfig:t})});chrome.runtime.onMessage.addListener(async(n,e,t)=>{var s,i,a;const r=n.action;if(r==="saveToDB")if(n.data){const o=(s=e.tab)==null?void 0:s.id,u=n.data;u.tabId=o,Zs(u).then(c=>{ha(c)}).catch(c=>{ha(c)}),t({message:"handling save to notion"})}else t({message:"Error: request.data is undefined.",error:!0});else if(r==="checkStarred"){const o=(i=e.tab)==null?void 0:i.id,u=(a=n.data)==null?void 0:a.webUrl;u&&o&&Qm(u,o).then(c=>{fa(c)}).catch(c=>{fa(c)}),t({message:"checking"})}else if(r==="syncBookmarks")n.syncData?(hs=n.syncData,wt=hs.length,Xe=0,mt=0,ir=0,Ot=0,cn=!1,vt=!1,fs(),t({message:"handling save to DB"})):t({message:"Error: request.data is undefined.",error:!0});else if(r==="syncBookmarksStatus")jr();else if(r==="syncBookmarksState")vt=n.syncState??!1,vt||(mt=0,fs());else if(r==="syncGithubStarred")if(n.fetchGithubData){const{user:o,token:u}=n.fetchGithubData;Wt=[],et=0,Ve=0,gt=0,ar=0,Tt=0,un=!1,bt=!1,Rr=!1;let c="",l=1,h=0;do{o?c=`https://api.github.com/users/${o}/starred?per_page=${zn}&page=${l}`:c=`https://api.github.com/user/starred?per_page=${zn}&page=${l}`;const p=await fetch(c,{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${u}`,"X-GitHub-Api-Version":"2022-11-28"}});if(p.status===200){const g=await p.json();h=g.length,Ve+=h,Wt=Wt.concat(g.map(b=>b.html_url))}l++}while(h===zn);Rr=!0,Ve=Wt.length,Xt(),ps(),t({message:"handling save to DB"})}else t({message:"Error: request.data is undefined.",error:!0});else r==="syncGithubStatus"?Xt():r==="syncGithubState"&&(bt=n.syncState??!1,bt||(gt=0,ps()));return!0});async function Zs(n){var r,s;const t=(await chrome.storage.sync.get(["userConfig"])).userConfig??"";if(t){const i=JSON.parse(t),a=i.app.stargramHub??Gm,o=n.webUrl,u=new fu({stargramHub:a,browserlessToken:(s=(r=i.webInfo.config)==null?void 0:r.browserlessToken)==null?void 0:s.value}),c=new lu({stargramHub:a}),l=Cr(i.llm.config),h=new Jm[i.llm.select](l),p=Cr(i.dataStorage.config),g=new rs.DataStorage[i.dataStorage.select](p),b=h.embeddingsInfo(),w={source:o,appName:i.app.appName,botId:i.app.botId,userId:i.app.userId},O=Cr(i.vectorStorage.config),C=new rs.VectorStorage[i.vectorStorage.select]({...O,embeddingsInfo:b,metaData:w}),k=new gu({webInfo:u,webCard:c,llm:h,dataStorage:g,vectorStorage:C});try{const j=await k.call({webUrl:o});return{tabId:n.tabId,starred:j.starred,storageId:j.storageId}}catch(j){const S=pa(j);return{tabId:n.tabId,starred:n.starred,storageId:n.storageId,error:S}}}else return{tabId:n.tabId,starred:n.starred,storageId:n.storageId,error:"No User Config."}}async function fa(n){n.tabId&&chrome.tabs.sendMessage(n.tabId,{action:"starredStatusToContent",data:n})}async function Qm(n,e){const r=(await chrome.storage.sync.get(["userConfig"])).userConfig??"";let s=!1,i="";if(r){const a=JSON.parse(r),o=Cr(a.dataStorage.config),u=new rs.DataStorage[a.dataStorage.select](o);try{const c=await u.query(n);return c&&(s=c.starred,i=c.storageId),{tabId:e,starred:s,storageId:i}}catch(c){return{tabId:e,starred:s,storageId:i,error:c.message?c.message:"Error check starred status."}}}else return{tabId:e,starred:s,storageId:i,error:"No User Config."}}
