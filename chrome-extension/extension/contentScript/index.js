(function(){"use strict";async function h(n,t,e,r=!0){var a;try{const c={method:"GET",headers:t};e&&Object.keys(e).length&&(n+=`?${new URLSearchParams(e).toString()}`);const s=await fetch(n,c);if(!s.ok){let d=s.statusText;const g=s.headers.get("content-type");if(g&&g.includes("application/json")){const f=await s.json();d=((a=f.error)==null?void 0:a.message)||f.message||s.statusText}else g&&g.includes("text/")&&(d=await s.text());if(!r)return{error:d};throw new Error(d)}let i=s;const o=s.headers.get("content-type");return o&&o.includes("application/json")?i=await s.json():o&&o.includes("text/")&&(i=await s.text()),i}catch(c){throw new Error(c.message)}}function B(n){const t=n.match(/https?:\/\/([^/]+)\/?/i);let e="";return t&&t[1]&&(e=t[1]),e}async function C(n,t,e={"User-Agent":G}){let r="",a="";const c={domain:T,website:"Github"},s=/https:\/\/github.com\/([^\/]*\/[^\/]*)/g.exec(n),i=s?s[1]:"";try{if(i){const o=await h(`${x}/${i}`,e),d=await h(`${x}/${i}/languages`,e),g=await h(`${M}/${i}/${o.default_branch}/README.md`,e,void 0,!1),f=g.error?"":g,v=o.description?o.description.replace(/:\w+:/g," "):"";r=o.full_name+(v?`: ${v}`:""),n=o.html_url;const S=o.topics;S&&S.length>0&&(c.tags=S),d&&(c.languages=Object.keys(d));const k=t||A;if(k){const q=o.owner.login,D=o.name,V=`${k}?username=${q}&reponame=${D}&stargazers_count=${o.stargazers_count}&language=${o.language}&issues=${o.open_issues_count}&forks=${o.forks_count}&description=${v}`,z=await h(V);c.socialPreview=z.url}a=`${r}

${f}`,a.length>1e3&&(a=a.substring(0,1e3),a+="...")}else return{error:"Github error: Not supported website."};return{data:{title:r,url:n,content:a,meta:c}}}catch(o){return{error:`Github error: ${o}`}}}const T="github.com",F={}.VITE_GITHUB_API_HOST||"https://api.github.com",x=`${F}/repos`,M={}.VITE_GITHUB_RAW_HOST||"https://raw.githubusercontent.com",A={}.VITE_PICTURE_BED,G="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.2 Safari/605.1.15",E={[T]:{loader:C}};async function P(n,t,e){let r={};const a=B(n);return E[a]?r=await E[a].loader(n,t,e):r.error="StarNexus error: Not supported website.",r}const j="github.com",N="https://github.com",w='data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="256" height="256" viewBox="0 0 256 256"%3E%3Cpath fill="currentColor" d="M237.47 70.71a11.18 11.18 0 0 0-9.73-7.71l-38.43-3.25l-15-35a11.24 11.24 0 0 0-20.63 0l-15 35L100.27 63a11.12 11.12 0 0 0-6.36 19.54L123 107.38l-8.72 36.92a11.09 11.09 0 0 0 4.26 11.5a11.23 11.23 0 0 0 12.42.6l33-19.64l33.05 19.64a11.22 11.22 0 0 0 12.42-.6a11.07 11.07 0 0 0 4.25-11.5L205 107.38l29.08-24.83a11.08 11.08 0 0 0 3.39-11.84Zm-40.66 27.9a11.05 11.05 0 0 0-3.61 11l8.39 35.55l-31.83-18.92a11.23 11.23 0 0 0-11.52 0l-31.82 18.92l8.38-35.56a11 11 0 0 0-3.6-11l-27.89-23.81l36.85-3.12a11.2 11.2 0 0 0 9.37-6.74L164 31.17l14.48 33.76a11.19 11.19 0 0 0 9.36 6.74l36.86 3.12ZM84.24 124.24l-56 56a6 6 0 0 1-8.48-8.48l56-56a6 6 0 0 1 8.48 8.48Zm16 47.52a6 6 0 0 1 0 8.48l-56 56a6 6 0 0 1-8.48-8.48l56-56a6 6 0 0 1 8.48 0Zm72 0a6 6 0 0 1 0 8.48l-56 56a6 6 0 0 1-8.48-8.48l56-56a6 6 0 0 1 8.49 0Z"%2F%3E%3C%2Fsvg%3E',b='data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="256" height="256" viewBox="0 0 256 256"%3E%3Cpath fill="currentColor" d="m235.39 84.07l-28.15 24l8.43 35.73a13.09 13.09 0 0 1-5 13.58a13.25 13.25 0 0 1-14.63.7l-32-19l-32 19a13.25 13.25 0 0 1-14.63-.7a13.1 13.1 0 0 1-5-13.58l8.43-35.73l-28.16-24A13.13 13.13 0 0 1 100.1 61l37.23-3.15L151.85 24a13.24 13.24 0 0 1 24.31 0l14.52 33.87L227.9 61a13.12 13.12 0 0 1 7.49 23.06ZM85.66 114.34a8 8 0 0 0-11.32 0l-56 56a8 8 0 0 0 11.32 11.32l56-56a8 8 0 0 0 0-11.32Zm16 56a8 8 0 0 0-11.32 0l-56 56a8 8 0 0 0 11.32 11.32l56-56a8 8 0 0 0 0-11.32Zm60.69 0l-56 56a8 8 0 0 0 11.32 11.32l56-56a8 8 0 0 0-11.31-11.32Z"%2F%3E%3C%2Fsvg%3E';let l=null,u=!1,m=!1,y="";const p="star-nexus";function $(){if(!document.querySelector(`#${p}`)&&location.host===j){const e=/https:\/\/github.com\/([^\/]*\/[^\/]*)/g.exec(location.href),r=e?e[1]:"";r&&chrome.runtime.sendMessage({action:"checkStarred",data:{url:`${N}/${r}`}})}}$();async function U(){const t=(await chrome.storage.sync.get(["pictureBed"])).pictureBed??"",e=await P(location.href,t);return{data:{...e.data,notionPageId:y,starred:u},error:e.error}}function H(){const t=document.querySelector(`#${p}`).querySelector("img");m=u,l=setInterval(()=>{m=!m,m?t.src=b:t.src=w},500)}async function _(){H();const{data:n,error:t}=await U();if(t){l&&clearInterval(l),alert(t);return}chrome.runtime.sendMessage({action:"saveToNotion",data:n})}chrome.runtime.onMessage.addListener(async(n,t,e)=>{const r=n.action,a=n.data;if(r==="saveToNotion")_(),e({message:"Handling save to Notion in the content script",error:!1});else if(r==="starredStatusToContent")a&&a.error?alert(a.error):(l&&clearInterval(l),u=a.starred,y=a.notionPageId,O(u)),e({message:"ok",error:!1});else if(r==="savedStatusToContent"){const s=document.querySelector(`#${p}`).querySelector("img");l&&clearInterval(l),a&&(a.error?(u=a.starred,alert(a.error)):(u=a.starred,y=a.notionPageId)),u?s.src=b:s.src=w,e({message:"ok",error:!1})}else e({message:"Unknow action",error:!0});return!0});const Z=['.js-timeline-item:has(* > .author[href="/apps/codeflowapp"]) { display: none; }'].join(""),I=document.createElement("style");I.innerHTML=Z,document.head.appendChild(I);function L(n){const t=document.createElement("a");t.target="_blank",t.classList.add("btn"),t.classList.add("btn-sm"),t.innerText=" StarNexus",t.id=p,Object.assign(t.style,{display:"inline-flex",alignItems:"center",gap:"0.5em"}),t.addEventListener("click",()=>{_()});const e=document.createElement("img");return e.src=n?b:w,e.height=18,e.classList.add("octicon"),t.prepend(e),t}function O(n){const t=document.querySelector("#repository-details-container ul");if(t){const r=document.createElement("li");r.appendChild(L(n)),t.prepend(r);return}const e=document.querySelector(".gh-header-actions");e&&e.prepend(L(n))}document.addEventListener("pjax:end",()=>$()),document.addEventListener("turbo:render",()=>$())})();
